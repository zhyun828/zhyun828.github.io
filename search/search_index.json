{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"\u4e3b\u9875","text":"<p># My Notes</p> <p>\u6b22\u8fce\u6765\u5230\u6211\u7684\u4e2a\u4eba\u7b14\u8bb0\u7ad9 \ud83d\udc4b  </p> <p>\u8fd9\u91cc\u4e3b\u8981\u8bb0\u5f55\u6211\u5728 **FPGA / C++ / Arduino / \u5d4c\u5165\u5f0f\u7cfb\u7edf** \u5b66\u4e60\u4e0e\u9879\u76ee\u5b9e\u8df5\u4e2d\u7684\u7b14\u8bb0\u4e0e\u603b\u7ed3\u3002</p> <p>## \ud83d\udcda \u7b14\u8bb0\u5206\u7c7b</p> <p>- \ud83d\udd0c [Arduino](notes/Arduino/)</p> <p>- \ud83d\udcbb [C++](notes/Cpp/)</p> <p>- \ud83d\udca1 [FPGA / VHDL](notes/FPGA/)</p> <p>## \u270d\ufe0f \u5173\u4e8e\u672c\u7ad9</p> <p>- \u4f7f\u7528 **MkDocs + Material** \u6784\u5efa  </p> <p>- \u5185\u5bb9\u4f7f\u7528 **Markdown** \u7f16\u5199  </p> <p>- \u901a\u8fc7 **GitHub Actions \u81ea\u52a8\u90e8\u7f72**  </p> <p>\u6301\u7eed\u66f4\u65b0\u4e2d \ud83d\ude80</p>"},{"location":"notes/Cpp/basics/","title":"\u5f15\u7528","text":"<p>\u5f15\u7528 = \u522b\u540d \u5fc5\u987b\u5728\u5b9a\u4e49\u65f6\u521d\u59cb\u5316\uff0c\u4e00\u65e6\u7ed1\u5b9a\uff0c\u4e0d\u80fd\u518d\u7ed1\u5176\u4ed6\u53d8\u91cf\u4e86\uff0c\u5f15\u7528\u4e0d\u80fd\u4e3a\u7a7a <pre><code>int a = 1, b = 2;\nint&amp; r = a;\nr = b;   // \u274c \u4e0d\u662f\u6539\u5f15\u7528\u5bf9\u8c61\n//\u7b49\u4ef7\u4e8e\na = b;\n</code></pre></p>"},{"location":"notes/Cpp/basics/#makefile","title":"makefile","text":""},{"location":"notes/Cpp/basics/#_2","title":"\u666e\u901a\u7f16\u8bd1","text":"<p><pre><code>g++ test.cpp -o test -std=c++17 -Wall -Wextra\n</code></pre> <pre><code>CXX = g++ # \u5b9a\u4e49\u7f16\u8bd1\u5668CXX \u662f make \u7684\u60ef\u4f8b\u53d8\u91cf\u540d\uff08C++ compiler\uff09\nCXXFLAGS = -Wall -Wextra -g -MMD -MP \n#\u7f16\u8bd1\u9009\u9879\n# | \u53c2\u6570      | \u4f5c\u7528              |\n# | -Wall   | \u6253\u5f00\u5e38\u89c1\u8b66\u544a          |\n# | -Wextra | \u6253\u5f00\u66f4\u591a\u8b66\u544a          |\n# | -g      | \u751f\u6210\u8c03\u8bd5\u4fe1\u606f\uff08\u7ed9 gdb \u7528\uff09 |\n# | -MMD    | \u81ea\u52a8\u751f\u6210 .d \u4f9d\u8d56\u6587\u4ef6    |\n# | -MP     | \u907f\u514d\u5220\u9664\u5934\u6587\u4ef6\u65f6\u62a5\u9519      |\nTARGET = test # \u6700\u7ec8\u751f\u6210\u7684\u53ef\u6267\u884c\u6587\u4ef6\u540d\u6700\u7ec8\u4f1a\u751f\u6210\uff1a./test\nSRCS = main.cpp Surcharge.cpp # \u6240\u6709\u6e90\u6587\u4ef6\u5982\u679c\u4f60\u518d\u52a0\u4e00\u4e2a\u6587\u4ef6\uff1aSRCS = main.cpp Surcharge.cpp utils.cpp \u540e\u9762\u4f1a\u81ea\u52a8\u9002\u914d\u3002\nOBJS = $(SRCS:.cpp=.o) # \u53d8\u91cf\u66ff\u6362\u610f\u601d\u662f\uff1amain.cpp \u2192 main.o Surcharge.cpp \u2192 Surcharge.o\n# $(\u53d8\u91cf:\u65e7\u540e\u7f00=\u65b0\u540e\u7f00)\nDEPS = $(SRCS:.cpp=.d) # \u751f\u6210\u4f9d\u8d56\u6587\u4ef6\u540dmain.d Surcharge.d .d \u6587\u4ef6\u662f -MMD \u81ea\u52a8\u751f\u6210\u7684\u4f9d\u8d56\u6587\u4ef6\u3002\n$(TARGET): $(OBJS)\n    $(CXX) $(CXXFLAGS) -o $@ $(OBJS)\n# \u7b49\u4ef7\u4e8eg++ -Wall -Wextra -g -MMD -MP -o test main.o Surcharge.o\n# | \u7b26\u53f7 | \u610f\u4e49              |\n# | -- | --------------- |\n# | $@ | \u5f53\u524d\u76ee\u6807\u540d\uff08\u8fd9\u91cc\u662f test\uff09 |\n# | $&lt; | \u7b2c\u4e00\u4e2a\u4f9d\u8d56\u6587\u4ef6         |\n# | $^ | \u6240\u6709\u4f9d\u8d56\u6587\u4ef6          |\n%.o: %.cpp\n    $(CXX) $(CXXFLAGS) -c $&lt; -o $@  \n# \u6a21\u5f0f\u5339\u914d\u89c4\u5219 \u610f\u601d\u662f\uff1a\u4efb\u4f55 .o \u6587\u4ef6 \u90fd\u53ef\u4ee5\u7531 \u5bf9\u5e94\u7684 .cpp \u6587\u4ef6 \u751f\u6210\n# \u7b49\u4ef7\u4e8eg++ -Wall -Wextra -g -MMD -MP -c main.cpp -o main.o  \u5176\u4e2d -c \u8868\u793a\u53ea\u7f16\u8bd1\uff0c\u4e0d\u94fe\u63a5\n\n-include $(DEPS) # \u81ea\u52a8\u5305\u542b\u4f9d\u8d56\uff0c\u610f\u601d\u662f\uff1a\u5305\u542b\u6240\u6709 .d \u6587\u4ef6\u3002\u524d\u9762\u7684 - \u8868\u793a\uff1a\u5982\u679c .d \u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u4e0d\u62a5\u9519\n\n.PHONY: clean\n# \u4f2a\u76ee\u6807 clean \u7684\u610f\u601d\u662f\uff1a\u544a\u8bc9 make clean \u4e0d\u662f\u4e00\u4e2a\u6587\u4ef6\u540d\uff0c\u800c\u662f\u4e00\u4e2a\u547d\u4ee4\u3002\u5426\u5219\u5982\u679c\u76ee\u5f55\u91cc\u6709\u4e2a\u53eb clean \u7684\u6587\u4ef6\u5c31\u4f1a\u51b2\u7a81\u3002\nclean:\n    rm -f $(OBJS) $(DEPS) $(TARGET)\n</code></pre></p>"},{"location":"notes/Cpp/basics/#_3","title":"\u6570\u636e\u7c7b\u578b","text":"\u6570\u636e\u7c7b\u578b \u8bf4\u660e \u5185\u5b58\u5927\u5c0f\uff08\u5b57\u8282\uff09 <code>int</code> \u6574\u6570 4 <code>long</code> \u957f\u6574\u6570 4 \u6216 8 <code>float</code> \u5355\u7cbe\u5ea6\u6d6e\u70b9\u6570 4 <code>double</code> \u53cc\u7cbe\u5ea6\u6d6e\u70b9\u6570 8 <code>char</code> \u5b57\u7b26 1 <code>bool</code> \u5e03\u5c14\u503c\uff08true/false\uff09 1 <pre><code>int number = 1; // \u6574\u6570\n(char)number; // \u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u4e3a char\uff0c\u7ed3\u679c\u662f '\\x01'\uff08ASCII \u7801\u4e3a 1 \u7684\u5b57\u7b26\uff09\nchar c = '0'+number; // \u7ed3\u679c\u662f '1'\uff08ASCII \u7801\u4e3a 48 \u7684\u5b57\u7b26\uff09\nchar c2 = to_string(number)[0]; // \u7ed3\u679c\u4e5f\u662f '1'\uff0cto_string(number) \u5c06\u6574\u6570\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32 \"1\"\uff0c\u7136\u540e\u53d6\u7b2c\u4e00\u4e2a\u5b57\u7b26\n</code></pre>"},{"location":"notes/Cpp/basics/#const","title":"const \u7684\u7528\u6cd5","text":"<pre><code>bool stackArray::isEmpty() const{\n    return head == -1;\n}\u8fd9\u91cc\u7684 const \u4fdd\u8bc1\u51fd\u6570\u4e0d\u4fee\u6539 head \u7684\u6570\u503c\n</code></pre>"},{"location":"notes/Cpp/basics/#_4","title":"\u5224\u65ad","text":"<p>\u53ef\u4ee5\u7528 if(\u6761\u4ef6) return;else return; \u6216\u8005 return (\u6761\u4ef6)?\u6b63\u786e\u7ed3\u679c : \u9519\u8bef\u7ed3\u679c \u6216\u8005\u76f4\u63a5 retunr(\u6761\u4ef6);\u53ef\u4ee5\u83b7\u5f97\u8fd4\u56de\u503c1\u62160\u3002</p>"},{"location":"notes/Cpp/basics/#_5","title":"\u9ed8\u8ba4\u8d4b\u503c","text":"<p>\u4f8b\u5982stackArray(int size = default_size);\u51fa\u73b0\u5728.h \u6587\u4ef6\u4e2d\u8868\u793a\uff1a\u5982\u679c\u8c03\u7528\u65f6\u6ca1\u7ed9 size \u8d4b\u503c\u5c31\u7528 default_size</p>"},{"location":"notes/Cpp/basics/#_6","title":"\u547d\u540d\u7a7a\u95f4","text":"<p>namespace \u662f\u7528\u4e8e\u5c01\u88c5\u540c\u4e00\u9886\u57df\u7684\u4e00\u7ec4\u5b9e\u4f53\u3002\u547d\u540d\u7a7a\u95f4\u5c31\u662f\u7ed9\u540d\u5b57\u201c\u5206\u7ec4\u201d\u7684\u5de5\u5177\uff0c\u7528\u6765\u907f\u514d\u540d\u5b57\u51b2\u7a81\u3002\u4f7f\u7528 :: \u8fd0\u7b97\u7b26\u53ef\u4ee5\u8bbf\u95ee\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u6210\u5458\u3002</p>"},{"location":"notes/Cpp/basics/#_7","title":"\u5168\u5c40\u53d8\u91cf","text":"<p>\u662f\u5728\u6240\u6709\u51fd\u6570\u5916\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u6574\u4e2a\u7a0b\u5e8f\u90fd\u80fd\u7528\u3002\u5176\u5185\u5b58\u7a0b\u5e8f\u4e00\u542f\u52a8\u5c31\u5206\u914d,\u7a0b\u5e8f\u7ed3\u675f\u624d\u91ca\u653e\u3002</p>"},{"location":"notes/Cpp/basics/#_8","title":"\u9759\u6001\u53d8\u91cf","text":"<p>\u53ea\u521b\u5efa\u4e00\u6b21\uff0c\u751f\u547d\u5468\u671f\u8d2f\u7a7f\u6574\u4e2a\u7a0b\u5e8f,\u5373 static int cpt=0 \u5728\u53c2\u6570\u5728\u67d0\u51fd\u6570\u4e2d\u4e00\u65e6\u88ab\u521b\u5efa\uff0c\u5373\u4f7f\u518d\u6b21\u4f7f\u7528\u8be5\u51fd\u6570\u8bfb\u5230\u8fd9\u91cc\u4e5f\u4e0d\u4f1a\u518d\u6b21\u8d4b\u503c\uff0c\u5176\u5185\u5b58\u7a0b\u5e8f\u4e00\u542f\u52a8\u5c31\u5206\u914d,\u7a0b\u5e8f\u7ed3\u675f\u624d\u91ca\u653e\u3002</p>"},{"location":"notes/Cpp/basics/#this","title":"this","text":"<p>\u662f\u4e00\u4e2a\u6307\u9488\uff0c\u6307\u5411\u201c\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u8fd9\u4e2a\u51fd\u6570\u7684\u90a3\u4e2a\u5bf9\u8c61\u201d</p>"},{"location":"notes/Cpp/basics/#_9","title":"\u6784\u9020\u51fd\u6570","text":"<p>\u662f\u7c7b\u7684\u4e00\u79cd\u7279\u6b8a\u6210\u5458\u51fd\u6570\uff0c\u7528\u4e8e\u5728\u521b\u5efa\u5bf9\u8c61\u65f6\u521d\u59cb\u5316\u5bf9\u8c61\u3002\u6784\u9020\u51fd\u6570\u7684\u540d\u79f0\u4e0e\u7c7b\u540d\u76f8\u540c\uff0c\u5e76\u4e14\u6ca1\u6709\u8fd4\u56de\u7c7b\u578b\u3002\u5728\u4e0d\u5b9a\u4e49\u6784\u9020\u51fd\u6570\u65f6\uff0c\u7f16\u8bd1\u5668\u4f1a\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\uff08\u65e0\u53c2\u6570\uff09\u3002\u5982\u679c\u5b9a\u4e49\u4e86\u5e26\u53c2\u6570\u7684\u6784\u9020\u51fd\u6570\uff0c\u7f16\u8bd1\u5668\u5c06\u4e0d\u518d\u751f\u6210\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\uff0c\u56e0\u6b64\u5982\u679c\u9700\u8981\u65e0\u53c2\u6570\u6784\u9020\u51fd\u6570\uff0c\u5fc5\u987b\u663e\u5f0f\u5b9a\u4e49\u5b83\u3002</p>"},{"location":"notes/Cpp/basics/#_10","title":"\u5f53\u7236\u7c7b \u6ca1\u6709\u9ed8\u8ba4\u6784\u9020\u51fd\u6570 \u65f6","text":"<p>\u4f8b\u5982\uff1a <pre><code>class A {\npublic:\n    A(int x) {}// A \u53ea\u6709\u4e00\u4e2a\u5e26\u53c2\u6570\u7684\u6784\u9020\u51fd\u6570\uff0c\u6ca1\u6709\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\uff0c\u6240\u4ee5\u7f16\u8bd1\u5668\u4e0d\u4f1a\u81ea\u52a8\u751f\u6210\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\u3002\u5982\u679c\u662fclass A {int x;}\uff0c\u7f16\u8bd1\u5668\u4f1a\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u9ed8\u8ba4\u6784\u9020\u51fd\u6570 A() {}\uff0c\u5c31\u4e0d\u4f1a\u62a5\u9519;\n};\n</code></pre> \u5982\u679c\u4f60\u5199\uff1a <pre><code>class C : public A {\n};\n</code></pre> \u7136\u540e\uff1a <pre><code>C c;\n</code></pre> \u4f1a\u62a5\u9519 \u274c</p>"},{"location":"notes/Cpp/basics/#explicit-explicit","title":"explicit \u5355\u53c2\u6570\u6784\u9020\u51fd\u6570\u90fd\u52a0 explicit","text":"<pre><code>// \u5982\u679c\u4f60\u5199\uff1a\nTraveler(const std::string&amp; s);\n// \u4f60\u53ef\u4ee5\u8fd9\u6837\u5199\uff1a\nTraveler t = \"Alice\";\n// \u56e0\u4e3a\uff1a\n\"Alice\" \u2192 std::string \u2192 Traveler\n// \u53d1\u751f\u4e86 \u9690\u5f0f\u8f6c\u6362\uff08implicit conversion\uff09\u3002\n// \u5982\u679c\u4f60\u52a0\u4e0a\uff1a\nexplicit Traveler(const std::string&amp; s);\n// \u5c31\u7981\u6b62\u8fd9\u79cd\u9690\u5f0f\u8f6c\u6362\u3002\n// \u73b0\u5728\u5fc5\u987b\u5199\uff1a\nTraveler t(\"Alice\");  // \u6b63\u786e\nTraveler t = \"Alice\"; // \u274c \u4e0d\u5141\u8bb8\n</code></pre>"},{"location":"notes/Cpp/basics/#_11","title":"\u6790\u6784\u51fd\u6570","text":"<p>\u7c7b\u7684\u4e00\u79cd\u7279\u6b8a\u6210\u5458\u51fd\u6570\uff0c\u7528\u4e8e\u5728\u5bf9\u8c61\u751f\u547d\u5468\u671f\u7ed3\u675f\u65f6\u6267\u884c\u6e05\u7406\u64cd\u4f5c\u3002\u6790\u6784\u51fd\u6570\u7684\u540d\u79f0\u4e0e\u7c7b\u540d\u76f8\u540c\uff0c\u4f46\u524d\u9762\u52a0\u4e0a\u6ce2\u6d6a\u53f7\uff08~\uff09\uff0c\u5e76\u4e14\u6ca1\u6709\u8fd4\u56de\u7c7b\u578b\u548c\u53c2\u6570\u3002 \u6ca1\u6709\u5199\u6790\u6784\u51fd\u6570\u65f6\uff0c\u7f16\u8bd1\u5668\u4f1a\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u9ed8\u8ba4\u6790\u6784\u51fd\u6570\uff0c\u8d1f\u8d23\u9500\u6bc1\u5bf9\u8c61\u65f6\u91ca\u653e\u8d44\u6e90\u3002  \u4e00\u5b9a\u8981\u5199\u6790\u6784\u51fd\u6570\u7684\u60c5\u51b5\uff1a</p>"},{"location":"notes/Cpp/basics/#new","title":"\u7c7b\u91cc\u6709 new","text":"<pre><code>class A {\n    int* p;\npublic:\n    A() {\n        p = new int(5);\n    }\n};\n// \u5982\u679c\u4f60\u4e0d\u5199\u6790\u6784\u51fd\u6570\uff1a\n// \u274c \u5185\u5b58\u6cc4\u6f0f\n// \u5fc5\u987b\u5199\uff1a\n~A() {\n    delete p;\n}\n</code></pre>"},{"location":"notes/Cpp/basics/#_12","title":"\u7c7b\u88ab\u7ee7\u627f\uff0c\u5e76\u4e14\u4f60\u4f1a\u7528\u201c\u57fa\u7c7b\u6307\u9488\u5220\u9664\u5b50\u7c7b\u201d","text":"<p>\u8fd9\u662f\u7ee7\u627f\u91cc\u6700\u5371\u9669\u7684\u5751\u3002 \u4f8b\u5982\uff1a <pre><code>class Base {\npublic:\n    ~Base() {\n        std::cout &lt;&lt; \"Base destructor\\n\";\n    }\n};\n\nclass Derived : public Base {\npublic:\n    ~Derived() {\n        std::cout &lt;&lt; \"Derived destructor\\n\";\n    }\n};\n\n// \u7136\u540e\uff1a\nBase* p = new Derived();\ndelete p;\n\n// \u8f93\u51fa\u662f\uff1a\nBase destructor\n\n// \u6b63\u786e\u505a\u6cd5\n// \u5982\u679c\u7c7b\u4f1a\u88ab\u7ee7\u627f\uff0c\u5e94\u8be5\u5199\uff1a\nclass Base {\npublic:\n    virtual ~Base() {}\n};\n</code></pre></p>"},{"location":"notes/Cpp/basics/#_13","title":"\u8fed\u4ee3\u5668","text":"<p>\u8fed\u4ee3\u5668 = \u4f4d\u7f6e | \u5bb9\u5668                      | \u8fed\u4ee3\u5668\u5e95\u5c42          | | ----------------------- | -------------- | | <code>vector</code> / <code>string</code>     | \u771f\u00b7\u6307\u9488 \u6216\u63a5\u8fd1\u6307\u9488 | | <code>deque</code>                 | \u590d\u6742\u7ed3\u6784           | | <code>list</code>                  | \u5305\u88c5\u4e86\u94fe\u8868\u8282\u70b9\u7684\u5bf9\u8c61     | | <code>map</code> / <code>unordered_map</code> | \u7c7b\u5bf9\u8c61\uff08\u7ea2\u9ed1\u6811 / \u54c8\u5e0c\u6876\uff09 | <pre><code>string::iterator it;\nfor (auto it = s.begin(); it != s.end(); ++it) {\n    cout &lt;&lt; *it &lt;&lt; endl;}\n//\u7b49\u4ef7\u4e8e\nfor (int i = 0; i &lt; s.size(); i++) {\n    cout &lt;&lt; s[i] &lt;&lt; endl;}\n</code></pre></p>"},{"location":"notes/Cpp/basics/#auto","title":"auto","text":"<p>\u4ec0\u4e48\u65f6\u5019\u8be5\u7528 auto\uff08\u63a8\u8350\uff09 1\ufe0f\u20e3 \u8fed\u4ee3\u5668\uff08\u9996\u9009\u573a\u666f\uff09 <pre><code>for (auto it = s.begin(); it != s.end(); ++it)\n</code></pre> \u539f\u56e0\uff1a string::iterator \u592a\u957f \u6539\u5bb9\u5668\u7c7b\u578b\u65f6\u4ee3\u7801\u4e0d\u7528\u52a8 2\ufe0f\u20e3 STL \u8fd4\u56de\u503c\u590d\u6742\u65f6 <pre><code>auto it = mp.find(key);\n//\u7b49\u4ef7\u4e8e\nunordered_map&lt;int, string&gt;::iterator it = mp.find(key);\n</code></pre></p>"},{"location":"notes/Cpp/basics/#_14","title":"\u53cc\u6307\u9488","text":"<p><pre><code>//\u5bf9\u649e\u6307\u9488\uff08\u5de6\u53f3\u5939\u903c\uff09   \nl = 0, r = n-1;\nwhile (l &lt; r) {...}\n//\u5feb\u6162\u6307\u9488\uff08\u540c\u5411\uff09\nslow = 0;\nfor (fast = 0; fast &lt; n; fast++) {\n    if (ok(nums[fast])) nums[slow++] = nums[fast];}\n//\u6ed1\u52a8\u7a97\u53e3\uff08\u53d8\u957f\u533a\u95f4\uff09\nl = 0;\nfor (r = 0; r &lt; n; r++) {\n    while (invalid) l++;}\n//\u5339\u914d\u6307\u9488\ni = 0, j = 0;\nwhile (i &lt; s &amp;&amp; j &lt; t) {\n    if (s[i] == t[j]) i++;j++;}\n</code></pre> 1\ufe0f\u20e3 \u6709\u6ca1\u6709\u201c\u8fde\u7eed\u5b50\u6570\u7ec4\u201d\uff1f \u6709 \u2192 \u5927\u6982\u7387\u6ed1\u52a8\u7a97\u53e3 2\ufe0f\u20e3 \u6570\u7ec4\u662f\u5426\u6709\u5e8f\uff1f \u6709 \u2192 \u5927\u6982\u7387\u53cc\u6307\u9488 3\ufe0f\u20e3 \u662f\u5426\u5728\u627e\u201c\u4e24\u4e2a\u6570\u5173\u7cfb\u201d\uff1f \u6709\u5e8f \u2192 \u53cc\u6307\u9488 \u65e0\u5e8f \u2192 \u54c8\u5e0c\u8868 4\ufe0f\u20e3 \u662f\u5426\u6d89\u53ca\u201c\u5de6\u8fb9\u548c == \u53f3\u8fb9\u548c\u201d\uff1f \u2192 \u524d\u7f00\u548c</p>"},{"location":"notes/Cpp/basics/#time-complexity","title":"\u65f6\u95f4\u590d\u6742\u5ea6\uff08Time Complexity\uff09","text":"<p>O(n) \u2014\u2014 \u7ebf\u6027\u65f6\u95f4 \u4f8b\u5982\u904d\u5386\u4e00\u4e2a\u957f\u5ea6\u4e3a n \u7684\u6570\u7ec4 O(n^2) \u2014\u2014 \u4e8c\u6b21\u65f6\u95f4 \u4f8b\u5982\u5d4c\u5957\u5faa\u73af\u904d\u5386\u4e00\u4e2a n x n \u7684\u77e9\u9635 O(log n) \u2014\u2014 \u5bf9\u6570\u65f6\u95f4 \u4f8b\u5982\u7ea2\u9ed1\u6811\uff08set / map\uff09\uff1b\u4e8c\u5206\u67e5\u627e\uff1b\u5806\u64cd\u4f5c \u54c8\u5e0c\u8868\uff1a\u5e73\u5747 O(1) \u7ea2\u9ed1\u6811\uff1aO(log n) \u66b4\u529b\u5faa\u73af\uff1aO(n)</p>"},{"location":"notes/Cpp/basics/#_15","title":"\u7a7a\u95f4\u590d\u6742\u5ea6","text":"<p>\u7b97\u6cd5\u8fd0\u884c\u65f6\u989d\u5916\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f <pre><code>vector&lt;int&gt; v(n);// O(n) \u9700\u8981\u4e00\u4e2a\u957f\u5ea6\u4e3a n \u7684\u6570\u7ec4\u6765\u5b58\u50a8\u5143\u7d20\nint sum(int n) {\n    int s = 0;\n    for(int i=1;i&lt;=n;i++)\n        s += i;\n    return s;\n}// O(1) \u53ea\u9700\u8981\u5e38\u6570\u7a7a\u95f4\u6765\u5b58\u50a8\u53d8\u91cf s \u548c i\n</code></pre></p>"},{"location":"notes/Cpp/basics/#stl","title":"STL \u662f\u4ec0\u4e48\uff1f","text":"<p>STL\uff08Standard Template Library\uff09= C++ \u6807\u51c6\u5e93\u91cc\u7684\u4e00\u5957\u901a\u7528\u6570\u636e\u7ed3\u6784 + \u7b97\u6cd5</p>"},{"location":"notes/Cpp/basics/#_16","title":"\u5806\u6808\u7684\u533a\u522b","text":"<p>\u6808 = \u81ea\u52a8\u5206\u914d\u3001\u81ea\u52a8\u56de\u6536\u7684\u4e34\u65f6\u5185\u5b58 \u5806 = \u624b\u52a8\u7533\u8bf7\u3001\u624b\u52a8\uff08\u6216\u7cfb\u7edf\uff09\u91ca\u653e\u7684\u957f\u671f\u5185\u5b58 | \u4e2d\u6587 | \u82f1\u8bed        | \u6cd5\u8bed       | | -- | --------- | -------- | | \u6808  | Stack | Pile | | \u5806  | Heap  | Tas  |  \u6808\uff08Stack / Pile\uff09        \u5806\uff08Heap / Tas\uff09 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 p (\u5730\u5740)   \u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6 \u2502 ListNode{3}  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u6307\u9488\u5728\u6808\u4e0a\uff0c\u5bf9\u8c61\u5728\u5806\u4e0a"},{"location":"notes/Cpp/basics/#vector","title":"vector \u7684\u6784\u9020\u51fd\u6570","text":"<p>vector v(n, value); \u521b\u5efa\u4e00\u4e2a\u957f\u5ea6\u4e3a n \u7684\u6570\u7ec4\uff0c \u6bcf\u4e2a\u5143\u7d20\u90fd\u521d\u59cb\u5316\u4e3a value"},{"location":"notes/Cpp/basics/#_17","title":"\u6700\u5927\u516c\u7ea6\u6570\u601d\u60f3","text":"<p>\u53ef\u4ee5\u7528\u8f97\u8f6c\u76f8\u9664\u6cd5int r = a%b;a = b;b = r; \u6700\u5927\u516c\u7ea6\u6570\uff08GCD, Greatest Common Divisor\uff09\u7684\u51fd\u6570\u901a\u5e38\u5199\u6210\uff1a gcd(a, b)</p>"},{"location":"notes/Cpp/basics/#_18","title":"\u9762\u5411\u5bf9\u8c61 = \u7528\u201c\u5bf9\u8c61\u201d\u6765\u7ec4\u7ec7\u6570\u636e + \u64cd\u4f5c\u8fd9\u4e9b\u6570\u636e\u7684\u65b9\u6cd5","text":"<p><pre><code>    string s = \"HELLO\";\n    s.erase(2);\n    s.push_back('!');\n</code></pre> \u8fd9\u91ccs\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0cerase \u548c push_back \u662f\u64cd\u4f5c\u8fd9\u4e2a\u5bf9\u8c61\u7684\u65b9\u6cd5</p>"},{"location":"notes/Cpp/basics/#_19","title":"\u94fe\u8868\u64cd\u4f5c","text":"\u7c7b\u578b \u6a21\u578b \u5220\u9664 \u627e\u524d\u9a71 \u63d2\u5165 \u5148\u63a5\u540e\u65ad \u53cd\u8f6c \u4e09\u6307\u9488 \u4e2d\u70b9 \u5feb\u6162\u6307\u9488 \u5012\u6570\u7b2c n \u53cc\u6307\u9488\u95f4\u8ddd \u5408\u5e76 dummy + \u5c3e\u6307\u9488"},{"location":"notes/Cpp/basics/#binary-tree-dfsdepth-first-search","title":"\u4e8c\u53c9\u6811 Binary Tree DFS\uff08Depth First Search\uff09\u6df1\u5ea6\u4f18\u5148","text":"<pre><code>    1\n   / \\\n  2   3\n / \\   \\\n4   5   6\n</code></pre> <p>\u524d\u5e8f\u904d\u5386\uff08\u6839\u5de6\u53f3\uff09 1 2 4 5 3 6 \u4e2d\u5e8f\u904d\u5386\uff08\u5de6\u6839\u53f3\uff09 4 2 5 1 3 6 \u540e\u5e8f\u904d\u5386\uff08\u5de6\u53f3\u6839\uff09 4 5 2 6 3 1 <code>c  //\u9012\u5f52\u4ee3\u7801\u5bf9\u6bd4 void dfs(TreeNode* root) {     if (!root) return;      // \u524d\u5e8f\u4f4d\u7f6e     cout &lt;&lt; root-&gt;val;      dfs(root-&gt;left);      // \u4e2d\u5e8f\u4f4d\u7f6e     cout &lt;&lt; root-&gt;val;      dfs(root-&gt;right);      // \u540e\u5e8f\u4f4d\u7f6e     cout &lt;&lt; root-&gt;val; }</code></p>"},{"location":"notes/Cpp/basics/#_20","title":"\u8fd0\u7b97\u7b26\u91cd\u8f7d","text":"<p>C++ \u91cc\u9762\u6ca1\u6709^\u8fd0\u7b97\u7b26 2^31   // \u274c \u4e0d\u662f 2 \u7684 31 \u6b21\u65b9\uff0c \u800c\u662f\u6309\u4f4d\u5f02\u6216   2  = 00010  31  = 11111 ---------------- XOR       11101 = 29</p> <p>pow(2, 31)   // \u2705 2 \u7684 31 \u6b21\u65b9\uff0c1 &lt;&lt; 31\u4e5f\u662f 2 \u7684 31 \u6b21\u65b9 <ol> <li> <p>\u8fd0\u7b97\u7b26\u91cd\u8f7d\u662f\u5141\u8bb8\u7a0b\u5e8f\u5458\u4e3a\u81ea\u5b9a\u4e49\u6570\u636e\u7c7b\u578b\u5b9a\u4e49\u8fd0\u7b97\u7b26\u7684\u884c\u4e3a\uff0c\u4f7f\u5f97\u8fd9\u4e9b\u8fd0\u7b97\u7b26\u53ef\u4ee5\u50cf\u5185\u7f6e\u6570\u636e\u7c7b\u578b\u4e00\u6837\u4f7f\u7528\u3002</p> </li> <li> <p>a + b \u21d4 operator+(a,b) \u6216 a.operator+(b) \u8fd0\u7b97\u7b26\u91cd\u8f7d\u53ea\u6709\u4e24\u79cd\uff1a\u5916\u90e8\u51fd\u6570 / \u5185\u90e8\u65b9\u6cd5</p> </li> <li> <p>\u5916\u90e8\u8fd0\u7b97\u7b26\u91cd\u8f7d = \u628a\u8fd0\u7b97\u7b26\u5199\u6210\u4e00\u4e2a\u201c\u666e\u901a\u51fd\u6570\u201d\uff0c\u4e0d\u5c5e\u4e8e\u7c7b\uff0c\u4f46\u53ef\u4ee5\u4f5c\u7528\u5728\u7c7b\u5bf9\u8c61\u4e0a\u662f\u4e00\u4e2a \u666e\u901a\u51fd\u6570.\u6240\u6709\u64cd\u4f5c\u6570 \u90fd\u4f5c\u4e3a\u53c2\u6570, \u6ca1\u6709 this \u6307\u9488,\u901a\u5e38\u5199\u5728\u7c7b\u5916\u9762  <li> <p>\u5185\u90e8\u91cd\u8f7dz1.operator+(z2);\u7279\u70b9\uff1a\u662f\u7c7b\u7684\u6210\u5458\u51fd\u6570,\u5de6\u64cd\u4f5c\u6570 = this,\u53f3\u64cd\u4f5c\u6570 = \u53c2\u6570</p> </li>"},{"location":"notes/Cpp/basics/#_21","title":"\u62bd\u8c61\u7c7b","text":"<p>\u5728 C++ \u4e2d\uff1a\u53ea\u8981\u4e00\u4e2a\u7c7b\u4e2d\u5305\u542b\u81f3\u5c11\u4e00\u4e2a\u7eaf\u865a\u51fd\u6570\uff08pure virtual function\uff09\uff0c\u8fd9\u4e2a\u7c7b\u5c31\u662f\u62bd\u8c61\u7c7b \u7eaf\u865a\u51fd\u6570\u5199\u6cd5\uff1avirtual \u8fd4\u56de\u7c7b\u578b \u51fd\u6570\u540d() = 0; \u8fd9\u91cc\u7684 = 0 \u4e0d\u662f\u201c\u7b49\u4e8e 0\u201d\uff0c\u800c\u662f\uff1aC++ \u89c4\u5b9a\uff1a=0 \u8868\u793a\u8fd9\u4e2a\u51fd\u6570\u662f\u7eaf\u865a\u51fd\u6570\uff08pure virtual function\uff09</p>"},{"location":"notes/Cpp/basics/#_22","title":"\u62bd\u8c61\u7c7b\u7684\u6838\u5fc3\u7279\u70b9","text":"<p>1\ufe0f\u20e3 \u4e0d\u80fd\u521b\u5efa\u5bf9\u8c61 <pre><code>class Animal {\npublic:\n    virtual void speak() = 0;  // \u7eaf\u865a\u51fd\u6570\n};\nAnimal a; // \u274c \u9519\u8bef\uff0c\u4e0d\u80fd\u521b\u5efa\u62bd\u8c61\u7c7b\u5bf9\u8c61\n</code></pre> 2\ufe0f\u20e3 \u53ef\u4ee5\u4f5c\u4e3a\u57fa\u7c7b 3\ufe0f\u20e3 \u5b50\u7c7b\u5fc5\u987b\u5b9e\u73b0\u6240\u6709\u7eaf\u865a\u51fd\u6570\uff0c\u5426\u5219\u5b50\u7c7b\u4e5f\u662f\u62bd\u8c61\u7c7b</p>"},{"location":"notes/Cpp/basics/#_23","title":"\u5de5\u7a0b\u98ce\u683c\u793a\u4f8b","text":"<pre><code>class Device {\npublic:\n    virtual void init() = 0;\n    virtual void start() = 0;\n    virtual void stop() = 0;\n\n    virtual ~Device() {}   // \u5fc5\u987b\u6709\u865a\u6790\u6784\u51fd\u6570\n};\n// \u5b9e\u73b0\uff1a\nclass UART : public Device {\npublic:\n    void init() override { cout &lt;&lt; \"UART init\\n\"; }\n    void start() override { cout &lt;&lt; \"UART start\\n\"; }\n    void stop() override { cout &lt;&lt; \"UART stop\\n\"; }\n};\n// \u7136\u540e\u5728\u4e3b\u7a0b\u5e8f\u91cc\uff1a\nDevice* dev = new UART();\ndev-&gt;init();\n// \u8fd9\u5c31\u662f\uff1a\u9762\u5411\u63a5\u53e3\u7f16\u7a0b\n</code></pre>"},{"location":"notes/Cpp/basics/#_24","title":"\u7ee7\u627f","text":"<p>\u7ee7\u627f\u7684\u6838\u5fc3\u601d\u60f3\u662f\uff1a\u5982\u679c\u4e00\u4e2a\u7c7b\u662f\u53e6\u4e00\u4e2a\u7c7b\u7684\u201c\u7279\u6b8a\u60c5\u51b5\u201d\uff0c\u90a3\u5c31\u53ef\u4ee5\u7528\u7ee7\u627f\u3002 \u6bd4\u5982\uff1a \u72d7 \u662f \u52a8\u7269 \u8f66 \u662f \u4ea4\u901a\u5de5\u5177 \u5b66\u751f \u662f \u4eba <pre><code>Student is a Person\nDog is an Animal\n</code></pre> \u5728 C++ \u91cc\u5c31\u662f\uff1a <pre><code>class Student : public Person\n</code></pre></p> <p><pre><code>class C : public A\n</code></pre> \u610f\u601d\u662f\uff1a C \u7ee7\u627f A\uff0cC \u81ea\u52a8\u62e5\u6709 A \u7684\u6240\u6709 public \u6210\u5458 \u8fd9\u4e2a public \u662f\uff1a\u7ee7\u627f\u65b9\u5f0f | \u5199\u6cd5        | \u610f\u4e49                      | | --------- | ----------------------- | | public    | \u4fdd\u6301\u7236\u7c7b\u7684 public \u4ecd\u7136\u662f public | | protected | \u7236\u7c7b public \u53d8\u6210 protected  | | private   | \u7236\u7c7b public \u53d8\u6210 private    | \u5982\u679c\u4e0d\u5199 public\u9ed8\u8ba4\u662f\uff1aprivate \u7ee7\u627f</p> <p>\u597d\uff0c\u8fd9\u4e2a\u662f C++ \u9762\u5411\u5bf9\u8c61\u4e09\u5927\u7279\u6027\u4e4b\u4e00\uff1a</p> <p>\u5c01\u88c5\u3001\u7ee7\u627f\u3001\u591a\u6001</p>"},{"location":"notes/Cpp/basics/#_25","title":"\u591a\u6001","text":"<p>\u591a\u6001\uff08Polymorphism\uff09\u5b57\u9762\u610f\u601d\uff1a</p> <p>\u591a\u79cd\u5f62\u6001 \u5728 C++ \u91cc\u6307\uff1a \u540c\u4e00\u4e2a\u63a5\u53e3\uff0c\u4e0d\u540c\u5bf9\u8c61\uff0c\u8868\u73b0\u4e0d\u540c\u7684\u884c\u4e3a</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff1a <pre><code>Animal* a = new Dog();\nAnimal* b = new Cat();\n\na-&gt;speak();   // \u6c6a\nb-&gt;speak();   // \u55b5\n</code></pre> \u540c\u6837\u662f <code>speak()</code>\u4f46\u884c\u4e3a\u4e0d\u540c\u3002\u8fd9\u5c31\u662f\u591a\u6001\u3002</p>"},{"location":"notes/Cpp/basics/#_26","title":"\u5b9e\u73b0\u591a\u6001\u7684\u4e09\u4e2a\u6761\u4ef6","text":"<p>1\ufe0f\u20e3 \u7ee7\u627f 2\ufe0f\u20e3 \u865a\u51fd\u6570\uff08virtual\uff09 3\ufe0f\u20e3 \u57fa\u7c7b\u6307\u9488\u6216\u5f15\u7528\u8c03\u7528 \u7f3a\u4e00\u4e2a\u90fd\u4e0d\u662f\u771f\u6b63\u7684\u8fd0\u884c\u65f6\u591a\u6001\u3002</p>"},{"location":"notes/Cpp/basics/#_27","title":"\u5b8c\u6574\u793a\u4f8b\u4ee3\u7801","text":"<pre><code>#include &lt;iostream&gt;\nusing namespace std;\nclass Animal {\npublic:\n    virtual void speak() {     // \u865a\u51fd\u6570\n        cout &lt;&lt; \"Animal sound\" &lt;&lt; endl;\n    }\n};\nclass Dog : public Animal {\npublic:\n    void speak() override {\n        cout &lt;&lt; \"Dog: Woof\" &lt;&lt; endl;\n    }\n};\nclass Cat : public Animal {\npublic:\n    void speak() override {\n        cout &lt;&lt; \"Cat: Meow\" &lt;&lt; endl;\n    }\n};\nint main() {\n    Animal* a1 = new Dog();\n    Animal* a2 = new Cat();\n\n    a1-&gt;speak();   // \u8c03\u7528 Dog \u7684\u7248\u672c\n    a2-&gt;speak();   // \u8c03\u7528 Cat \u7684\u7248\u672c\n\n    delete a1;\n    delete a2;\n}\n</code></pre>"},{"location":"notes/Cpp/basics/#virtual","title":"\u5982\u679c\u6ca1\u6709 virtual \u4f1a\u600e\u6837\uff1f","text":"<p><pre><code>class Animal {\npublic:\n    void speak() {   // \u6ca1\u6709 virtual\n        cout &lt;&lt; \"Animal sound\" &lt;&lt; endl;\n    }\n};\n</code></pre> \u90a3\u5c31\u4f1a\u53d8\u6210\uff1a <pre><code>Animal sound\nAnimal sound\n</code></pre></p>"},{"location":"notes/Cpp/basics/#_28","title":"\u591a\u6001\u5206\u4e24\u79cd","text":"<ol> <li>\u7f16\u8bd1\u65f6\u591a\u6001\uff08\u9759\u6001\u591a\u6001\uff09</li> <li>\u51fd\u6570\u91cd\u8f7d</li> <li>\u8fd0\u7b97\u7b26\u91cd\u8f7d</li> <li> <p>\u6a21\u677f \u4f8b\u5b50\uff1a <pre><code>int add(int a, int b);\ndouble add(double a, double b);\n</code></pre> \u7f16\u8bd1\u65f6\u5c31\u786e\u5b9a\u8c03\u7528\u54ea\u4e2a\u3002</p> </li> <li> <p>\u8fd0\u884c\u65f6\u591a\u6001\uff08\u52a8\u6001\u591a\u6001\uff09</p> </li> <li>\u901a\u8fc7 virtual \u5b9e\u73b0</li> <li>\u901a\u8fc7\u57fa\u7c7b\u6307\u9488\u8c03\u7528</li> </ol>"},{"location":"notes/Cpp/basics/#_29","title":"\u5e95\u5c42\u539f\u7406","text":"<p>\u591a\u6001\u9760\u7684\u662f\uff1a</p> <p>\u865a\u51fd\u6570\u8868\uff08vtable\uff09</p> <p>\u6bcf\u4e2a\u6709 virtual \u7684\u7c7b\u90fd\u4f1a\u6709\uff1avtable \u5bf9\u8c61\u5185\u90e8\u5b58\u4e00\u4e2a\uff1avptr\uff08\u6307\u5411\u865a\u51fd\u6570\u8868\u7684\u6307\u9488\uff09 \u5f53\u4f60\u8c03\u7528\uff1aa-&gt;speak(); \u5b9e\u9645\u6d41\u7a0b\u662f\uff1a \u901a\u8fc7 vptr \u627e\u5230 vtable \u2192 \u627e\u5230\u51fd\u6570\u5730\u5740 \u2192 \u8c03\u7528\u771f\u6b63\u51fd\u6570 Dog::speak()</p> <p>\u8fd9\u5c31\u662f\u52a8\u6001\u7ed1\u5b9a\uff08Dynamic Binding\uff09\u3002</p>"},{"location":"notes/Cpp/basics/#_30","title":"\u591a\u6001\u7684\u597d\u5904\uff08\u5de5\u7a0b\u89d2\u5ea6\uff09","text":"<p>\u5728\u4f60\u4ee5\u540e\u505a\u5d4c\u5165\u5f0f\u67b6\u6784\u65f6\uff1a \u5047\u8bbe\u4f60\u505a\uff1a * UART \u9a71\u52a8 * SPI \u9a71\u52a8 * CAN \u9a71\u52a8 \u4f60\u53ef\u4ee5\uff1a <pre><code>Device* dev = new UART();\ndev-&gt;init();\n</code></pre> \u4e3b\u7a0b\u5e8f\u6839\u672c\u4e0d\u5173\u5fc3\u5177\u4f53\u662f\u4ec0\u4e48\u8bbe\u5907\u3002 \u8fd9\u53eb\uff1a</p> <p>\u9762\u5411\u63a5\u53e3\u7f16\u7a0b</p>"},{"location":"notes/Cpp/basics/#_31","title":"\u4ec0\u4e48\u662f\u591a\u6001\uff1f","text":"<p>\u591a\u6001\u662f\u6307\u540c\u4e00\u63a5\u53e3\u5728\u4e0d\u540c\u5bf9\u8c61\u4e0a\u8868\u73b0\u51fa\u4e0d\u540c\u7684\u884c\u4e3a\u3002\u5728 C++ \u4e2d\u901a\u5e38\u901a\u8fc7\u7ee7\u627f\u548c\u865a\u51fd\u6570\u5b9e\u73b0\u8fd0\u884c\u65f6\u591a\u6001\uff0c\u4f9d\u8d56\u865a\u51fd\u6570\u8868\u8fdb\u884c\u52a8\u6001\u7ed1\u5b9a\u3002</p>"},{"location":"notes/Cpp/basics/#_32","title":"\u5341\u3001\u548c\u62bd\u8c61\u7c7b\u7684\u5173\u7cfb","text":"<p>\u62bd\u8c61\u7c7b\u901a\u5e38\u7528\u6765\u5b9e\u73b0\u591a\u6001\u3002</p> <p>\u6d41\u7a0b\u662f\uff1a</p> <pre><code>\u62bd\u8c61\u7c7b\u5b9a\u4e49\u63a5\u53e3\n\u2193\n\u5b50\u7c7b\u5b9e\u73b0\u63a5\u53e3\n\u2193\n\u57fa\u7c7b\u6307\u9488\u8c03\u7528\n\u2193\n\u4ea7\u751f\u591a\u6001\n</code></pre>"},{"location":"notes/Cpp/code/","title":"Code","text":""},{"location":"notes/Cpp/code/#_1","title":"<p>\u5bf9\u4e8e\u4e00\u4e2as[i]='3'\u7684\u5b57\u7b26\uff0c\u60f3\u8981\u5f97\u5230\u5b83\u5bf9\u5e94\u7684\u6574\u65703\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u6cd5  <pre><code>int x = s[i] - '0';\n</code></pre> <pre><code>isdigit(c) // \u5224\u65ad\u5b57\u7b26 c \u662f\u5426\u4e3a\u6570\u5b57\u5b57\u7b26\uff080-9\uff09\uff0c\u8fd4\u56de\u4e00\u4e2a\u975e\u96f6\u503c\uff08true\uff09\u5982\u679c\u662f\u6570\u5b57\uff0c\u5426\u5219\u8fd4\u56de 0\uff08false\uff09 \nisalpha(c) // \u5224\u65ad\u5b57\u7b26 c \u662f\u5426\u4e3a\u5b57\u6bcd\u5b57\u7b26\uff08a-z \u6216 A-Z\uff09\uff0c\u8fd4\u56de\u4e00\u4e2a\u975e\u96f6\u503c\uff08true\uff09\u5982\u679c\u662f\u5b57\u6bcd\uff0c\u5426\u5219\u8fd4\u56de 0\uff08false\uff09 \nisspace(c) // \u5224\u65ad\u5b57\u7b26 c \u662f\u5426\u4e3a\u7a7a\u767d\u5b57\u7b26\uff08\u7a7a\u683c\u3001\u5236\u8868\u7b26\u3001\u6362\u884c\u7b26\u7b49\uff09\uff0c\u8fd4\u56de\u4e00\u4e2a\u975e\u96f6\u503c\uff08true\uff09\u5982\u679c\u662f\u7a7a\u767d\u5b57\u7b26\uff0c\u5426\u5219\u8fd4\u56de 0\uff08false\uff09 \ntolower(c) // \u5c06\u5b57\u7b26 c \u8f6c\u6362\u4e3a\u5c0f\u5199\u5b57\u6bcd\uff0c\u5982\u679c c \u662f\u5927\u5199\u5b57\u6bcd\u5219\u8f6c\u6362\uff0c\u5426\u5219\u8fd4\u56de c \u672c\u8eab \ntoupper(c) // \u5c06\u5b57\u7b26 c \u8f6c\u6362\u4e3a\u5927\u5199\u5b57\u6bcd\uff0c\u5982\u679c c \u662f\u5c0f\u5199\u5b57\u6bcd\u5219\u8f6c\u6362\uff0c\u5426\u5219\u8fd4\u56de c \u672c\u8eab ```\n</code></pre></p>","text":""},{"location":"notes/Cpp/code/#_2","title":"\u5b57\u7b26\u4e32 <pre><code>string s1 ;//\u521b\u5efa\u4e00\u4e2a\u7a7a\u5b57\u7b26\u4e32\nstring  s2 = \"hello\"; //\u521b\u5efa\u4e00\u4e2a\u5b57\u7b26\u4e32\u5e76\u521d\u59cb\u5316\ns1.reserve(s2.size()); //\u9884\u5206\u914d(s2.size())\u4e2a\u5b57\u7b26\u7684\u7a7a\u95f4\ns1.push_back('h'); //\u5728\u5b57\u7b26\u4e32\u672b\u5c3e\u6dfb\u52a0\u4e00\u4e2a\u5b57\u7b26\ns1+= \"ello\"; //\u5728\u5b57\u7b26\u4e32\u672b\u5c3e\u6dfb\u52a0\u4e00\u4e2a\u5b57\u7b26\u4e32\ncout &lt;&lt; sizeof(s) &lt;&lt; endl;//\u8f93\u51fa\u5b57\u7b26\u4e32\u5bf9\u8c61\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f\n//\u53d6\u524d n \u4e2a\u5b57\u7b26\u53d6\u540e n \u4e2a\u5b57\u7b26\nstring s = \"ABCDEFG\";\nstring first3 = s.substr(0, 3);   // \"ABC\"\nstring last3 = s.substr(s.size() - 3, 3);  // \"EFG\"\ns.erase(2, 3);   // \u4ece\u4e0b\u68072\u5f00\u59cb\u52203\u4e2a// \u7ed3\u679c\uff1a \"ABFG\"\ns.erase(n);   // \u4fdd\u7559\u524d n \u4e2a\u5b57\u7b26\uff0c\u5220\u9664\u5269\u4f59\u7684\ns.empty();   // \u5224\u65ad\u5b57\u7b26\u4e32\u662f\u5426\u4e3a\u7a7a\uff0cbool\u7c7b\u578b\ns.clear();   // \u6e05\u7a7a\u5b57\u7b26\u4e32\nfor (char c : s) // \u7528char c\u904d\u5386\u5b57\u7b26\u4e32s\u4e2d\u7684\u6bcf\u4e2a\u5b57\u7b26\nreverse(s.begin(), s.end());      // \u53cd\u8f6c\u5b57\u7b26\nreverse(words.begin(), words.end()); // \u53cd\u8f6c\u5b57\u7b26\u4e32\u987a\u5e8f\u3002\u5176\u4e2dwords\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u6570\u7ec4vector&lt;string&gt; words\n\nauto it = s.begin();// \u83b7\u53d6\u5b57\u7b26\u4e32\u7684\u8fed\u4ee3\u5668\uff0c\u6307\u5411\u5b57\u7b26\u4e32\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26 \n// \u7b49\u4ef7\u4e8e\nstd::string::iterator it;\n\ns.insert(it, 'X'); // \u5728\u5b57\u7b26\u4e32\u5f00\u5934\u63d2\u5165\u5b57\u7b26 'X'\ns.insert(pos, count, 'c');// \u5728\u5b57\u7b26\u4e32\u7684 pos \u4f4d\u7f6e\u63d2\u5165 count \u4e2a\u5b57\u7b26 c;\u53ea\u6709string\u7c7b\u6709\u8fd9\u4e2a\u91cd\u8f7d\u7248\u672c\uff0c\u5176\u4ed6\u5bb9\u5668\u6ca1\u6709\ns.find('o', pos); // \u67e5\u627e\u5b57\u7b26 'o' \u7684\u4f4d\u7f6e\uff0c\u4ece pos \u5f00\u59cb\u67e5\u627e\uff0c\u8fd4\u56de\u7b2c\u4e00\u4e2a\u5339\u914d\u7684\u7d22\u5f15\uff0c\u5982\u679c\u6ca1\u6709\u627e\u5230\u5219\u8fd4\u56de string::npos\ns.append(count, 'c'); // \u5728\u5b57\u7b26\u4e32\u672b\u5c3e\u6dfb\u52a0 count \u4e2a\u5b57\u7b26 c;\u53ea\u6709string\u7c7b\u6709\u8fd9\u4e2a\u91cd\u8f7d\u7248\u672c\uff0c\u5176\u4ed6\u5bb9\u5668\u6ca1\u6709\ns.back()//back() \u662f\uff1avector\uff0cstring\uff0cdeque\u7684\u6210\u5458\u51fd\u6570\uff0c\u8fd4\u56de\u4e00\u4e2a\u5f15\u7528\uff0c\u6307\u5411\u5bb9\u5668\u4e2d\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff08\u6808\u9876\uff09\nst.empty()//empty() \u662f\uff1avector\uff0cstring\uff0cdeque\uff0cset\uff0cmap\uff0cunordered_set\uff0cunordered_map\u7684\u6210\u5458\u51fd\u6570\uff0c\u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u8868\u793a\u5bb9\u5668\u662f\u5426\u4e3a\u7a7a\n</code></pre>","text":""},{"location":"notes/Cpp/code/#_3","title":"\u5faa\u73af <pre><code>vector&lt;int&gt; candies(5, 10); // \u521b\u5efa\u4e00\u4e2a\u957f\u5ea6\u4e3a 5 \u7684\u6570\u7ec4\uff0c\u6bcf\u4e2a\u5143\u7d20\u90fd\u521d\u59cb\u5316\u4e3a 10\nfor (int x : candies){}\u628a candies \u91cc\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\uff0c\u4f9d\u6b21\u53d6\u51fa\u6765\uff0c\u8d4b\u7ed9 x\n\nstring::iterator it;\nfor (auto it = s.begin(); it != s.end(); ++it) {\n    cout &lt;&lt; *it &lt;&lt; endl;}\n//\u7b49\u4ef7\u4e8e\nfor (int i = 0; i &lt; s.size(); i++) {\n    cout &lt;&lt; s[i] &lt;&lt; endl;}\n</code></pre>","text":""},{"location":"notes/Cpp/code/#_4","title":"\u5bb9\u5668\u9009\u62e9 <p>\u53ea\u6709\u4e00\u4e2a\u63a5\u53e3\u7684\u5bb9\u5668\u7528push/pop\uff0c\u5176\u4ed6\u7684\u7528push_back\u548cpop_back \u51e0\u4e4e\u6240\u6709\u7684\u5bb9\u5668\u90fd\u6709empty\u548csize\u51fd\u6570\uff0c\u53ea\u6709vector\uff0cstring\uff0cdeque\u6709capacity\u51fd\u6570 \u8fde\u7eed\u7ebf\u6027\u7ed3\u6784 \u2192 front/back\uff0c\u62bd\u8c61\u7ed3\u6784 \u2192 top\uff0c\u6811 / \u54c8\u5e0c \u2192 begin/end</p> <p>stack&lt;&gt;\u9002\u5408\uff1a\u9700\u8981\u9891\u7e41\u5728\u672b\u5c3e\u6dfb\u52a0/\u5220\u9664\u5143\u7d20\u7684\u573a\u666f\uff0c\u4e14\u53ea\u9700\u8981\u8bbf\u95ee\u6808\u9876\u5143\u7d20\u3002 \u5934\u6587\u4ef6<code>&lt;stack&gt;</code>\uff0c\u5e95\u5c42\u901a\u5e38\u4f7f\u7528 <code>deque</code> \u5b9e\u73b0\uff0c\u63d0\u4f9b\u4e86 <code>push</code>\u3001<code>pop</code> \u548c <code>top</code> \u7b49\u6210\u5458\u51fd\u6570\u3002 queue&lt;&gt;\u9002\u5408\uff1a\u53ea\u80fd\u5148\u8fdb\u5148\u51fa\uff08FIFO\uff09\u5934\u6587\u4ef6<code>&lt;queue&gt;</code>\uff0c\u5e95\u5c42\u901a\u5e38\u4f7f\u7528 <code>deque</code> \u5b9e\u73b0\uff0c\u63d0\u4f9b\u4e86 <code>push</code>\u3001<code>pop</code> \u548c <code>front</code> \u7b49\u6210\u5458\u51fd\u6570\u3002  priority_queue&lt;&gt;\u9002\u5408\uff1a\u9700\u8981\u6309\u7167\u4f18\u5148\u7ea7\u8bbf\u95ee\u5143\u7d20\u7684\u573a\u666f\u3002\u5934\u6587\u4ef6<code>&lt;queue&gt;</code>\uff0c\u5e95\u5c42\u901a\u5e38\u4f7f\u7528\u5806\uff08heap\uff09\u5b9e\u73b0\uff0c\u63d0\u4f9b\u4e86 <code>push</code>\u3001<code>pop</code> \u548c <code>top</code> \u7b49\u6210\u5458\u51fd\u6570\u3002 deque&lt;&gt;\u9002\u5408\uff1a\u9700\u8981\u9891\u7e41\u5728\u4e24\u7aef\u6dfb\u52a0/\u5220\u9664\u5143\u7d20\u7684\u573a\u666f\uff0c\u4e14\u9700\u8981\u9891\u7e41\u8bbf\u95ee\u5143\u7d20\u7684\u573a\u666f\u3002\u5934\u6587\u4ef6<code>&lt;deque&gt;</code>\uff0c\u5e95\u5c42\u4f7f\u7528\u53cc\u7aef\u961f\u5217\u5b9e\u73b0\uff0c\u63d0\u4f9b\u4e86 <code>push_back</code>\u3001<code>push_front</code>\u3001<code>pop_back</code>\u3001<code>pop_front</code> \u7b49\u6210\u5458\u51fd\u6570\u3002 vector&lt;&gt;\u9002\u5408\uff1a\u9700\u8981\u9891\u7e41\u8bbf\u95ee\u5143\u7d20\u7684\u573a\u666f\uff0c\u4e14\u4e0d\u9700\u8981\u9891\u7e41\u5728\u4e2d\u95f4\u6dfb\u52a0/\u5220\u9664\u5143\u7d20\u3002 deque&lt;&gt;\u9002\u5408\uff1a\u9700\u8981\u9891\u7e41\u5728\u4e24\u7aef\u6dfb\u52a0/\u5220\u9664\u5143\u7d20\u7684\u573a\u666f\uff0c\u4e14\u9700\u8981\u9891\u7e41\u8bbf\u95ee\u5143\u7d20\u7684\u573a\u666f\u3002 \u5934\u6587\u4ef6<code>&lt;vector&gt;</code>\uff0c\u5e95\u5c42\u4f7f\u7528\u52a8\u6001\u6570\u7ec4\u5b9e\u73b0\uff0c\u63d0\u4f9b\u4e86 <code>push_back</code>\u3001<code>pop_back</code> \u7b49\u6210\u5458\u51fd\u6570\uff0c\u5e76\u4e14\u652f\u6301\u968f\u673a\u8bbf\u95ee\u3002 list&lt;&gt;\u9002\u5408\uff1a\u9700\u8981\u9891\u7e41\u5728\u4e2d\u95f4\u6dfb\u52a0/\u5220\u9664\u5143\u7d20\u7684\u573a\u666f\uff0c\u4e14\u4e0d\u9700\u8981\u9891\u7e41\u8bbf\u95ee\u5143\u7d20\u7684\u573a\u666f\u3002\u5934\u6587\u4ef6<code>&lt;list&gt;</code>\uff0c\u5e95\u5c42\u4f7f\u7528\u53cc\u5411\u94fe\u8868\u5b9e\u73b0\uff0c\u63d0\u4f9b\u4e86 <code>push_back</code>\u3001<code>push_front</code>\u3001<code>pop_back</code>\u3001<code>pop_front</code> \u7b49\u6210\u5458\u51fd\u6570\uff0c\u5e76\u4e14\u652f\u6301\u53cc\u5411\u8fed\u4ee3\u5668\u3002 set&lt;&gt;\u9002\u5408\uff1a\u9700\u8981\u5b58\u50a8\u552f\u4e00\u5143\u7d20\u5e76\u8fdb\u884c\u5feb\u901f\u67e5\u627e\u7684\u573a\u666f\u3002\u5934\u6587\u4ef6<code>&lt;set&gt;</code>\uff0c\u5e95\u5c42\u4f7f\u7528\u7ea2\u9ed1\u6811\u5b9e\u73b0\uff0c\u63d0\u4f9b\u4e86 <code>insert</code>\u3001<code>erase</code>\u3001<code>find</code> \u7b49\u6210\u5458\u51fd\u6570\uff0c\u5e76\u4e14\u81ea\u52a8\u6392\u5e8f\u5143\u7d20\u3002  map&lt;&gt;\u9002\u5408\uff1a\u9700\u8981\u5b58\u50a8\u952e\u503c\u5bf9\u5e76\u8fdb\u884c\u5feb\u901f\u67e5\u627e\u7684\u573a\u666f\u3002\u5934\u6587\u4ef6<code>&lt;map&gt;</code>\uff0c\u5e95\u5c42\u4f7f\u7528\u7ea2\u9ed1\u6811\u5b9e\u73b0\uff0c\u63d0\u4f9b\u4e86 <code>insert</code>\u3001<code>erase</code>\u3001<code>find</code> \u7b49\u6210\u5458\u51fd\u6570\uff0c\u5e76\u4e14\u81ea\u52a8\u6392\u5e8f\u952e\u503c\u5bf9\u3002 unordered_set&lt;&gt;\u9002\u5408\uff1a\u9700\u8981\u5b58\u50a8\u552f\u4e00\u5143\u7d20\u5e76\u8fdb\u884c\u5feb\u901f\u67e5\u627e\u7684\u573a\u666f\uff0c\u4f46\u4e0d\u5173\u5fc3\u5143\u7d20\u7684\u987a\u5e8f\u3002 \u5934\u6587\u4ef6<code>&lt;unordered_set&gt;</code>\uff0c\u5e95\u5c42\u4f7f\u7528\u54c8\u5e0c\u8868\u5b9e\u73b0\uff0c\u63d0\u4f9b\u4e86 <code>insert</code>\u3001<code>erase</code>\u3001<code>find</code> \u7b49\u6210\u5458\u51fd\u6570\uff0c\u5e76\u4e14\u4e0d\u4fdd\u8bc1\u5143\u7d20\u7684\u987a\u5e8f\u3002 unordered_map&lt;&gt;\u9002\u5408\uff1a\u9700\u8981\u5b58\u50a8\u952e\u503c\u5bf9\u5e76\u8fdb\u884c\u5feb\u901f\u67e5\u627e\u7684\u573a\u666f\uff0c\u4f46\u4e0d\u5173\u5fc3\u952e\u503c\u5bf9\u7684\u987a\u5e8f\u3002\u5934\u6587\u4ef6<code>&lt;unordered_map&gt;</code>\uff0c\u5e95\u5c42\u4f7f\u7528\u54c8\u5e0c\u8868\u5b9e\u73b0\uff0c\u63d0\u4f9b\u4e86 <code>insert</code>\u3001<code>erase</code>\u3001<code>find</code> \u7b49\u6210\u5458\u51fd\u6570\uff0c\u5e76\u4e14\u4e0d\u4fdd\u8bc1\u952e\u503c\u5bf9\u7684\u987a\u5e8f\u3002  bitset&lt;&gt;\u9002\u5408\uff1a\u9700\u8981\u5b58\u50a8\u5927\u91cf\u5e03\u5c14\u503c\u5e76\u8fdb\u884c\u4f4d\u64cd\u4f5c\u7684\u573a\u666f\u3002\u5934\u6587\u4ef6<code>&lt;bitset&gt;</code>\uff0c\u5e95\u5c42\u4f7f\u7528\u56fa\u5b9a\u5927\u5c0f\u7684\u4f4d\u6570\u7ec4\u5b9e\u73b0\uff0c\u63d0\u4f9b\u4e86 <code>set</code>\u3001<code>reset</code>\u3001<code>test</code> \u7b49\u6210\u5458\u51fd\u6570\uff0c\u5e76\u4e14\u652f\u6301\u4f4d\u64cd\u4f5c\u3002</p> <p>vector nums; // \u521b\u5efa\u4e00\u4e2a\u5b58\u50a8\u6574\u6570\u7684\u52a8\u6001\u6570\u7ec4 vector nums;   // \u274c \u975e\u6cd5\uff0c\u4e0d\u77e5\u9053\u88c5\u4ec0\u4e48\u7c7b\u578b vector\u4e0d\u662f\u4e00\u4e2a\u666e\u901a\u7684\u7c7b\uff0c\u800c\u662f\u4e00\u4e2a\u6a21\u677f\u7c7btemplate ;class vector { ... }; unordered_map \u662f\u4e00\u4e2a \u201c\u53cc\u6a21\u677f\u53c2\u6570\u201d\u7684\u6a21\u677f\u7c7b template \u5b83\u662f\u4e00\u4e2a \u54c8\u5e0c\u8868\uff08hash table\uff09\uff0c\u672c\u8d28\u662f\uff1a\u952e \u2192 \u503c\uff08key \u2192 value\uff09 unordered_set \u662f\u4e00\u4e2a \u201c\u5355\u6a21\u677f\u53c2\u6570\u201d\u7684\u6a21\u677f\u7c7b template \u5b83\u662f\u4e00\u4e2a \u54c8\u5e0c\u96c6\u5408\uff08hash set\uff09\uff0c\u672c\u8d28\u662f\uff1a\u5143\u7d20 \u2192 \u5b58\u5728\u4e0e\u5426\uff08element \u2192 existence\uff09 bitset \u4e0d\u4f1a\u52a8\u6001\u6269\u5bb9\uff0c\u53ea\u80fd\u5728\u7f16\u8bd1\u65f6\u6307\u5b9a\u5927\u5c0f template  \u662f\u4e00\u4e32\u56fa\u5b9a\u957f\u5ea6\u7684 0/1 \u4f4d <pre><code>#include &lt;unordered_set&gt;\nusing namespace std;\n\nvector&lt;int&gt; nums; // \u521b\u5efa\u4e00\u4e2a\u5b58\u50a8\u6574\u6570\u7684\u52a8\u6001\u6570\u7ec4\uff0cvector\u6ca1\u6709count\u548cfind\u51fd\u6570\nunordered_set&lt;char&gt; us ={'a','e','i','o','u','A','E','I','O','U'};// \u521d\u59cb\u5316\u5217\u8868 \u4e0d\u4f1a\u81ea\u52a8\u6392\u5e8f\nunordered_set&lt;int&gt; s(nums.begin(), nums.end());// \u901a\u8fc7\u8fed\u4ee3\u5668\u8303\u56f4\u6784\u9020\u4e00\u4e2a unordered_set\uff0c\u5305\u542b nums \u4e2d\u7684\u6240\u6709\u5143\u7d20\nunordered_map&lt;string, int&gt; cnt = {{\"apple\", 2},{\"banana\", 3}};// \u521d\u59cb\u5316\u5217\u8868 \u4e0d\u4f1a\u81ea\u52a8\u6392\u5e8f\nunordered_map&lt;int, int&gt; mp = {{1, 10},{2, 20},{5, 50}};// \u521d\u59cb\u5316\u5217\u8868 \u4e0d\u4f1a\u81ea\u52a8\u6392\u5e8f \uff0c\u54c8\u5e0c\u8868\u5728\u521b\u5efa\u65f6value\u7684\u503c\u4e0d\u786e\u5b9a\uff0c\u8bbf\u95ee\u65f6\u4f1a\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u9ed8\u8ba4\u503c\uff080\uff09\u5e76\u8fd4\u56de\u5b83\nset&lt;int&gt; s = {5, 1, 3, 2};// \u521d\u59cb\u5316set \u5143\u7d20\u4f1a\u81ea\u52a8\u6392\u5e8f\uff0c\u81ea\u52a8\u6392\u5e8f\u540e\uff1a{1,2,3,5}\nmap&lt;int, string&gt; mp2 = {{1, \"one\"},{3, \"three\"},{2, \"two\"}};// \u521d\u59cb\u5316\u5217\u8868\uff0c\u5143\u7d20\u4f1a\u81ea\u52a8\u6392\u5e8f\uff0c\u81ea\u52a8\u6392\u5e8f\u540e\uff1a{1: \"one\", 2: \"two\", 3: \"three\"}\nbitset&lt;8&gt; bs(\"10101010\"); // \u521b\u5efa\u4e00\u4e2a\u957f\u5ea6\u4e3a 8 \u7684 bitset\uff0c\u5e76\u7528\u5b57\u7b26\u4e32 \"10101010\" \u521d\u59cb\u5316\u5b83\nbs.set(); // \u5c06 bitset \u4e2d\u7684\u6240\u6709\u4f4d\u8bbe\u7f6e\u4e3a 1\nbs.reset(); // \u5c06 bitset \u4e2d\u7684\u6240\u6709\u4f4d\u91cd\u7f6e\u4e3a 0\nbs.test(i);   // \u67e5\u770b\u7b2c i \u4f4d\u662f\u5426\u4e3a 1\uff0c\u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\nmp[5] = 10;// \u8bbf\u95ee mp \u4e2d\u952e\u4e3a 5 \u7684\u503c\uff0c\u5e76\u628a\u503c\u8bbe\u4e3a10\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5219\u521b\u5efa\u4e00\u4e2a\u9ed8\u8ba4\u503c\uff080\uff09\u5e76\u8fd4\u56de\u5b83\uff0c\n\nfor (auto&amp; p : mp) {s.insert(p.first);s.insert(p.second);}// \u904d\u5386 mp \u4e2d\u7684\u6bcf\u4e2a\u952e\u503c\u5bf9 p\uff0c\u5c06\u952e p.first \u548c\u503c p.second \u63d2\u5165\u5230 set s \u4e2d\n\nfor (int x : s) {/*\u4ece\u5c0f\u5230\u5927*/}// \u904d\u5386 set\n\nif (mp.count(5)) {int v = mp[5];}// \u67e5\u627e mp \u4e2d\u662f\u5426\u5b58\u5728\u952e\u4e3a 5 \u7684\u5143\u7d20\uff0c\u5982\u679c\u5b58\u5728\u5219\u8fd4\u56de 1\uff0c\u5426\u5219\u8fd4\u56de 0\uff1b\u5982\u679c\u5b58\u5728\u5219\u8bbf\u95ee mp[5] \u7684\u503c\u5e76\u8d4b\u7ed9 v\nif (us.count('a')) {}// \u67e5\u627e\nauto it = us.find('a');// \u67e5\u627e us \u4e2d\u662f\u5426\u5b58\u5728\u5143\u7d20 'a'\uff0c\u5982\u679c\u5b58\u5728\u5219\u8fd4\u56de\u4e00\u4e2a\u6307\u5411\u8be5\u5143\u7d20\u7684\u8fed\u4ee3\u5668\uff0c\u5426\u5219\u8fd4\u56de us.end()\n\nus.insert('b');// \u63d2\u5165\u5143\u7d20 'b' \u5230 us \u4e2d\uff0c\u5982\u679c 'b' \u5df2\u7ecf\u5b58\u5728\u5219\u4e0d\u63d2\u5165\nus.erase('a');// \u5220\u9664\u5143\u7d20 'a' \u4ece us \u4e2d\uff0c\u5982\u679c 'a' \u4e0d\u5b58\u5728\u5219\u4e0d\u6267\u884c\u4efb\u4f55\u64cd\u4f5c\n\nauto it = find(nums.begin(), nums.end(), 3);// \u5728 v \u4e2d\u67e5\u627e\u5143\u7d20 3\uff0c\u8fd4\u56de\u4e00\u4e2a\u6307\u5411\u7b2c\u4e00\u4e2a\u5339\u914d\u5143\u7d20\u7684\u8fed\u4ee3\u5668\uff0c\u5982\u679c\u6ca1\u6709\u627e\u5230\u5219\u8fd4\u56de v.end()\nint c = count(nums.begin(), nums.end(), 3);// \u7edf\u8ba1 v \u4e2d\u5143\u7d20 3 \u51fa\u73b0\u7684\u6b21\u6570\uff0c\u8fd4\u56de\u4e00\u4e2a\u6574\u6570\nsort(nums.begin(), nums.end());// \u6392\u5e8f\uff0c\u6392\u5e8f\u540e nums \u4e2d\u7684\u5143\u7d20\u5c06\u6309\u7167\u4ece\u5c0f\u5230\u5927\u7684\u987a\u5e8f\u6392\u5217\nsort(nums.begin(), nums.end(), greater&lt;int&gt;());// \u6392\u5e8f\uff0c\u6392\u5e8f\u540e nums \u4e2d\u7684\u5143\u7d20\u5c06\u6309\u7167\u4ece\u5927\u5230\u5c0f\u7684\u987a\u5e8f\u6392\u5217\nauto it = max_element(nums.begin(), nums.end());// \u67e5\u627e v \u4e2d\u7684\u6700\u5927\u5143\u7d20\uff0c\u8fd4\u56de\u4e00\u4e2a\u6307\u5411\u6700\u5927\u5143\u7d20\u7684\u8fed\u4ee3\u5668 *it \u662f\u6700\u5927\u5143\u7d20\u7684\u503c\n</code></pre> \u7ea2\u9ed1\u6811\u662f\u4e00\u79cd\u201c\u81ea\u5df1\u4f1a\u4fdd\u6301\u5e73\u8861\u7684\u4e8c\u53c9\u641c\u7d22\u6811\u201d\u5b83\u4fdd\u8bc1\uff1a\u67e5\u627e / \u63d2\u5165 / \u5220\u9664\u6c38\u8fdc\u662f O(log n)","text":""},{"location":"notes/FPGA/basics/","title":"\u57fa\u7840\u77e5\u8bc6","text":"<p># FPGA \u5b66\u4e60\u7b14\u8bb0</p> <p>## \u57fa\u672c\u6982\u5ff5</p> <p>- LUT</p> <p>- Flip-Flop</p> <p>- \u65f6\u5e8f\u903b\u8f91 vs \u7ec4\u5408\u903b\u8f91</p> <p>## \u5de5\u5177</p> <p>- Quartus</p> <p>- Vivado</p>"},{"location":"notes/arduino/basics/","title":"Basics","text":"<ol> <li> <p>\u5728 AVR \u91cc\uff0c\u4e00\u4e2a\u7aef\u53e3\uff08\u6bd4\u5982 PORTB\uff09\u901a\u5e38\u6709\u4e09\u7c7b\u5bc4\u5b58\u5668\uff1a</p> <p>DDRB\uff1a\u65b9\u5411\u5bc4\u5b58\u5668\uff0c1=\u8f93\u51fa\uff0c0=\u8f93\u5165</p> <p>PORTB\uff1a\u8f93\u51fa\u5bc4\u5b58\u5668\uff08\u5f53\u662f\u8f93\u51fa\u65f6\u5199 1/0 \u5c31\u662f\u9ad8/\u4f4e\u7535\u5e73\uff1b\u5f53\u662f\u8f93\u5165\u65f6\u5199 1 \u4f1a\u5f00\u4e0a\u62c9\uff09</p> <p>PINB\uff1a\u8bfb\u5f15\u811a\u7535\u5e73\uff08\u4e5f\u5e38\u7528\u4e8e\u67d0\u4e9b\u201c\u5199 1 \u7ffb\u8f6c\u201d\u7279\u6027\uff0c\u4f46\u5148\u522b\u6df7\u7528\uff09</p> <p>AVR C \u91cc\u65e0\u9650\u5faa\u73af\u5c31\u662f\uff1awhile (1) { ... } \u6765\u81ea  <p>_delay_ms(x) \u6765\u81ea \uff0c\u5355\u4f4d ms <li> <p>\u7f6e\u9ad8/\u7f6e\u4f4e\uff1a</p> <p>\u9ad8\uff1aPORTB |= (1&lt;&lt;7); \u4f4e\uff1aPORTB &amp;= ~(1&lt;&lt;7);</p> </li> <li> <p>Timer = \u4e00\u4e2a\u4f1a\u81ea\u52a8\u52a0 1 \u7684\u8ba1\u6570\u5668 + \u4e00\u5806\u63a7\u5236\u5b83\u7684\u201c\u5f00\u5173\u5bc4\u5b58\u5668</p> <p><code>TCCR2A</code>, <code>TCCR2B</code> \u63a7\u5236\u5bc4\u5b58\u5668 \u51b3\u5b9a Timer \u600e\u4e48\u6570  </p> <p>\u8ba1\u6570\u5bc4\u5b58\u5668 \u73b0\u5728\u6570\u5230\u51e0\u4e86       <code>TCNT2</code> \u4f8b\u5982 TCNT2 = 6; Timer2 \u662f 8-bit\uff080 ~ 255\uff09 \u5b83\u4f1a6 \u2192 7 \u2192 8 \u2192 ... \u2192 255 \u2192 0\uff08\u6ea2\u51fa\uff09 \u6ea2\u51fa\u662f\u4ec0\u4e48\u610f\u601d\uff1f\u5f53\u5b83\u4ece 255 \u518d +1 \u56de\u5230 0\uff0c\u786c\u4ef6\u4f1a\uff1a\u628a TOV2 = 1</p> <p>\u72b6\u6001/\u6807\u5fd7  \u6709\u6ca1\u6709\u201c\u51fa\u4e8b\u201d\uff08\u6ea2\u51fa\uff09   <code>TIFR2</code>\uff08\u91cc\u7684 <code>TOV2</code>\uff09  TIFR2\uff08Timer Interrupt Flag Register\uff09 \u2014\u2014 Timer2 \u7684\u201c\u72b6\u6001\u6307\u793a\u706f\u9762\u677f\u201d \u5b83\u91cc\u9762\u6bcf\u4e00\u4f4d\u8868\u793a\uff1a\u67d0\u4ef6\u4e8b\u6709\u6ca1\u6709\u53d1\u751f\u8fc7 TOV2 \u2014\u2014 \u6ea2\u51fa\u6807\u5fd7</p> <p>CS22    CS21    CS20    Clock Select \u65f6\u949f\u9009\u62e9 \u51b3\u5b9a Timer \u6570\u5f97\u591a\u5feb | CS22  | CS21  | CS20  |  \u542b\u4e49          | | ----- | ----- | ----- | -------------- | | 0     | 0     | 0     | \u4e0d\u6570\uff08\u505c\uff09      | | 0     | 0     | 1     | \u4e0d\u5206\u9891\uff0816 MHz\uff09| | 0     | 1     | 0     | /8             | | 0     | 1     | 1     | /32            | | 1     | 0     | 0     | /64            | | 1     | 1     | 0     | /256           | | 1     | 1     | 1     | /1024          |</p> </li>"},{"location":"notes/arduino/projet/code/","title":"include","text":""},{"location":"notes/arduino/projet/code/#include_1","title":"include  <p>/*   ====================== \u786c\u4ef6\u8fde\u63a5\u8bf4\u660e\uff08Arduino Mega2560\uff09======================   I2C SDA -&gt; D20   I2C SCL -&gt; D21   \u7535\u673a\u65b9\u5411 DIR -&gt; D8   \u7535\u673a\u4f7f\u80fd EN(PWM) -&gt; D9   \uff08PWM \u63a7\u5236\u7535\u673a\u901f\u5ea6/\u529b\u77e9\uff0c0~255\uff09   \u7f16\u7801\u5668 A -&gt; D2   \u7f16\u7801\u5668 B -&gt; D3   ===========================================================================</p> <p>\u672c\u7a0b\u5e8f\u76ee\u6807\uff1a   1) \u8bfb\u53d6\u6e29\u5ea6\u4f20\u611f\u5668\uff08MPL3115A2\uff09\u7684\u6e29\u5ea6 T   2) \u628a\u6e29\u5ea6\u6620\u5c04\u5230\u201c\u6307\u9488\u8f74\u9884\u671f\u89d2\u5ea6 expectedDeg\u201d   3) \u901a\u8fc7\u7f16\u7801\u5668\u8bfb\u6570\u5f97\u5230\u201c\u6307\u9488\u8f74\u5b9e\u9645\u89d2\u5ea6 actualDeg\u201d   4) GO \u6a21\u5f0f\u4e0b\uff1a\u7535\u673a\u81ea\u52a8\u8f6c\u52a8\uff0c\u4f7f actualDeg \u903c\u8fd1 expectedDeg   5) STOP \u6a21\u5f0f\u4e0b\uff1a\u7535\u673a\u4e0d\u52a8\uff08\u5373\u4f7f\u6e29\u5ea6\u53d8\u5316\u4e5f\u4e0d\u8ddf\u968f\uff09   6) \u4e32\u53e3\u547d\u4ee4\uff1a      s\uff1aSTOP\uff08\u505c\u6b62\u8ddf\u968f\u3001\u505c\u6b62\u7535\u673a\uff09      g\uff1aGO\uff08\u5f00\u59cb\u8ddf\u968f\u6e29\u5ea6\uff09      r / l\uff1a\u9a71\u52a8\u8f6e\u8f6c 1 \u5708\uff08\u00b112 count\uff09      r5 / l5\uff1a\u9a71\u52a8\u8f6e\u8f6c 5 \u5708\uff08\u00b160 count\uff09      sync\uff1a\u6821\u51c6\uff08\u628a\u5f53\u524d\u6307\u9488\u6240\u6307\u4f4d\u7f6e\u5f53\u6210\u201c\u6b63\u786e\u4f4d\u7f6e\u201d\uff0c\u4fee\u6b63 offset\uff09 */</p> <p>// ---------------- \u5f15\u811a\u5b9a\u4e49 ---------------- const uint8_t PIN_DIR   = 8;   // \u7535\u673a\u65b9\u5411 const uint8_t PIN_EN    = 9;   // \u7535\u673a\u4f7f\u80fd\uff08PWM\uff09 const uint8_t PIN_ENC_A = 2;   // \u7f16\u7801\u5668 A const uint8_t PIN_ENC_B = 3;   // \u7f16\u7801\u5668 B</p> <p>// ---------------- \u65b9\u5411\u53cd\u8f6c\u9009\u9879 ---------------- // \u5982\u679c\u4f60\u53d1\u73b0\uff1a // - r \u6307\u4ee4\u5b9e\u9645\u5411\u5de6\u8f6c\uff0c\u6216 GO \u8ddf\u968f\u65b9\u5411\u76f8\u53cd // \u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u8fd9\u4e24\u4e2a\u5e03\u5c14\u503c\u5feb\u901f\u4fee\u6b63\u65b9\u5411\uff0c\u4e0d\u7528\u91cd\u65b0\u63a5\u7ebf const bool INVERT_MOTOR_DIR = true;  // \u53cd\u8f6c\u7535\u673a\u65b9\u5411\u4fe1\u53f7 const bool INVERT_ENCODER   = true;  // \u53cd\u8f6c\u7f16\u7801\u5668\u8ba1\u6570\u65b9\u5411\uff08count \u6b63\u8d1f\uff09</p> <p>// ---------------- \u673a\u68b0\u53c2\u6570\uff08\u5f88\u5173\u952e\uff09 ---------------- // \u5b9e\u6d4b\uff1a\u9a71\u52a8\u8f6e\u8f6c 1 \u5708\uff0c\u7f16\u7801\u5668 count \u53d8\u5316\u4e3a 12 const long  ONE_REV_COUNTS = 12;</p> <p>// \u51cf\u901f\u6bd4\uff1a\u9a71\u52a8\u8f6e\u8f6c GEAR_RATIO \u5708\uff0c\u6307\u9488\u8f74\u8f6c 1 \u5708 // drive : shaft = 52.734 : 1 const float GEAR_RATIO = 52.734f;</p> <p>/   degPerDriveCountOnShaft():   \u8ba1\u7b97\u201c\u9a71\u52a8\u8f6e\u7f16\u7801\u5668\u6bcf\u589e\u52a0 1 count\uff0c\u6307\u9488\u8f74\u8f6c\u8fc7\u591a\u5c11\u5ea6\u201d   \u63a8\u5bfc\uff1a   - \u9a71\u52a8\u8f6e 1 \u5708 = 12 count   - \u9a71\u52a8\u8f6e\u8f6c 52.734 \u5708\uff0c\u6307\u9488\u8f74\u8f6c 360\u00b0   \u56e0\u6b64\uff1a   1 count \u5bf9\u5e94\u7684\u6307\u9488\u8f74\u89d2\u5ea6 = 360 / (12 * 52.734) / static inline float degPerDriveCountOnShaft() {   return 360.0f / (float)ONE_REV_COUNTS / GEAR_RATIO; }</p> <p>/   wrap180(a):   \u628a\u4efb\u610f\u89d2\u5ea6\u5f52\u4e00\u5316\u5230 (-180, 180] \u533a\u95f4   \u89d2\u5ea6\u662f\u5468\u671f\u91cf\uff0c\u4f8b\u5982\uff1a   190\u00b0 \u7b49\u4ef7\u4e8e -170\u00b0   540\u00b0 \u7b49\u4ef7\u4e8e 180\u00b0   \u5f52\u4e00\u5316\u7684\u76ee\u7684\uff1a   - \u907f\u514d\u89d2\u5ea6\u8ba1\u7b97\u8d8a\u754c   - \u907f\u514d\u63a7\u5236\u5668\u8d70\u201c\u7ed5\u5927\u5708\u201d\u7684\u8def\u5f84 / static inline float wrap180(float a) {   while (a &gt; 180.0f) a -= 360.0f;   while (a &lt;= -180.0f) a += 360.0f;   return a; }</p> <p>/   shaftDegToDriveCount(deg):   \u628a\u201c\u6307\u9488\u8f74\u89d2\u5ea6(\u00b0)\u201d\u6362\u7b97\u6210\u201c\u9a71\u52a8\u8f6e\u7f16\u7801\u5668 count\u201d   \u6ce8\u610f\uff1a\u8fd9\u91cc\u53ea\u505a\u7eaf\u6bd4\u4f8b\u6362\u7b97\uff0c\u4e0d\u5305\u542b\u6821\u51c6 offset\uff08offset \u5728\u522b\u5904\u5904\u7406\uff09 / static inline long shaftDegToDriveCount(float deg) {   return lroundf(deg / degPerDriveCountOnShaft()); }</p> <p>/   driveCountToShaftDeg(countDrive, calibOffsetDeg):   \u628a\u201c\u9a71\u52a8\u8f6e\u7f16\u7801\u5668 count\u201d\u6362\u7b97\u6210\u201c\u6307\u9488\u8f74\u89d2\u5ea6(\u00b0)\u201d\uff0c\u5e76\u52a0\u4e0a\u6821\u51c6\u504f\u79fb calibOffsetDeg   \u6a21\u578b\uff1a   actualDeg = count * (degPerCount) + calibOffsetDeg   \u518d wrap180 \u6298\u56de\u5230 (-180,180] \u533a\u95f4 / static inline float driveCountToShaftDeg(long countDrive, float calibOffsetDeg) {   return wrap180((float)countDrive * degPerDriveCountOnShaft() + calibOffsetDeg); }</p> <p>// ---------------- \u6e29\u5ea6\u4f20\u611f\u5668\uff08MPL3115A2\uff09I2C \u90e8\u5206 ---------------- // MPL3115A2 \u5e38\u7528 I2C \u5730\u5740 0x60 const uint8_t MPL3115A2_ADDR = 0x60;</p> <p>/   i2cWrite8(addr, reg, val):   \u5411 I2C \u8bbe\u5907\u7684 reg \u5bc4\u5b58\u5668\u5199\u5165 1 \u4e2a\u5b57\u8282 val   \u8fd4\u56de true \u8868\u793a\u5199\u5165\u6210\u529f / bool i2cWrite8(uint8_t addr, uint8_t reg, uint8_t val) {   Wire.beginTransmission(addr);   Wire.write(reg);   Wire.write(val);   return (Wire.endTransmission() == 0); }</p> <p>/   i2cReadBytes(addr, reg, buf, len):   \u4ece I2C \u8bbe\u5907\u7684 reg \u5bc4\u5b58\u5668\u5f00\u59cb\uff0c\u8fde\u7eed\u8bfb\u53d6 len \u4e2a\u5b57\u8282\uff0c\u653e\u5165 buf   \u8fd4\u56de true \u8868\u793a\u8bfb\u53d6\u6210\u529f / bool i2cReadBytes(uint8_t addr, uint8_t reg, uint8_t* buf, uint8_t len) {   Wire.beginTransmission(addr);   Wire.write(reg);   // endTransmission(false) = \u4e0d\u91ca\u653e\u603b\u7ebf\uff08\u91cd\u590d\u542f\u52a8\uff09\uff0c\u9002\u5408\u201c\u5148\u5199\u5bc4\u5b58\u5668\u5730\u5740\u518d\u8bfb\u6570\u636e\u201d   if (Wire.endTransmission(false) != 0) return false;</p> <p>uint8_t got = Wire.requestFrom(addr, len);   if (got != len) return false;</p> <p>for (uint8_t i = 0; i &lt; len; i++) buf[i] = Wire.read();   return true; }</p> <p>/   mpl3115a2Init():   \u521d\u59cb\u5316 MPL3115A2 \u4f7f\u5176\u8fdb\u5165\u6e29\u5ea6\u6d4b\u91cf\u6a21\u5f0f   - PT_DATA_CFG(0x13) \u5199 0x07\uff1a\u4f7f\u80fd\u4e8b\u4ef6\u6807\u5fd7\u7b49\u529f\u80fd   - CTRL_REG1(0x26) \u5199 0xB9\uff1a\u8bbe\u7f6e\u8fc7\u91c7\u6837\u5e76\u7f6e\u4e3a Active\uff08\u5f00\u59cb\u6d4b\u91cf\uff09 / bool mpl3115a2Init() {   if (!i2cWrite8(MPL3115A2_ADDR, 0x13, 0x07)) return false;   if (!i2cWrite8(MPL3115A2_ADDR, 0x26, 0xB9)) return false;   delay(10);   return true; }</p> <p>/   readTemperatureC(tempC):   \u8bfb\u53d6\u6e29\u5ea6\uff0c\u8fd4\u56de\u6444\u6c0f\u5ea6 float   MPL3115A2 \u6e29\u5ea6\u5bc4\u5b58\u5668\u4ece 0x04 \u5f00\u59cb\uff1a   - buf[0] = \u6e29\u5ea6\u6574\u6570\u90e8\u5206\uff08\u6709\u7b26\u53f7\uff09   - buf[1] \u9ad8 4 \u4f4d\u4e3a\u5c0f\u6570\uff08\u5355\u4f4d 1/16\u00b0C\uff09 / bool readTemperatureC(float &amp;tempC) {   uint8_t buf[2];   if (!i2cReadBytes(MPL3115A2_ADDR, 0x04, buf, 2)) return false;</p> <p>int8_t msb = (int8_t)buf[0];   uint8_t lsb = buf[1];</p> <p>float frac = (float)(lsb &gt;&gt; 4) / 16.0f;      // 4bit \u5c0f\u6570   tempC = (float)msb + ((msb &gt;= 0) ? frac : -frac);   return true; }</p> <p>// ---------------- \u6e29\u5ea6 -&gt; \u9884\u671f\u89d2\u5ea6 \u6620\u5c04 ---------------- // \u6e29\u5ea6\u91cf\u7a0b\uff1a20~30 \u00b0C const float TEMP_MIN = 20.0f; const float TEMP_MAX = 30.0f;</p> <p>// \u5bf9\u5e94\u89d2\u5ea6\u91cf\u7a0b\uff1a-120~+120 \u00b0\uff08\u6307\u9488\u8f74\u89d2\u5ea6\uff09 const float ANGLE_MIN = -120.0f; const float ANGLE_MAX =  120.0f;</p> <p>/   tempToAngleDeg(t):   \u628a\u6e29\u5ea6 t\uff08\u00b0C\uff09\u7ebf\u6027\u6620\u5c04\u5230\u6307\u9488\u8f74\u89d2\u5ea6\uff08\u00b0\uff09   - \u6e29\u5ea6\u4f4e\u4e8e TEMP_MIN\uff1a\u5939\u5230 TEMP_MIN   - \u6e29\u5ea6\u9ad8\u4e8e TEMP_MAX\uff1a\u5939\u5230 TEMP_MAX   \u6620\u5c04\u516c\u5f0f\uff1a   a = ANGLE_MIN + (t - TEMP_MIN) * (ANGLE_MAX - ANGLE_MIN)/(TEMP_MAX - TEMP_MIN) / static inline float tempToAngleDeg(float t) {   if (t &lt; TEMP_MIN) t = TEMP_MIN;   if (t &gt; TEMP_MAX) t = TEMP_MAX;</p> <p>float a = ANGLE_MIN + (t - TEMP_MIN) * (ANGLE_MAX - ANGLE_MIN) / (TEMP_MAX - TEMP_MIN);   return wrap180(a); }</p> <p>// ---------------- \u7535\u673a\u63a7\u5236\u51fd\u6570 ----------------</p> <p>/   stopMotor():   \u8ba9 PWM=0\uff0c\u7535\u673a\u505c\u6b62\uff08\u65ad\u7535\uff09   \u6ce8\u610f\uff1a\u8fd9\u662f\u201c\u6ed1\u884c\u505c\u201d\uff0c\u4e0d\u662f\u5239\u8f66 / void stopMotor() { analogWrite(PIN_EN, 0); }</p> <p>/   setMotor(dirHigh, pwm):   \u8bbe\u7f6e\u7535\u673a\u65b9\u5411\u548c PWM \u8f93\u51fa   - dirHigh: \u903b\u8f91\u65b9\u5411\uff08true/false\uff09   - pwm: 0~255   INVERT_MOTOR_DIR \u53ef\u4ee5\u7528\u6765\u53cd\u8f6c\u65b9\u5411 / void setMotor(bool dirHigh, int pwm) {   if (INVERT_MOTOR_DIR) dirHigh = !dirHigh;   digitalWrite(PIN_DIR, dirHigh ? HIGH : LOW);   analogWrite(PIN_EN, pwm); }</p> <p>// ---------------- \u7f16\u7801\u5668\u5bf9\u8c61\u4e0e\u8bfb\u53d6 ---------------- Encoder enc(PIN_ENC_A, PIN_ENC_B);</p> <p>/   readCountDrive():   \u8bfb\u53d6\u7f16\u7801\u5668\u8ba1\u6570\uff08\u9a71\u52a8\u8f6e\u4fa7\uff09   INVERT_ENCODER \u7528\u4e8e\u53cd\u8f6c count \u6b63\u8d1f / long readCountDrive() {   long c = enc.read();   if (INVERT_ENCODER) c = -c;   return c; }</p> <p>// ---------------- \u8fd0\u52a8\u63a7\u5236\u5668\uff08\u4f60\u9a8c\u8bc1\u201c\u5341\u5206\u5b8c\u7f8e\u201d\u7684\u90e8\u5206\uff09 ---------------- /*   \u63a7\u5236\u601d\u60f3\uff1a\u5206\u4e24\u6bb5   1) COARSE\uff08\u7c97\u8c03\uff09\uff1a\u7528\u6bd4\u4f8b\u63a7\u5236 P\uff0c\u628a\u8bef\u5dee\u5feb\u901f\u62c9\u8fd1\uff08\u8fde\u7eed\u8f93\u51fa PWM\uff09   2) NUDGE\uff08\u5fae\u8c03\uff09\uff1a\u9760\u77ed\u8109\u51b2\u4e00\u70b9\u70b9\u63a8\uff0c\u5c3d\u91cf\u843d\u5230 err=0\uff08\u5e76\u5728\u8109\u51b2\u95f4\u7b49\u5f85\u505c\u7a33\uff09</p> <p>zones:   FAR_ZONE: \u8bef\u5dee\u5f88\u5927 -&gt; \u5feb\u6863\u7c97\u8c03   FINE_ZONE: \u8bef\u5dee\u5f88\u5c0f -&gt; \u8fdb\u5165\u5fae\u8c03\uff08nudge\uff09 */ const long FAR_ZONE  = 8; const long NEAR_ZONE = 3; // \u6b64\u7248\u672c\u4e2d\u4e3b\u8981\u7528\u4e8e\u6982\u5ff5\uff0c\u5b9e\u9645\u5224\u65ad\u7528 FAR_ZONE/FINE_ZONE const long FINE_ZONE = 2;</p> <p>// \u7a33\u5b9a\u5224\u5b9a\uff1a // err==0 \u8fde\u7eed 500ms -&gt; \u8ba4\u4e3a\u5230\u4f4d // err==\u00b11 \u8fde\u7eed 800ms -&gt; \u53ef\u9009\u515c\u5e95\uff08\u5141\u8bb8\u5c11\u91cf\u8bef\u5dee\uff09 const long TOL_DONE = 0; const unsigned long STABLE_MS_ZERO = 500; const unsigned long STABLE_MS_ONE  = 800; const bool ALLOW_FALLBACK_PLUSMINUS1 = true;</p> <p>// \u7c97\u8c03\u6bd4\u4f8b\u7cfb\u6570\uff08P \u63a7\u5236\uff09 const float KP_COARSE = 7.0f;</p> <p>// PWM \u9650\u5e45\uff1a\u4fdd\u8bc1\u201c\u80fd\u52a8 + \u4e0d\u8fc7\u731b\u201d const int PWM_COARSE_MIN_FAST = 60; const int PWM_COARSE_MAX_FAST = 130;</p> <p>const int PWM_COARSE_MIN_SLOW = 55; const int PWM_COARSE_MAX_SLOW = 100;</p> <p>// \u5fae\u8c03 nudge\uff1a\u9760\u77ed\u8109\u51b2\u63a8\u4e00\u4e0b\uff0c\u7136\u540e\u7b49\u5f85 const int PWM_NUDGE = 55; const unsigned long NUDGE_OFF_MS = 160;     // \u8109\u51b2\u4e4b\u95f4\u7b49\u5f85\u505c\u7a33\uff08\u5f88\u5173\u952e\uff09 const unsigned long NUDGE_ON_MS_COARSE = 35; // err=2 \u65f6\u8109\u51b2\u7a0d\u957f const unsigned long NUDGE_ON_MS_FINE   = 15; // err=1 \u65f6\u8109\u51b2\u66f4\u77ed\uff0c\u4e89\u53d6\u843d\u5230 0</p> <p>// \u8c03\u5ea6\u5468\u671f/\u6253\u5370\u5468\u671f/\u8d85\u65f6\u4fdd\u62a4 const unsigned long CTRL_MS   = 10;   // \u63a7\u5236\u5468\u671f 10ms const unsigned long PRINT_MS  = 200;  // \u4e32\u53e3\u6253\u5370\u5468\u671f 200ms const unsigned long TIMEOUT_MS = 7000;</p> <p>// \u8fd0\u52a8\u72b6\u6001\u673a enum MotionState { M_IDLE, M_COARSE_FAST, M_COARSE_SLOW, M_NUDGE_OFF, M_NUDGE_ON }; MotionState mstate = M_IDLE;</p> <p>// \u8fd0\u52a8\u76ee\u6807\uff08\u9a71\u52a8\u8f6e\u7f16\u7801\u5668 count\uff09 long targetCountDrive = 0;</p> <p>// \u8fd0\u52a8\u5f00\u59cb\u65f6\u95f4\uff0c\u7528\u4e8e\u8d85\u65f6 unsigned long moveStartMs = 0;</p> <p>// nudge \u76f8\u4f4d\u8d77\u59cb\u65f6\u95f4 unsigned long phaseT0 = 0;</p> <p>// \u7528\u4e8e\u7a33\u5b9a\u5224\u5b9a\u7684\u8ba1\u65f6\u5668 unsigned long stableZeroT0 = 0; unsigned long stableOneT0  = 0;</p> <p>/   motionStartTo(newTargetCount):   \u542f\u52a8\u4e00\u6b21\u8fd0\u52a8\uff0c\u8ba9\u7f16\u7801\u5668 count \u8d70\u5230 newTargetCount / void motionStartTo(long newTargetCount) {   targetCountDrive = newTargetCount;   moveStartMs = millis();   stableZeroT0 = 0;   stableOneT0  = 0;   mstate = M_COARSE_FAST; }</p> <p>/   motionMoveBy(delta):   \u76f8\u5bf9\u8fd0\u52a8\uff1a\u5728\u5f53\u524d count \u57fa\u7840\u4e0a +delta   \u7528\u4e8e r/l/r5/l5 \u547d\u4ee4 / void motionMoveBy(long delta) {   long c = readCountDrive();   motionStartTo(c + delta); }</p> <p>/   motionUpdate():   \u8fd0\u52a8\u63a7\u5236\u5668\u6838\u5fc3\u72b6\u6001\u673a   \u6bcf CTRL_MS \u8c03\u7528\u4e00\u6b21\uff1a   - \u8ba1\u7b97 err   - \u7c97\u8c03 / \u5fae\u8c03   - \u8f93\u51fa PWM   - \u5230\u4f4d\u540e\u8fdb\u5165 IDLE / void motionUpdate() {   unsigned long now = millis();</p> <p>long c = readCountDrive();   long err = targetCountDrive - c;   long aerr = labs(err);</p> <p>// 1) \u8d85\u65f6\u4fdd\u62a4\uff1a\u9632\u6b62\u7f16\u7801\u5668\u5931\u6548\u4e00\u76f4\u8f6c   if (mstate != M_IDLE &amp;&amp; now - moveStartMs &gt; TIMEOUT_MS) {     mstate = M_IDLE;     stopMotor();   }</p> <p>// 2) \u7a33\u5b9a\u5224\u5b9a\uff1aerr==0 \u6216 err==\u00b11 \u6301\u7eed\u4e00\u5b9a\u65f6\u95f4\uff0c\u8ba4\u4e3a\u5230\u4f4d   if (mstate != M_IDLE) {     if (err == 0) {       if (stableZeroT0 == 0) stableZeroT0 = now;     } else {       stableZeroT0 = 0;     }</p> <pre><code>if (labs(err) == 1) {\n  if (stableOneT0 == 0) stableOneT0 = now;\n} else {\n  stableOneT0 = 0;\n}\n\nif (TOL_DONE == 0) {\n  if (stableZeroT0 != 0 &amp;&amp; now - stableZeroT0 &gt;= STABLE_MS_ZERO) {\n    mstate = M_IDLE; stopMotor();\n  } else if (ALLOW_FALLBACK_PLUSMINUS1 &amp;&amp; stableOneT0 != 0 &amp;&amp; now - stableOneT0 &gt;= STABLE_MS_ONE) {\n    mstate = M_IDLE; stopMotor();\n  }\n}\n</code></pre> <p>}</p> <p>// 3) \u72b6\u6001\u673a\u8f93\u51fa   if (mstate == M_IDLE) {     stopMotor();     return;   }</p> <p>// ---- \u7c97\u8c03\u9636\u6bb5\uff1a\u8fde\u7eed PWM\uff0c\u5feb\u901f\u903c\u8fd1 ----   if (mstate == M_COARSE_FAST || mstate == M_COARSE_SLOW) {</p> <pre><code>// \u8bef\u5dee\u5f88\u5c0f -&gt; \u8fdb\u5165\u5fae\u8c03\nif (aerr &lt;= FINE_ZONE) {\n  mstate = M_NUDGE_OFF;\n  phaseT0 = now;\n  stopMotor();\n}\n// \u8bef\u5dee\u4e2d\u7b49 -&gt; \u6162\u6863\u7c97\u8c03\nelse if (aerr &lt; FAR_ZONE) {\n  mstate = M_COARSE_SLOW;\n}\n// \u8bef\u5dee\u5f88\u5927 -&gt; \u5feb\u6863\u7c97\u8c03\nelse {\n  mstate = M_COARSE_FAST;\n}\n\n// \u5728\u7c97\u8c03\u72b6\u6001\u4e0b\uff1a\u8ba1\u7b97 P \u63a7\u5236\u8f93\u51fa u=Kp*err\uff0c\u5e76\u8f6c\u6210 PWM\nif (mstate == M_COARSE_FAST || mstate == M_COARSE_SLOW) {\n  float u = KP_COARSE * (float)err;\n  bool dirHigh = (u &gt;= 0);\n  int pwm = (int)fabs(u);\n\n  // PWM \u9650\u5e45\uff1a\u786e\u4fdd\u80fd\u52a8\u3001\u907f\u514d\u8fc7\u731b\n  if (mstate == M_COARSE_FAST) {\n    if (pwm &gt; PWM_COARSE_MAX_FAST) pwm = PWM_COARSE_MAX_FAST;\n    if (pwm &gt; 0 &amp;&amp; pwm &lt; PWM_COARSE_MIN_FAST) pwm = PWM_COARSE_MIN_FAST;\n  } else {\n    if (pwm &gt; PWM_COARSE_MAX_SLOW) pwm = PWM_COARSE_MAX_SLOW;\n    if (pwm &gt; 0 &amp;&amp; pwm &lt; PWM_COARSE_MIN_SLOW) pwm = PWM_COARSE_MIN_SLOW;\n  }\n\n  setMotor(dirHigh, pwm);\n}\n</code></pre> <p>}</p> <p>// ---- \u5fae\u8c03\u9636\u6bb5\uff1aOFF \u7b49\u5f85 ----   else if (mstate == M_NUDGE_OFF) {     stopMotor();     // \u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\u8ba9\u673a\u68b0\u505c\u7a33\uff0c\u518d\u6253\u4e0b\u4e00\u6b21\u8109\u51b2     if (now - phaseT0 &gt;= NUDGE_OFF_MS) {       mstate = M_NUDGE_ON;       phaseT0 = now;     }   }</p> <p>// ---- \u5fae\u8c03\u9636\u6bb5\uff1aON \u8109\u51b2 ----   else if (mstate == M_NUDGE_ON) {     // err=1 \u65f6\u8109\u51b2\u66f4\u77ed\uff0c\u907f\u514d\u8fc7\u51b2\uff0c\u4e89\u53d6\u843d\u5230 err=0     unsigned long onMs = (aerr &lt;= 1) ? NUDGE_ON_MS_FINE : NUDGE_ON_MS_COARSE;</p> <pre><code>bool dirHigh = (err &gt; 0);\nsetMotor(dirHigh, PWM_NUDGE);\n\n// \u8109\u51b2\u65f6\u95f4\u5230 -&gt; \u56de\u5230 OFF \u7b49\u5f85\nif (now - phaseT0 &gt;= onMs) {\n  mstate = M_NUDGE_OFF;\n  phaseT0 = now;\n}\n</code></pre> <p>} }</p> <p>// ---------------- GO/STOP \u6a21\u5f0f\u4e0e\u4e32\u53e3\u547d\u4ee4 ---------------- enum Mode { MODE_STOP, MODE_GO }; Mode mode = MODE_STOP;  // \u4e0a\u7535\u9ed8\u8ba4 STOP\uff1a\u4e0d\u8ddf\u968f\u6e29\u5ea6</p> <p>String cmdLine;</p> <p>// \u6821\u51c6\u504f\u79fb\uff1a\u89e3\u51b3\u201c\u7535\u673a\u6ca1\u6709\u7edd\u5bf90\u89d2\u5ea6\u201d\u7684\u95ee\u9898 // sync \u65f6\u4f1a\u66f4\u65b0\u8be5\u503c\uff0c\u8ba9\u5f53\u524d\u6307\u9488\u5bf9\u5e94\u5f53\u524d\u6e29\u5ea6\u7684 expectedDeg float calibOffsetDeg = 0.0f;</p> <p>// \u9884\u671f\u89d2\u5ea6\uff08\u7531\u6e29\u5ea6\u6620\u5c04\u5f97\u5230\uff09\u4e0e\u5b9e\u9645\u89d2\u5ea6\uff08\u7531\u7f16\u7801\u5668\u6362\u7b97\u5f97\u5230\uff09 float expectedDeg = 0.0f; float actualDeg   = 0.0f;</p> <p>// GO \u6a21\u5f0f\u4e0b\u628a expectedDeg \u6362\u7b97\u6210\u76ee\u6807 count long expectedCountDrive = 0;</p> <p>/   expectedDegToTargetCount(expDeg):   \u5c06\u9884\u671f\u89d2\u5ea6 expDeg \u8f6c\u6210\u76ee\u6807 count\uff08\u9a71\u52a8\u8f6e\u7f16\u7801\u5668\uff09   \u6ce8\u610f\uff1a\u5fc5\u987b\u8003\u8651 calibOffsetDeg   \u6a21\u578b\uff1a   actualDeg = countdegPer + offset   =&gt; count = (expDeg - offset)/degPer */ long expectedDegToTargetCount(float expDeg) {   float pure = wrap180(expDeg - calibOffsetDeg);   return lroundf(pure / degPerDriveCountOnShaft()); }</p> <p>/   handleCommand(s):   \u5904\u7406\u4e32\u53e3\u547d\u4ee4\uff1a   - s\uff1aSTOP   - g\uff1aGO   - r/l/r5/l5\uff1a\u76f8\u5bf9\u8fd0\u52a8\uff08\u7528\u4e8e\u5fae\u8c03\uff09   - sync\uff1a\u6821\u51c6 offset\uff08\u628a\u5f53\u524d\u6307\u9488\u4f4d\u7f6e\u8ba4\u4e3a\u662f\u6b63\u786e\u4f4d\u7f6e\uff09 / void handleCommand(String s) {   s.trim();   s.toLowerCase();</p> <p>if (s == \"s\") {     mode = MODE_STOP;     mstate = M_IDLE;   // \u53d6\u6d88\u6b63\u5728\u6267\u884c\u7684\u8fd0\u52a8     stopMotor();     return;   }   if (s == \"g\") {     mode = MODE_GO;     return;   }</p> <p>// \u624b\u52a8\u8c03\u8282\uff1a\u9a71\u52a8\u8f6e\u8f6c\u52a8\u56fa\u5b9a\u5708\u6570\uff08\u4ee5 count \u7cbe\u51c6\u63a7\u5236\uff09   if (s == \"r\")  { motionMoveBy(+ONE_REV_COUNTS); return; }   if (s == \"l\")  { motionMoveBy(-ONE_REV_COUNTS); return; }   if (s == \"r5\") { motionMoveBy(+5 * ONE_REV_COUNTS); return; }   if (s == \"l5\") { motionMoveBy(-5 * ONE_REV_COUNTS); return; }</p> <p>if (s == \"sync\") {     // \u6821\u51c6\u903b\u8f91\uff1a     // \u82e5 expectedDeg \u662f\u201c\u5e94\u8be5\u6307\u5411\u7684\u4f4d\u7f6e\u201d\uff0cactualDeg \u662f\u201c\u5f53\u524d\u5b9e\u9645\u6307\u5411\u7684\u4f4d\u7f6e\u201d     // \u90a3\u4e48\u5b83\u4eec\u4e4b\u95f4\u5dee\u503c err = expected - actual     // \u628a\u8fd9\u4e2a\u5dee\u503c\u52a0\u5230 offset \u4e0a\uff0c\u5c31\u80fd\u8ba9\u201c\u5f53\u524d\u5b9e\u9645\u201d\u88ab\u5f53\u6210\u201c\u6b63\u786e\u201d     float err = wrap180(expectedDeg - actualDeg);     calibOffsetDeg = wrap180(calibOffsetDeg + err);     return;   } }</p> <p>// ---------------- Arduino setup/loop ---------------- void setup() {   Serial.begin(9600);</p> <p>// \u5f15\u811a\u6a21\u5f0f\u914d\u7f6e   pinMode(PIN_DIR, OUTPUT);   pinMode(PIN_EN, OUTPUT);   pinMode(PIN_ENC_A, INPUT_PULLUP);   pinMode(PIN_ENC_B, INPUT_PULLUP);</p> <p>stopMotor();</p> <p>// I2C \u521d\u59cb\u5316 + \u4f20\u611f\u5668\u521d\u59cb\u5316   Wire.begin();   (void)mpl3115a2Init();</p> <p>// \u4e0a\u7535\u65f6\u5148\u8bfb\u4e00\u6b21\u7f16\u7801\u5668\uff0c\u8ba1\u7b97\u521d\u59cb\u5b9e\u9645\u89d2\u5ea6   long c = readCountDrive();   actualDeg = driveCountToShaftDeg(c, calibOffsetDeg);</p> <p>// \u4e32\u53e3\u63d0\u793a\u4fe1\u606f\uff08\u4fbf\u4e8e\u8c03\u8bd5/\u62a5\u544a\uff09   Serial.println(F(\"Temp Pointer Ready. Default STOP.\"));   Serial.println(F(\"Commands: s(stop) g(go) r l r5 l5 sync\"));   Serial.print(F(\"deg/count(shaft)=\"));   Serial.println(degPerDriveCountOnShaft(), 6); }</p> <p>void loop() {   // 1) \u4e32\u53e3\u884c\u8bfb\u53d6\uff1a\u63a5\u6536\u547d\u4ee4\uff08\u4ee5\u56de\u8f66/\u6362\u884c\u7ed3\u675f\uff09   while (Serial.available()) {     char ch = (char)Serial.read();     if (ch == '\\n' || ch == '\\r') {       if (cmdLine.length()) {         handleCommand(cmdLine);         cmdLine = \"\";       }     } else {       cmdLine += ch;       if (cmdLine.length() &gt; 64) cmdLine.remove(0, 32); // \u9632\u6b62\u5b57\u7b26\u4e32\u8fc7\u957f     }   }</p> <p>// 2) \u6bcf CTRL_MS \u6267\u884c\u4e00\u6b21\u63a7\u5236\u903b\u8f91\uff08\u975e\u963b\u585e\uff09   static unsigned long lastCtrl = 0;   unsigned long now = millis();   if (now - lastCtrl &gt;= CTRL_MS) {     lastCtrl = now;</p> <pre><code>// 2.1 \u8bfb\u53d6\u6e29\u5ea6\uff0c\u5f97\u5230 expectedDeg\uff08\u9884\u671f\u89d2\u5ea6\uff09\nfloat tempC = 0.0f;\nbool tOk = readTemperatureC(tempC);\nif (tOk) expectedDeg = tempToAngleDeg(tempC);\n\n// 2.2 \u8bfb\u53d6\u7f16\u7801\u5668\uff0c\u5f97\u5230 actualDeg\uff08\u5b9e\u9645\u89d2\u5ea6\uff09\nlong countDrive = readCountDrive();\nactualDeg = driveCountToShaftDeg(countDrive, calibOffsetDeg);\n\n// 2.3 GO \u6a21\u5f0f\uff1a\u8ddf\u968f\u6e29\u5ea6\nif (mode == MODE_GO) {\n  expectedCountDrive = expectedDegToTargetCount(expectedDeg);\n\n  // \u53ea\u6709\u76ee\u6807\u53d8\u5316\u65f6\u624d\u542f\u52a8\u4e00\u6b21\u65b0\u7684\u8fd0\u52a8\u4efb\u52a1\n  // \u76ee\u7684\uff1a\u907f\u514d\u6bcf\u4e2a\u63a7\u5236\u5468\u671f\u90fd\u91cd\u7f6e\u72b6\u6001\u673a\u9020\u6210\u6296\u52a8\n  if (expectedCountDrive != targetCountDrive) {\n    motionStartTo(expectedCountDrive);\n  }\n}\n\n// 2.4 STOP \u6a21\u5f0f\uff1a\u5982\u679c\u6ca1\u6709\u8fd0\u52a8\u4efb\u52a1\uff0c\u786e\u4fdd\u7535\u673a\u65ad\u7535\n// \u6ce8\u610f\uff1aSTOP \u6a21\u5f0f\u4e0b\u4ecd\u5141\u8bb8 r/l/r5/l5 \u624b\u52a8\u89e6\u53d1 motionStartTo()\nif (mode == MODE_STOP &amp;&amp; mstate == M_IDLE) {\n  stopMotor();\n}\n\n// 2.5 \u6267\u884c\u8fd0\u52a8\u63a7\u5236\u72b6\u6001\u673a\uff08\u82e5\u6709\u76ee\u6807\u5219\u9a71\u52a8\u7535\u673a\uff09\nmotionUpdate();\n\n// 3) \u6bcf PRINT_MS \u6253\u5370\u4e00\u6b21\u72b6\u6001\uff08\u7528\u4e8e\u8c03\u8bd5/\u62a5\u544a\u8bb0\u5f55\uff09\nstatic unsigned long lastPrint = 0;\nif (now - lastPrint &gt;= PRINT_MS) {\n  lastPrint = now;\n\n  Serial.print(F(\"T=\"));\n  if (tOk) Serial.print(tempC, 2);\n  else Serial.print(F(\"NaN\"));\n\n  Serial.print(F(\"; expected=\"));\n  Serial.print(expectedDeg, 1);\n\n  Serial.print(F(\"; actual=\"));\n  Serial.print(actualDeg, 1);\n\n  Serial.print(F(\"; count=\"));\n  Serial.print(countDrive);\n\n  Serial.print(F(\"; mode=\"));\n  Serial.println(mode == MODE_GO ? F(\"GO\") : F(\"STOP\"));\n}\n</code></pre> <p>} }</p> <p>\u4e0b\u9762\u6309\u201c\u51fd\u6570/\u6a21\u5757\u201d\u4e3a\u5355\u4f4d\uff0c\u628a\u4f60\u8fd9\u4efd\u4ee3\u7801\u91cc\u6bcf\u4e00\u4e2a\u51fd\u6570\uff08\u542b inline \u5c0f\u51fd\u6570\uff09\u90fd\u89e3\u91ca\u6e05\u695a\u3002\u4f60\u5199\u62a5\u544a\u65f6\u53ef\u4ee5\u76f4\u63a5\u7528\u8fd9\u4e9b\u63cf\u8ff0\uff08\u6211\u7528\u7684\u662f\u504f\u5de5\u7a0b\u62a5\u544a\u98ce\u683c\uff1a\u76ee\u7684\u3001\u8f93\u5165\u8f93\u51fa\u3001\u5b9e\u73b0\u8981\u70b9\uff09\u3002</p>","text":""},{"location":"notes/arduino/projet/code/#_1","title":"\u5927\u7eb2","text":""},{"location":"notes/arduino/projet/code/#1","title":"1. \u673a\u68b0\u4e0e\u6570\u5b66\u8f85\u52a9\u51fd\u6570","text":""},{"location":"notes/arduino/projet/code/#degperdrivecountonshaft","title":"<code>degPerDriveCountOnShaft()</code>","text":"<p>\u4f5c\u7528\uff1a\u8ba1\u7b97\u201c\u9a71\u52a8\u8f6e\u7f16\u7801\u5668 1 \u4e2a count \u5bf9\u5e94\u6307\u9488\u8f74\u8f6c\u8fc7\u7684\u89d2\u5ea6\uff08\u00b0\uff09\u201d\u3002 \u539f\u7406\uff1a\u9a71\u52a8\u8f6e 1 \u5708 = 12 count\uff1b\u9a71\u52a8\u8f6e\u8f6c 52.734 \u5708\uff0c\u6307\u9488\u8f74\u8f6c 1 \u5708\uff08360\u00b0\uff09\u3002 [ \\text{deg/count} = \\frac{360}{12 \\times 52.734} ] \u8fd4\u56de\u503c\uff1a<code>float</code>\uff0c\u5355\u4f4d \u00b0/count\u3002 \u7528\u9014\uff1a\u628a <code>count</code> \u6362\u7b97\u6210\u8f74\u89d2\u5ea6\uff0c\u6216\u628a\u8f74\u89d2\u5ea6\u6362\u7b97\u6210 count\u3002</p>"},{"location":"notes/arduino/projet/code/#wrap180float-a","title":"<code>wrap180(float a)</code>","text":"<p>\u4f5c\u7528\uff1a\u628a\u4efb\u610f\u89d2\u5ea6\u5f52\u4e00\u5316\u5230\u533a\u95f4 (-180, 180]\uff08\u6216\u7b49\u4ef7\u533a\u95f4\uff09\u3002 \u8f93\u5165\uff1a<code>a</code> \u4efb\u610f\u89d2\u5ea6\uff08\u53ef\u80fd\u8d85\u8fc7 360 \u6216\u5c0f\u4e8e -360\uff09\u3002 \u8f93\u51fa\uff1a\u5f52\u4e00\u5316\u540e\u7684\u89d2\u5ea6\u3002 \u7528\u9014\uff1a\u907f\u514d\u89d2\u5ea6\u8d8a\u754c\uff0c\u4e14\u5904\u7406\u201c20\u00b0C \u4e0e 30\u00b0C \u5bf9\u5e94\u540c\u4e00\u4e2a\u89d2\u5ea6\u201d\u7684\u73af\u7ed5\u5173\u7cfb\uff08\u00b1180 \u7b49\u4ef7\uff09\u3002</p>"},{"location":"notes/arduino/projet/code/#shaftdegtodrivecountfloat-deg","title":"<code>shaftDegToDriveCount(float deg)</code>","text":"<p>\u4f5c\u7528\uff1a\u628a\u201c\u6307\u9488\u8f74\u89d2\u5ea6\uff08\u00b0\uff09\u201d\u6362\u7b97\u6210\u201c\u9a71\u52a8\u8f6e\u7f16\u7801\u5668 count\u201d\u3002 \u8f93\u5165\uff1a<code>deg</code>\uff08\u4e0d\u5305\u542b\u6821\u51c6 offset \u7684\u7eaf\u89d2\u5ea6\u6620\u5c04\uff09\u3002 \u8f93\u51fa\uff1a<code>long</code> \u7c7b\u578b count\uff08\u56db\u820d\u4e94\u5165\uff09\u3002 \u7528\u9014\uff1a\u7406\u8bba\u4e0a\u53ef\u4ee5\u7528\u6765\u76f4\u63a5\u6307\u5b9a\u67d0\u4e2a\u8f74\u89d2\u5bf9\u5e94\u7684 count\uff08\u5728\u4f60\u8fd9\u7248\u91cc\u5b9e\u9645\u7528\u5f97\u4e0d\u591a\uff0c\u4f60\u4e3b\u8981\u7528 <code>expectedDegToTargetCount()</code>\uff09\u3002</p>"},{"location":"notes/arduino/projet/code/#drivecounttoshaftdeglong-countdrive-float-caliboffsetdeg","title":"<code>driveCountToShaftDeg(long countDrive, float calibOffsetDeg)</code>","text":"<p>\u4f5c\u7528\uff1a\u628a\u7f16\u7801\u5668 <code>countDrive</code> \u8f6c\u6362\u6210\u201c\u6307\u9488\u8f74\u5b9e\u9645\u89d2\u5ea6 actualDeg\u201d\uff0c\u5e76\u53e0\u52a0\u6821\u51c6\u504f\u79fb <code>calibOffsetDeg</code>\u3002 \u8f93\u5165\uff1a</p> <ul> <li><code>countDrive</code>\uff1a\u9a71\u52a8\u8f6e\u7f16\u7801\u5668\u8ba1\u6570\uff08\u6bcf\u5708\u7ea6 12\uff09</li> <li><code>calibOffsetDeg</code>\uff1a\u6821\u51c6\u504f\u79fb\uff08\u7528 <code>sync</code> \u8c03\u6574\uff09   \u8f93\u51fa\uff1a<code>actualDeg</code>\uff08\u5355\u4f4d \u00b0\uff0c\u8303\u56f4 wrap \u5230 (-180, 180]\uff09\u3002   \u7528\u9014\uff1a\u62a5\u544a\u91cc\u53ef\u4ee5\u5199\uff1a\u7528\u7f16\u7801\u5668\u4f30\u7b97\u8f93\u51fa\u8f74\u89d2\u5ea6\uff0c\u5b9e\u73b0\u201c\u5b9e\u9645\u89d2\u5ea6\u53cd\u9988\u201d\u3002</li> </ul>"},{"location":"notes/arduino/projet/code/#2-i2c-mpl3115a2","title":"2. I2C \u8bfb\u5199\u4e0e\u6e29\u5ea6\u4f20\u611f\u5668\u76f8\u5173\u51fd\u6570\uff08MPL3115A2\uff09","text":""},{"location":"notes/arduino/projet/code/#i2cwrite8uint8_t-addr-uint8_t-reg-uint8_t-val","title":"<code>i2cWrite8(uint8_t addr, uint8_t reg, uint8_t val)</code>","text":"<p>\u4f5c\u7528\uff1a\u5411 I2C \u8bbe\u5907\u7684\u67d0\u4e2a\u5bc4\u5b58\u5668\u5199 1 \u5b57\u8282\u3002 \u8f93\u5165\uff1a</p> <ul> <li><code>addr</code>\uff1aI2C \u8bbe\u5907\u5730\u5740\uff08MPL3115A2 \u662f <code>0x60</code>\uff09</li> <li><code>reg</code>\uff1a\u5bc4\u5b58\u5668\u5730\u5740</li> <li><code>val</code>\uff1a\u8981\u5199\u5165\u7684\u503c   \u8f93\u51fa\uff1a<code>bool</code>\uff0c\u8fd4\u56de\u5199\u5165\u662f\u5426\u6210\u529f\uff08<code>Wire.endTransmission()==0</code> \u4ee3\u8868\u6210\u529f\uff09\u3002   \u7528\u9014\uff1a\u7ed9\u4f20\u611f\u5668\u914d\u7f6e\u5bc4\u5b58\u5668\u3002</li> </ul>"},{"location":"notes/arduino/projet/code/#i2creadbytesuint8_t-addr-uint8_t-reg-uint8_t-buf-uint8_t-len","title":"<code>i2cReadBytes(uint8_t addr, uint8_t reg, uint8_t* buf, uint8_t len)</code>","text":"<p>\u4f5c\u7528\uff1a\u4ece I2C \u8bbe\u5907\u7684\u67d0\u4e2a\u5bc4\u5b58\u5668\u5f00\u59cb\uff0c\u8fde\u7eed\u8bfb\u53d6 <code>len</code> \u4e2a\u5b57\u8282\u3002 \u8f93\u5165\uff1a</p> <ul> <li><code>addr</code>\uff1a\u8bbe\u5907\u5730\u5740</li> <li><code>reg</code>\uff1a\u8d77\u59cb\u5bc4\u5b58\u5668\u5730\u5740</li> <li><code>buf</code>\uff1a\u7f13\u51b2\u533a\u6307\u9488\uff0c\u7528\u6765\u5b58\u653e\u8bfb\u53d6\u7684\u6570\u636e</li> <li><code>len</code>\uff1a\u8bfb\u53d6\u957f\u5ea6   \u8f93\u51fa\uff1a<code>bool</code>\uff0c\u662f\u5426\u8bfb\u53d6\u6210\u529f\u3002   \u5b9e\u73b0\u8981\u70b9\uff1a\u5148\u5199\u5bc4\u5b58\u5668\u5730\u5740\uff08\u4f46\u4e0d\u91ca\u653e\u603b\u7ebf <code>endTransmission(false)</code>\uff09\uff0c\u518d <code>requestFrom()</code> \u8bfb\u6570\u636e\u3002   \u7528\u9014\uff1a\u8bfb\u53d6\u6e29\u5ea6\u5bc4\u5b58\u5668\u7684\u6570\u636e\u3002</li> </ul>"},{"location":"notes/arduino/projet/code/#mpl3115a2init","title":"<code>mpl3115a2Init()</code>","text":"<p>\u4f5c\u7528\uff1a\u521d\u59cb\u5316 MPL3115A2\uff0c\u4f7f\u5176\u8fdb\u5165\u6e29\u5ea6\u6d4b\u91cf\u5de5\u4f5c\u72b6\u6001\u3002 \u6838\u5fc3\u914d\u7f6e\uff1a</p> <ul> <li>\u5411 <code>PT_DATA_CFG(0x13)</code> \u5199 <code>0x07</code>\uff1a\u542f\u7528\u4e8b\u4ef6/\u6570\u636e\u5c31\u7eea\u7b49\u529f\u80fd\uff08\u8bfe\u7a0b\u91cc\u5e38\u7528\u5199\u6cd5\uff09</li> <li>\u5411 <code>CTRL_REG1(0x26)</code> \u5199 <code>0xB9</code>\uff1a\u8bbe\u7f6e\u8f93\u51fa\u91c7\u6837/\u8fc7\u91c7\u6837\u5e76\u7f6e\u4e3a Active\uff08\u5f00\u59cb\u6d4b\u91cf\uff09   \u8f93\u51fa\uff1a<code>bool</code>\uff0c\u662f\u5426\u521d\u59cb\u5316\u6210\u529f\u3002   \u7528\u9014\uff1a\u5728 <code>setup()</code> \u4e2d\u8c03\u7528\uff0c\u4fdd\u8bc1\u4f20\u611f\u5668\u53ef\u4ee5\u6b63\u5e38\u8f93\u51fa\u6e29\u5ea6\u3002</li> </ul>"},{"location":"notes/arduino/projet/code/#readtemperaturecfloat-tempc","title":"<code>readTemperatureC(float &amp;tempC)</code>","text":"<p>\u4f5c\u7528\uff1a\u8bfb\u53d6\u4f20\u611f\u5668\u6e29\u5ea6\u5e76\u6362\u7b97\u6210\u6444\u6c0f\u5ea6\u6d6e\u70b9\u6570\u3002 \u8f93\u5165/\u8f93\u51fa\uff1a</p> <ul> <li>\u53c2\u6570 <code>tempC</code> \u4e3a\u5f15\u7528\u8f93\u51fa\uff1a\u8fd4\u56de\u6d4b\u5f97\u6e29\u5ea6\uff08\u00b0C\uff09</li> <li>\u8fd4\u56de\u503c <code>bool</code>\uff1a\u8bfb\u53d6\u6210\u529f\u4e0e\u5426   \u5b9e\u73b0\u8981\u70b9\uff1a</li> <li>\u4ece\u5bc4\u5b58\u5668 <code>0x04</code> \u8bfb 2 \u5b57\u8282\uff1aMSB \u662f\u6574\u6570\u90e8\u5206\uff08\u6709\u7b26\u53f7\uff09\uff0cLSB \u7684\u9ad8 4 \u4f4d\u662f 1/16\u00b0C \u7684\u5c0f\u6570\u90e8\u5206</li> <li>\u7ec4\u5408\u5f97\u5230\u6e29\u5ea6\uff1a<code>temp = msb + (lsb&gt;&gt;4)/16</code> \u7528\u9014\uff1a\u5728\u4e3b\u5faa\u73af\u4e2d\u5b9e\u65f6\u83b7\u53d6\u5f53\u524d\u6e29\u5ea6 T\u3002</li> </ul>"},{"location":"notes/arduino/projet/code/#3","title":"3. \u6e29\u5ea6\u5230\u89d2\u5ea6\u6620\u5c04\u51fd\u6570","text":""},{"location":"notes/arduino/projet/code/#temptoangledegfloat-t","title":"<code>tempToAngleDeg(float t)</code>","text":"<p>\u4f5c\u7528\uff1a\u628a\u6e29\u5ea6\u8303\u56f4 20\u201330\u00b0C \u6620\u5c04\u5230\u6307\u9488\u8f74\u89d2\u5ea6 (-180\u00b0, 180\u00b0]\uff0c\u5e76\u8ba9 20\u00b0C \u4e0e 30\u00b0C \u6620\u5c04\u5230\u540c\u4e00\u89d2\u5ea6\uff08-180\u00b0\uff09\u3002 \u8f93\u5165\uff1a<code>t</code> \u6e29\u5ea6\uff08\u00b0C\uff09\u3002 \u8f93\u51fa\uff1a\u5bf9\u5e94\u89d2\u5ea6\uff08\u00b0\uff09\u3002 \u6620\u5c04\u5173\u7cfb\uff1a</p> <ul> <li><code>t=20 \u2192 -180\u00b0</code></li> <li><code>t=25 \u2192 0\u00b0</code></li> <li><code>t=30 \u2192 +180\u00b0</code>\uff0c\u4f46\u4f60\u8981\u6c42 30 \u548c 20 \u540c\u89d2\uff0c\u6240\u4ee5\u628a <code>+180\u00b0</code> \u6298\u56de <code>-180\u00b0</code> \u7528\u9014\uff1a\u751f\u6210\u201c\u9884\u671f\u89d2\u5ea6 expectedDeg\u201d\u3002</li> </ul>"},{"location":"notes/arduino/projet/code/#4","title":"4. \u7535\u673a\u9a71\u52a8\u8f93\u51fa\u51fd\u6570","text":""},{"location":"notes/arduino/projet/code/#stopmotor","title":"<code>stopMotor()</code>","text":"<p>\u4f5c\u7528\uff1a\u505c\u6b62\u7535\u673a\u8f93\u51fa\u3002 \u5b9e\u73b0\uff1a<code>analogWrite(PIN_EN, 0)</code>\uff0cPWM=0\u3002 \u7528\u9014\uff1aSTOP \u6a21\u5f0f\u3001\u8fd0\u52a8\u7ed3\u675f\u3001\u7b49\u5f85\u9636\u6bb5\u7b49\u90fd\u7528\u5b83\u8ba9\u7535\u673a\u65ad\u7535\u3002</p>"},{"location":"notes/arduino/projet/code/#setmotorbool-dirhigh-int-pwm","title":"<code>setMotor(bool dirHigh, int pwm)</code>","text":"<p>\u4f5c\u7528\uff1a\u8bbe\u7f6e\u7535\u673a\u8f6c\u5411\u4e0e PWM\uff0c\u5360\u7a7a\u6bd4\u63a7\u5236\u901f\u5ea6/\u626d\u77e9\u3002 \u8f93\u5165\uff1a</p> <ul> <li><code>dirHigh</code>\uff1a\u903b\u8f91\u65b9\u5411\uff08\u6b63/\u53cd\uff09</li> <li><code>pwm</code>\uff1aPWM \u503c 0\u2013255   \u5b9e\u73b0\u8981\u70b9\uff1a</li> <li>\u6839\u636e <code>INVERT_MOTOR_DIR</code> \u53cd\u8f6c\u65b9\u5411\uff08\u7528\u4e8e\u4fee\u6b63\u63a5\u7ebf\u5bfc\u81f4\u7684\u65b9\u5411\u53cd\uff09</li> <li><code>digitalWrite(PIN_DIR, ...)</code> \u8bbe\u7f6e\u65b9\u5411</li> <li><code>analogWrite(PIN_EN, pwm)</code> \u8f93\u51fa PWM   \u7528\u9014\uff1a\u8fd0\u52a8\u63a7\u5236\u4e2d\u771f\u6b63\u9a71\u52a8\u7535\u673a\u7684\u552f\u4e00\u51fa\u53e3\u3002</li> </ul>"},{"location":"notes/arduino/projet/code/#5","title":"5. \u7f16\u7801\u5668\u8bfb\u53d6\u51fd\u6570","text":""},{"location":"notes/arduino/projet/code/#readcountdrive","title":"<code>readCountDrive()</code>","text":"<p>\u4f5c\u7528\uff1a\u8bfb\u53d6 Encoder \u5e93\u7684\u8ba1\u6570\u503c\uff0c\u5e76\u6839\u636e <code>INVERT_ENCODER</code> \u4fee\u6b63\u8ba1\u6570\u65b9\u5411\u3002 \u8f93\u51fa\uff1a<code>long</code> \u7f16\u7801\u5668\u8ba1\u6570\uff08\u9a71\u52a8\u8f6e\u6bcf\u5708\u7ea6 12\uff09\u3002 \u7528\u9014\uff1a\u4f5c\u4e3a\u53cd\u9988\u91cf <code>countDrive</code>\uff0c\u65e2\u7528\u4e8e report \u7684\u201ccount\u201d\uff0c\u4e5f\u7528\u4e8e\u8ba1\u7b97 actualDeg\u3002</p>"},{"location":"notes/arduino/projet/code/#6","title":"6. \u8fd0\u52a8\u63a7\u5236\u6a21\u5757\uff08\u4f60\u6700\u6838\u5fc3\u7684\u201c\u5b8c\u7f8e\u201d\u90e8\u5206\uff09","text":""},{"location":"notes/arduino/projet/code/#motionstarttolong-newtargetcount","title":"<code>motionStartTo(long newTargetCount)</code>","text":"<p>\u4f5c\u7528\uff1a\u542f\u52a8\u4e00\u6b21\u8fd0\u52a8\u4efb\u52a1\uff1a\u8ba9\u9a71\u52a8\u8f6e count \u8d70\u5230 <code>newTargetCount</code>\u3002 \u8f93\u5165\uff1a\u76ee\u6807\u8ba1\u6570 <code>newTargetCount</code>\u3002 \u5b9e\u73b0\u8981\u70b9\uff1a</p> <ul> <li>\u8bbe\u7f6e <code>targetCountDrive</code></li> <li>\u8bb0\u5f55\u5f00\u59cb\u65f6\u95f4 <code>moveStartMs</code> \u7528\u4e8e\u8d85\u65f6\u4fdd\u62a4</li> <li>\u6e05\u96f6\u7a33\u5b9a\u8ba1\u65f6 <code>stableZeroT0 / stableOneT0</code></li> <li>\u628a\u72b6\u6001\u673a\u7f6e\u4e3a <code>M_COARSE_FAST</code>\uff08\u5148\u7c97\u8c03\u518d\u7cbe\u8c03\uff09   \u7528\u9014\uff1a</li> <li>GO \u6a21\u5f0f\u6e29\u5ea6\u76ee\u6807\u53d8\u5316\u65f6\u8c03\u7528</li> <li>\u624b\u52a8 r/l/r5/l5 \u4e5f\u4f1a\u95f4\u63a5\u8c03\u7528\u5b83</li> </ul>"},{"location":"notes/arduino/projet/code/#motionmovebylong-delta","title":"<code>motionMoveBy(long delta)</code>","text":"<p>\u4f5c\u7528\uff1a\u76f8\u5bf9\u8fd0\u52a8\uff1a\u4ee5\u5f53\u524d count \u4e3a\u8d77\u70b9\uff0c\u76ee\u6807\u53d8\u4e3a <code>\u5f53\u524d + delta</code>\u3002 \u8f93\u5165\uff1a<code>delta</code>\uff08\u4f8b\u5982 <code>+12</code>\u3001<code>-12</code>\u3001<code>+60</code>\u3001<code>-60</code>\uff09\u3002 \u7528\u9014\uff1a\u5b9e\u73b0 r/l/r5/l5\u3002</p>"},{"location":"notes/arduino/projet/code/#motionupdate","title":"<code>motionUpdate()</code>","text":"<p>\u4f5c\u7528\uff1a\u8fd0\u52a8\u63a7\u5236\u6838\u5fc3\u72b6\u6001\u673a\uff0c\u6bcf 10ms \u8c03\u7528\u4e00\u6b21\uff0c\u8d1f\u8d23\uff1a</p> <ul> <li>\u8bfb\u53d6\u5f53\u524d count</li> <li>\u8ba1\u7b97\u8bef\u5dee <code>err = targetCountDrive - count</code></li> <li>\u6839\u636e\u8bef\u5dee\u5927\u5c0f\u51b3\u5b9a\u5904\u4e8e\u7c97\u8c03\u8fd8\u662f\u5fae\u8c03</li> <li> <p>\u8f93\u51fa\u7535\u673a PWM\uff0c\u76f4\u5230\u6ee1\u8db3\u7a33\u5b9a\u7ed3\u675f\u6761\u4ef6   \u4e3b\u8981\u6d41\u7a0b\uff1a</p> </li> <li> <p>\u8d85\u65f6\u4fdd\u62a4    \u5982\u679c\u8fd0\u52a8\u65f6\u95f4\u8d85\u8fc7 <code>TIMEOUT_MS</code>\uff0c\u5f3a\u5236\u505c\u6b62\uff0c\u907f\u514d\u7f16\u7801\u5668\u5931\u6548\u5bfc\u81f4\u4e00\u76f4\u8f6c\u3002</p> </li> <li> <p>\u7a33\u5b9a\u5224\u5b9a\uff08\u7ed3\u675f\u6761\u4ef6\uff09</p> </li> <li> <p>\u82e5 <code>err==0</code> \u6301\u7eed <code>STABLE_MS_ZERO(500ms)</code> \u2192 \u5b8c\u6210</p> </li> <li> <p>\u82e5 <code>err==\u00b11</code> \u6301\u7eed <code>STABLE_MS_ONE(800ms)</code> \u2192 \u4f5c\u4e3a\u515c\u5e95\u5b8c\u6210   \uff08\u8fd9\u5c31\u662f\u4f60\u201c\u591a\u6570 0\uff0c\u5076\u5c14 \u00b11\u201d\u7684\u7b56\u7565\u6765\u6e90\uff09</p> </li> <li> <p>\u72b6\u6001\u673a\u63a7\u5236</p> </li> <li> <p><code>M_COARSE_FAST / M_COARSE_SLOW</code>\uff1a\u6bd4\u4f8b\u63a7\u5236 <code>u = KP_COARSE * err</code>\uff0c\u5e76\u7528 PWM \u4e0a\u4e0b\u9650\u4fdd\u8bc1\u80fd\u52a8\u4e14\u4e0d\u8fc7\u51b2\u8fc7\u5927</p> </li> <li> <p>\u82e5\u8bef\u5dee\u8fdb\u5165 <code>FINE_ZONE</code>\uff08\u22642\uff09\u2192 \u8f6c\u5165 <code>M_NUDGE_OFF</code></p> </li> <li><code>M_NUDGE_OFF</code>\uff1a\u65ad\u7535\u7b49\u5f85 <code>NUDGE_OFF_MS</code> \u8ba9\u673a\u68b0\u505c\u7a33/\u6d88\u9664\u56de\u5f39</li> <li><code>M_NUDGE_ON</code>\uff1a\u8f93\u51fa\u77ed\u8109\u51b2 <code>NUDGE_ON_MS_FINE/COARSE</code> \u5fae\u8c03 1 count\uff0c\u5c3d\u91cf\u843d\u5728 0</li> </ul> <p>\u7528\u9014\uff1a\u8fd9\u662f\u4f60\u5b9e\u73b0\u201c\u7cbe\u786e count\u201d\u7684\u5173\u952e\uff0c\u56e0\u6b64\u5199\u62a5\u544a\u65f6\u5efa\u8bae\u91cd\u70b9\u63cf\u8ff0\uff1a\u7c97\u8c03+\u5fae\u8c03\u4e24\u9636\u6bb5\u63a7\u5236\u601d\u60f3\u3002</p>"},{"location":"notes/arduino/projet/code/#7-gostop-sync","title":"7. GO/STOP \u4e0e\u6821\u51c6\uff08sync\uff09\u76f8\u5173\u51fd\u6570","text":""},{"location":"notes/arduino/projet/code/#expecteddegtotargetcountfloat-expdeg","title":"<code>expectedDegToTargetCount(float expDeg)</code>","text":"<p>\u4f5c\u7528\uff1a\u628a\u201c\u9884\u671f\u8f74\u89d2 expectedDeg\u201d\u8f6c\u6362\u6210\u201c\u76ee\u6807\u9a71\u52a8\u8f6e count\u201d\u3002 \u8f93\u5165\uff1a<code>expDeg</code>\uff08\u6765\u81ea\u6e29\u5ea6\u6620\u5c04\uff09\u3002 \u8f93\u51fa\uff1a\u5bf9\u5e94 <code>count</code>\uff08long\uff09\u3002 \u5b9e\u73b0\u8981\u70b9\uff1a</p> <ul> <li>\u4f60\u6709\u4e00\u4e2a\u6821\u51c6\u504f\u79fb <code>calibOffsetDeg</code>\uff1a   \u8f74\u89d2\u6a21\u578b\uff1a<code>actualDeg = count*degPer + calibOffsetDeg</code></li> <li>\u6240\u4ee5\u8981\u5f97\u5230\u67d0\u4e2a\u8f74\u89d2\u5bf9\u5e94\u7684 count\uff0c\u53cd\u89e3\uff1a   [   count = \\frac{expDeg - calibOffsetDeg}{degPerCount}   ]</li> <li>\u4ee3\u7801\u91cc\u5148 <code>pure = wrap180(expDeg - calibOffsetDeg)</code> \u518d\u9664\u4ee5 degPerCount   \u7528\u9014\uff1aGO \u6a21\u5f0f\u628a\u6e29\u5ea6\u2192\u89d2\u5ea6\u2192count\uff0c\u7528\u4e8e\u8fd0\u52a8\u63a7\u5236\u76ee\u6807\u3002</li> </ul>"},{"location":"notes/arduino/projet/code/#handlecommandstring-s","title":"<code>handleCommand(String s)</code>","text":"<p>\u4f5c\u7528\uff1a\u89e3\u6790\u4e32\u53e3\u6307\u4ee4\uff0c\u5b9e\u73b0\u4f60\u8981\u6c42\u7684\u4ea4\u4e92\u903b\u8f91\u3002 \u652f\u6301\u547d\u4ee4\uff1a</p> <ul> <li><code>s</code>\uff1a\u8fdb\u5165 STOP\uff0c\u7acb\u5373\u505c\u6b62\u7535\u673a\uff0c\u53d6\u6d88\u5f53\u524d\u8fd0\u52a8\uff08<code>mstate=M_IDLE</code>\uff09</li> <li><code>g</code>\uff1a\u8fdb\u5165 GO\uff0c\u5f00\u59cb\u8ddf\u968f\u6e29\u5ea6</li> <li><code>r/l/r5/l5</code>\uff1a\u8c03\u7528 <code>motionMoveBy()</code> \u505a\u76f8\u5bf9\u8fd0\u52a8</li> <li> <p><code>sync</code>\uff1a\u6821\u51c6\uff1a\u8ba9\u5f53\u524d\u6307\u9488\u201c\u5b9e\u9645\u89d2\u5ea6\u201d\u88ab\u89c6\u4f5c\u201c\u9884\u671f\u89d2\u5ea6\u201d</p> </li> <li> <p>\u8ba1\u7b97 <code>err = expectedDeg - actualDeg</code></p> </li> <li>\u66f4\u65b0 <code>calibOffsetDeg += err</code> \u7528\u9014\uff1a\u8fd9\u662f\u7cfb\u7edf\u7684\u201c\u4eba\u673a\u63a5\u53e3\u201d\uff0c\u62a5\u544a\u91cc\u53ef\u4ee5\u5355\u72ec\u4e00\u8282\u5199\u201c\u4e32\u53e3\u547d\u4ee4\u4e0e\u6821\u51c6\u6d41\u7a0b\u201d\u3002</li> </ul>"},{"location":"notes/arduino/projet/code/#8-arduino","title":"8. Arduino \u4e3b\u7ed3\u6784\u51fd\u6570","text":""},{"location":"notes/arduino/projet/code/#setup","title":"<code>setup()</code>","text":"<p>\u4f5c\u7528\uff1a\u7cfb\u7edf\u521d\u59cb\u5316\u3002 \u4e3b\u8981\u5185\u5bb9\uff1a</p> <ul> <li><code>Serial.begin(9600)</code>\uff1a\u8bbe\u7f6e\u6ce2\u7279\u7387</li> <li>\u8bbe\u7f6e\u7535\u673a\u5f15\u811a/\u7f16\u7801\u5668\u5f15\u811a\u6a21\u5f0f\uff0c\u521d\u59cb\u505c\u6b62\u7535\u673a</li> <li><code>Wire.begin()</code> \u521d\u59cb\u5316 I2C</li> <li><code>mpl3115a2Init()</code> \u521d\u59cb\u5316\u6e29\u5ea6\u4f20\u611f\u5668</li> <li>\u521d\u59cb\u8bfb\u53d6 <code>count</code> \u5e76\u8ba1\u7b97 <code>actualDeg</code></li> <li>\u4e32\u53e3\u6253\u5370\u63d0\u793a\u4e0e deg/count \u4fbf\u4e8e\u8c03\u8bd5/\u5199\u62a5\u544a   \u7528\u9014\uff1a\u4e0a\u7535\u51c6\u5907\u5de5\u4f5c\u3002</li> </ul>"},{"location":"notes/arduino/projet/code/#loop","title":"<code>loop()</code>","text":"<p>\u4f5c\u7528\uff1a\u4e3b\u5faa\u73af\uff0c\u5305\u542b\u4e09\u4ef6\u4e8b\uff1a\u4e32\u53e3\u8f93\u5165\u3001\u5468\u671f\u63a7\u5236\u3001\u4e32\u53e3\u8f93\u51fa\u3002 \u7ed3\u6784\uff1a</p> <ol> <li> <p>\u4e32\u53e3\u547d\u4ee4\u63a5\u6536    \u628a\u4e00\u884c\u547d\u4ee4\u5b58\u8fdb <code>cmdLine</code>\uff0c\u9047\u5230 <code>\\n/\\r</code> \u5c31\u8c03\u7528 <code>handleCommand()</code>\u3002</p> </li> <li> <p>\u6309 CTRL_MS \u5468\u671f\u6267\u884c\u63a7\u5236\uff08\u4f60\u8bbe\u7f6e 10ms\uff09</p> </li> <li> <p>\u8bfb\u6e29\u5ea6 \u2192 <code>expectedDeg</code></p> </li> <li>\u8bfb\u7f16\u7801\u5668 \u2192 <code>countDrive</code></li> <li>\u8ba1\u7b97 <code>actualDeg</code></li> <li> <p>\u82e5 <code>mode == GO</code>\uff1a</p> </li> <li> <p>\u628a <code>expectedDeg \u2192 expectedCountDrive</code></p> </li> <li>\u5982\u679c\u76ee\u6807\u6539\u53d8\uff1a<code>motionStartTo(expectedCountDrive)</code>\uff08\u542f\u52a8/\u5237\u65b0\u8fd0\u52a8\u76ee\u6807\uff09</li> <li>STOP \u6a21\u5f0f\u4e0b\u82e5\u6ca1\u6709\u8fd0\u52a8\uff1a\u786e\u4fdd\u7535\u673a\u65ad\u7535</li> <li> <p>\u8c03\u7528 <code>motionUpdate()</code> \u6267\u884c\u8fd0\u52a8\u72b6\u6001\u673a</p> </li> <li> <p>\u6309 PRINT_MS \u5468\u671f\u6253\u5370\u72b6\u6001\uff08\u4f60\u8bbe\u7f6e 200ms\uff09    \u8f93\u51fa\uff1a</p> </li> <li> <p><code>T=...</code></p> </li> <li><code>expected=...</code>\uff08\u9884\u671f\u8f74\u89d2\uff09</li> <li><code>actual=...</code>\uff08\u5b9e\u9645\u8f74\u89d2\uff09</li> <li><code>count=...</code>\uff08\u9a71\u52a8\u8f6e count\uff09</li> <li><code>mode=GO/STOP</code></li> </ol>"},{"location":"notes/arduino/projet/code/#9","title":"9. \u53d8\u91cf/\u72b6\u6001\uff08\u62a5\u544a\u5e38\u7528\u89e3\u91ca\u70b9\uff09","text":"<ul> <li><code>mode</code>\uff1aSTOP/GO \u5de5\u4f5c\u6a21\u5f0f\uff08\u4e0a\u7535\u9ed8\u8ba4 STOP\uff09</li> <li><code>mstate</code>\uff1a\u8fd0\u52a8\u63a7\u5236\u72b6\u6001\u673a\uff08\u7c97\u8c03\u5feb/\u7c97\u8c03\u6162/\u7b49\u5f85/\u8109\u51b2/\u7a7a\u95f2\uff09</li> <li><code>calibOffsetDeg</code>\uff1a\u6821\u51c6\u504f\u79fb\uff08sync \u540e\u66f4\u65b0\uff0c\u7528\u4e8e\u4fee\u6b63\u201c\u7535\u673a\u65e0\u7edd\u5bf9\u96f6\u4f4d\u201d\uff09</li> <li><code>expectedDeg</code>\uff1a\u6e29\u5ea6\u6620\u5c04\u5f97\u5230\u7684\u9884\u671f\u6307\u9488\u8f74\u89d2\u5ea6</li> <li><code>actualDeg</code>\uff1a\u7f16\u7801\u5668\u53cd\u9988\u6362\u7b97\u5f97\u5230\u7684\u5b9e\u9645\u8f74\u89d2\u5ea6</li> <li><code>targetCountDrive</code>\uff1a\u8fd0\u52a8\u63a7\u5236\u7684\u76ee\u6807\u8ba1\u6570\uff08\u9a71\u52a8\u8f6e count\uff09</li> <li><code>expectedCountDrive</code>\uff1aGO \u6a21\u5f0f\u4e0b\u7531 expectedDeg \u8ba1\u7b97\u51fa\u7684\u76ee\u6807 count</li> </ul>"},{"location":"notes/arduino/projet/code/#1_1","title":"\u7b2c 1 \u5927\u6bb5","text":""},{"location":"notes/arduino/projet/code/#1_2","title":"\u7b2c 1 \u6bb5\uff1a\u5934\u6587\u4ef6\uff08\u5e93\uff09","text":""},{"location":"notes/arduino/projet/code/#include_2","title":"include","text":""},{"location":"notes/arduino/projet/code/#include_3","title":"include","text":""},{"location":"notes/arduino/projet/code/#include-arduino-i2c-mega-d20d21","title":"include \uff1a\u2705 Arduino \u5b98\u65b9\u81ea\u5e26\u5e93\uff0c\u7528\u6765\u64cd\u4f5c I2C \u603b\u7ebf\uff08\u4f60 Mega \u7684 D20/D21\uff09\u3002 <p>\u4f60\u4f1a\u7528\u5230\u7684\u51fd\u6570\uff1aWire.begin()\u3001Wire.beginTransmission()\u3001Wire.write()\u3001Wire.endTransmission()\u3001Wire.requestFrom()\u3001Wire.read() \u7b49\u3002</p>","text":""},{"location":"notes/arduino/projet/code/#include-encoder-pjrc-ab","title":"include \uff1a\u2705 \u7b2c\u4e09\u65b9 Encoder \u5e93\uff08PJRC \u5e38\u7528\u90a3\u4e2a\uff09\uff0c\u7528\u4e8e\u8bfb\u53d6\u589e\u91cf\u7f16\u7801\u5668 A/B \u76f8\u3002 <p>\u4f60\u4f1a\u7528\u5230\uff1aEncoder enc(pinA,pinB)\u3001enc.read()\u3001enc.write()\uff08\u4f60\u8fd9\u7248\u6ca1\u7528 write\uff09\u3002</p> <p>\u7ed3\u8bba\uff1a\u8fd9\u4e24\u884c\u90fd\u662f\u201c\u5e93\u63d0\u4f9b\u201d\uff0c\u4e0d\u662f\u4f60\u81ea\u5df1\u5199\u7684\u529f\u80fd\u3002</p>","text":""},{"location":"notes/arduino/projet/code/#2","title":"\u7b2c 2 \u6bb5\uff1a\u786c\u4ef6\u8fde\u63a5\u6ce8\u91ca\uff08\u53ea\u662f\u6ce8\u91ca\uff0c\u4e0d\u53c2\u4e0e\u7f16\u8bd1\uff09","text":"<p>/   Mega2560 Pin map:   I2C SDA -&gt; D20   I2C SCL -&gt; D21   Motor DIR -&gt; D8   Motor EN(PWM) -&gt; D9   Encoder A -&gt; D2   Encoder B -&gt; D3 /</p> <p>\u53ea\u662f\u8bf4\u660e\u63a5\u7ebf\uff0c\u4e0d\u4f1a\u5f71\u54cd\u7a0b\u5e8f\u3002</p> <p>\u5176\u4e2d \u201cI2C SDA/SCL\u201d \u8fd9\u4e24\u4e2a\u5f15\u811a\u662f Mega \u56fa\u5b9a\u7684 I2C \u5f15\u811a\uff1aD20/D21\u3002</p>"},{"location":"notes/arduino/projet/code/#3_1","title":"\u7b2c 3 \u6bb5\uff1a\u5f15\u811a\u5e38\u91cf\uff08\u81ea\u5df1\u5b9a\u4e49\u7684\uff09","text":"<p>const uint8_t PIN_DIR   = 8; const uint8_t PIN_EN    = 9; const uint8_t PIN_ENC_A = 2; const uint8_t PIN_ENC_B = 3;</p> <p>\u8fd9\u4e9b\u662f\u2705 \u4f60\u81ea\u5df1\u5b9a\u4e49\u7684\u5e38\u91cf\uff08\u53ea\u662f\u4e3a\u4e86\u4ee3\u7801\u53ef\u8bfb\u6027\uff09\u3002</p> <p>PIN_DIR\uff1a\u7535\u673a\u65b9\u5411\u63a7\u5236\u811a\uff08D8\uff09</p> <p>PIN_EN\uff1a\u7535\u673a PWM \u4f7f\u80fd\u811a\uff08D9\uff09</p> <p>PIN_ENC_A/B\uff1a\u7f16\u7801\u5668 A/B \u76f8\uff08D2/D3\uff09</p> <p>uint8_t \u662f C/C++ \u7684\u6807\u51c6\u7c7b\u578b\uff08Arduino \u4e5f\u6709\uff09\uff0c\u8868\u793a 0~255 \u7684\u65e0\u7b26\u53f7\u6574\u6570\u3002</p>"},{"location":"notes/arduino/projet/code/#4_1","title":"\u7b2c 4 \u6bb5\uff1a\u65b9\u5411\u53cd\u8f6c\u5f00\u5173\uff08\u81ea\u5df1\u5b9a\u4e49\u7684\u201c\u8c03\u8bd5\u5f00\u5173\u201d\uff09","text":"<p>const bool INVERT_MOTOR_DIR = true; const bool INVERT_ENCODER   = true;</p> <p>\u8fd9\u4e5f\u662f\u2705 \u4f60\u81ea\u5df1\u5b9a\u4e49\u7684\u5e38\u91cf\uff08\u4e0d\u662f\u5e93\u81ea\u5e26\uff09\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8981\u6709\u5b83\uff1f</p> <p>\u4f60\u63a5\u7ebf/\u5b89\u88c5\u65b9\u5411\u53ef\u80fd\u5bfc\u81f4\uff1a</p> <p>\u7535\u673a\u6b63\u53cd\u65b9\u5411\u8ddf\u4f60\u60f3\u7684\u76f8\u53cd</p> <p>\u7f16\u7801\u5668\u8ba1\u6570\u6b63\u8d1f\u53f7\u76f8\u53cd \u6240\u4ee5\u6211\u4eec\u7528\u8fd9\u4e24\u4e2a\u5f00\u5173\u201c\u8f6f\u4ef6\u7ea0\u6b63\u201d\uff0c\u4e0d\u7528\u6539\u63a5\u7ebf\u3002</p> <p>\u5b83\u4eec\u5728\u54ea\u7528\uff1f</p> <p>INVERT_MOTOR_DIR\uff1a\u5728 setMotor() \u91cc\u51b3\u5b9a\u662f\u5426 dirHigh = !dirHigh;</p> <p>INVERT_ENCODER\uff1a\u5728 readCountDrive() \u91cc\u51b3\u5b9a\u662f\u5426 c = -c;</p>"},{"location":"notes/arduino/projet/code/#5_1","title":"\u7b2c 5 \u6bb5\uff1a\u673a\u68b0\u53c2\u6570\uff08\u81ea\u5df1\u5b9a\u4e49\uff0c\u6765\u81ea\u4f60\u7684\u5b9e\u6d4b\u4e0e\u7ed3\u6784\uff09","text":"<p>const long  ONE_REV_COUNTS = 12; const float GEAR_RATIO = 52.734f;</p> <p>\u8fd9\u4e24\u4e2a\u662f\u2705 \u4f60\u81ea\u5df1\u5b9a\u4e49\u7684\u5e38\u91cf\uff0c\u4e0d\u662f\u5e93\u81ea\u5e26\u3002</p> <p>ONE_REV_COUNTS = 12\uff1a\u4f60\u5b9e\u6d4b\u201c\u9a71\u52a8\u8f6e\u8f6c 1 \u5708\uff0cEncoder \u8f93\u51fa\u53d8\u5316 12 count\u201d\u3002</p> <p>GEAR_RATIO = 52.734\uff1a\u4f60\u7684\u51cf\u901f\u6bd4\uff08\u9a71\u52a8\u8f6e : \u6307\u9488\u8f74 = 52.734 : 1\uff09</p> <p>\u6ce8\u610f\uff1a\u8fd9\u4e24\u4e2a\u662f\u6574\u4e2a\u201c\u89d2\u5ea6\u6362\u7b97\u201d\u6b63\u786e\u4e0e\u5426\u7684\u6839\u3002</p>"},{"location":"notes/arduino/projet/code/#6-count-inline","title":"\u7b2c 6 \u6bb5\uff1a\u6bcf\u4e2a count \u5bf9\u5e94\u6307\u9488\u8f74\u591a\u5c11\u5ea6\uff08\u81ea\u5df1\u5199\u7684 inline \u51fd\u6570\uff09","text":"<p>static inline float degPerDriveCountOnShaft() {   return 360.0f / (float)ONE_REV_COUNTS / GEAR_RATIO; }</p> <p>\u8fd9\u662f\u2705 \u4f60\u81ea\u5df1\uff08\u6211\u4eec\uff09\u5199\u7684\u51fd\u6570\uff0c\u4e0d\u662f\u5e93\u81ea\u5e26\u3002</p> <p>static inline \u7684\u610f\u601d\uff1a</p> <p>inline\uff1a\u5efa\u8bae\u7f16\u8bd1\u5668\u628a\u51fd\u6570\u5c55\u5f00\uff08\u66f4\u5feb\uff09</p> <p>static\uff1a\u9650\u5236\u4f5c\u7528\u57df\u5728\u5f53\u524d\u6587\u4ef6\uff08\u907f\u514d\u94fe\u63a5\u51b2\u7a81\uff09</p> <p>\u5b83\u505a\u7684\u4e8b\uff1a\u5efa\u7acb\u201ccount \u2192 \u6307\u9488\u8f74\u89d2\u5ea6\u201d\u7684\u6bd4\u4f8b\u5c3a \u63a8\u5bfc\uff1a</p> <p>\u9a71\u52a8\u8f6e 1 \u5708 = 12 count</p> <p>\u9a71\u52a8\u8f6e\u8f6c 52.734 \u5708 \u2192 \u6307\u9488\u8f74\u8f6c 1 \u5708 = 360\u00b0</p> <p>\u6240\u4ee5 1 count \u2192 \u6307\u9488\u8f74\u89d2\u5ea6\uff1a\u8fd9\u4e2a\u51fd\u6570\u4f1a\u88ab\u4e24\u4e2a\u5173\u952e\u5730\u65b9\u7528\u5230\uff1a</p> <p>driveCountToShaftDeg()\uff1acount \u2192 \u5b9e\u9645\u89d2\u5ea6 actualDeg</p> <p>expectedDegToTargetCount()\uff1a\u9884\u671f\u89d2\u5ea6 expectedDeg \u2192 \u76ee\u6807 count</p>"},{"location":"notes/arduino/projet/code/#7","title":"\u7b2c 7 \u6bb5\uff1a\u89d2\u5ea6\u5f52\u4e00\u5316\uff08\u81ea\u5df1\u5199\u7684\u51fd\u6570\uff09","text":"<p>static inline float wrap180(float a) {   while (a &gt; 180.0f) a -= 360.0f;   while (a &lt;= -180.0f) a += 360.0f;   return a; }</p> <p>\u8fd9\u4e5f\u662f\u2705 \u4f60\u81ea\u5df1\u5199\u7684\u51fd\u6570\u3002</p> <p>\u5b83\u505a\u7684\u4e8b\uff1a\u628a\u89d2\u5ea6\u9650\u5236\u5728 (-180, 180]\uff0c\u56e0\u4e3a\u89d2\u5ea6\u662f\u5468\u671f\u7684\u3002</p> <p>\u4e3a\u4ec0\u4e48\u5fc5\u8981\uff1f</p> <p>\u907f\u514d\u89d2\u5ea6\u8dd1\u5230 540\u00b0\u3001-900\u00b0 \u8fd9\u79cd\u6570\u503c</p> <p>\u8ba9\u8bef\u5dee\u8ba1\u7b97\u603b\u662f\u8d70\u201c\u6700\u77ed\u65b9\u5411\u201d</p> <p>\u8ba9 sync \u6821\u51c6\u4e0d\u4f1a\u7d2f\u79ef\u504f\u79fb\u5230\u975e\u5e38\u5927</p>"},{"location":"notes/arduino/projet/code/#8-count","title":"\u7b2c 8 \u6bb5\uff1a\u8f74\u89d2 \u2192 count\uff08\u81ea\u5df1\u5199\u7684\u8f85\u52a9\u6362\u7b97\uff09","text":"<p>static inline long shaftDegToDriveCount(float deg) {   return lroundf(deg / degPerDriveCountOnShaft()); }</p> <p>\u2705 \u81ea\u5df1\u5199\u7684\u51fd\u6570</p> <p>lroundf()\uff1aC/C++ \u6807\u51c6\u6570\u5b66\u51fd\u6570\uff08Arduino \u652f\u6301\uff09\uff0c\u628a float \u56db\u820d\u4e94\u5165\u5230 long</p> <p>\u5b83\u505a\u7684\u4e8b\uff1a\u7ed9\u5b9a\u201c\u6307\u9488\u8f74\u8f6c\u4e86\u591a\u5c11\u5ea6\u201d\uff0c\u6362\u7b97\u51fa\u9700\u8981\u591a\u5c11\u4e2a count\u3002</p> <p>\u4f60\u5f53\u524d\u7a0b\u5e8f\u91cc\u4e3b\u8981\u7528\u7684\u662f expectedDegToTargetCount()\uff0c\u8fd9\u4e2a shaftDegToDriveCount() \u73b0\u5728\u76f8\u5f53\u4e8e\u5907\u7528\u5de5\u5177\u51fd\u6570\u3002</p>"},{"location":"notes/arduino/projet/code/#9-count","title":"\u7b2c 9 \u6bb5\uff1acount \u2192 \u5b9e\u9645\u8f74\u89d2\uff08\u81ea\u5df1\u5199\u7684\u5173\u952e\u6362\u7b97\uff09","text":"<p>static inline float driveCountToShaftDeg(long countDrive, float calibOffsetDeg) {   return wrap180((float)countDrive * degPerDriveCountOnShaft() + calibOffsetDeg); }</p> <p>\u8fd9\u662f\u2705 \u81ea\u5df1\u5199\u7684\u51fd\u6570\uff0c\u4e5f\u662f\u975e\u5e38\u5173\u952e\u7684\u201c\u6d4b\u91cf\u6a21\u578b\u201d\u3002</p> <p>countDrive * degPerDriveCountOnShaft()\uff1a\u628a\u7f16\u7801\u5668 count \u53d8\u6210\u8f74\u89d2</p> <ul> <li>calibOffsetDeg\uff1a\u52a0\u4e0a\u6821\u51c6\u504f\u79fb\uff08\u56e0\u4e3a\u7535\u673a\u6ca1\u6709\u7edd\u5bf9\u96f6\u4f4d\uff09</li> </ul> <p>wrap180(...)\uff1a\u628a\u89d2\u5ea6\u6298\u56de (-180,180]\uff0c\u9632\u6b62\u8d8a\u754c</p> <p>\u8fd9\u884c\u6700\u7ec8\u751f\u6210\uff1aactualDeg\uff08\u5b9e\u9645\u89d2\u5ea6\uff09\uff0c\u7528\u4e8e\uff1a</p> <p>\u4e32\u53e3\u6253\u5370</p> <p>sync \u6821\u51c6\uff08expectedDeg - actualDeg\uff09</p>"},{"location":"notes/arduino/projet/code/#2_1","title":"\u7b2c 2 \u5927\u6bb5","text":""},{"location":"notes/arduino/projet/code/#21-i2c","title":"2.1 \u4f20\u611f\u5668 I2C \u5730\u5740\uff08\u81ea\u5df1\u5b9a\u4e49\uff09","text":"<p>const uint8_t MPL3115A2_ADDR = 0x60;</p> <p>\u2705 \u4f60\u81ea\u5df1\u5b9a\u4e49\u7684\u5e38\u91cf</p> <p>0x60 \u662f MPL3115A2 \u82af\u7247\u5728 I2C \u603b\u7ebf\u4e0a\u7684\u5730\u5740</p> <p>\u540e\u9762\u6240\u6709 I2C \u8bfb\u5199\u90fd\u4f1a\u7528\u5230\u8fd9\u4e2a\u5730\u5740</p> <p>\u5982\u679c\u4f60\u6362\u6210\u522b\u7684\u6e29\u5ea6\u4f20\u611f\u5668\uff0c\u8fd9\u4e00\u6bb5\u51e0\u4e4e\u4e00\u5b9a\u8981\u6539</p>"},{"location":"notes/arduino/projet/code/#22-i2c-1","title":"2.2 I2C \u5199 1 \u4e2a\u5bc4\u5b58\u5668\uff08\u81ea\u5df1\u5199\u7684\u201c\u5c01\u88c5\u51fd\u6570\u201d\uff09","text":"<p>bool i2cWrite8(uint8_t addr, uint8_t reg, uint8_t val) {   Wire.beginTransmission(addr);   Wire.write(reg);   Wire.write(val);   return (Wire.endTransmission() == 0); }</p> <p>\u8fd9\u662f\u4ec0\u4e48\uff1f</p> <p>\u2705 \u4f60\u81ea\u5df1\u5199\u7684\u51fd\u6570</p> <p>\u4f46\u91cc\u9762\u7528\u5230\u7684 Wire.xxx \u90fd\u662f Arduino Wire \u5e93\u81ea\u5e26</p> <p>\u4e00\u884c\u4e00\u884c\u8bb2\uff1a Wire.beginTransmission(addr);</p> <p>\u26d4 \u4e0d\u662f\u4f60\u5199\u7684</p> <p>\u2705 Wire \u5e93\u51fd\u6570</p> <p>\u610f\u601d\uff1a\u5f00\u59cb\u5411 I2C \u8bbe\u5907 addr \u53d1\u9001\u6570\u636e</p> <p>Wire.write(reg);</p> <p>\u5411\u8bbe\u5907\u53d1\u9001\u201c\u5bc4\u5b58\u5668\u5730\u5740\u201d</p> <p>Wire.write(val);</p> <p>\u5411\u8fd9\u4e2a\u5bc4\u5b58\u5668\u5199\u5165\u6570\u636e</p> <p>return (Wire.endTransmission() == 0);</p> <p>\u7ed3\u675f\u4f20\u8f93</p> <p>endTransmission() \u8fd4\u56de 0 \u8868\u793a\u6210\u529f</p> <p>\u51fd\u6570\u6574\u4f53\u8fd4\u56de true / false</p> <p>\u5728\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528</p> <p>\ud83d\udc49 \u521d\u59cb\u5316\u4f20\u611f\u5668\u5bc4\u5b58\u5668\u65f6\u7528 \ud83d\udc49 \u6bd4\u5982\u201c\u5f00\u542f\u6e29\u5ea6\u6d4b\u91cf\u201d\u201c\u914d\u7f6e\u6a21\u5f0f\u201d</p>"},{"location":"notes/arduino/projet/code/#23-i2c","title":"2.3 I2C \u8bfb\u591a\u4e2a\u5b57\u8282\uff08\u81ea\u5df1\u5199\u7684\u5c01\u88c5\uff09","text":"<p>bool i2cReadBytes(uint8_t addr, uint8_t reg, uint8_t* buf, uint8_t len) {   Wire.beginTransmission(addr);   Wire.write(reg);   if (Wire.endTransmission(false) != 0) return false;}</p> <p>\u8fd9\u51e0\u884c\u5728\u5e72\u561b\uff1f Wire.beginTransmission(addr); Wire.write(reg);</p> <p>\u544a\u8bc9\u8bbe\u5907\uff1a\u201c\u6211\u63a5\u4e0b\u6765\u8981\u4ece reg \u8fd9\u4e2a\u5bc4\u5b58\u5668\u5f00\u59cb\u8bfb\u201d</p> <p>Wire.endTransmission(false)</p> <p>false \u7684\u610f\u601d\u662f\uff1a\u4e0d\u8981\u91ca\u653e I2C \u603b\u7ebf</p> <p>\u8fd9\u662f I2C \u7684\u201c\u91cd\u590d\u8d77\u59cb\uff08repeated start\uff09\u201d</p> <p>\u662f\u6807\u51c6\u505a\u6cd5\uff0c\u4e0d\u662f\u4f60\u53d1\u660e\u7684</p> <p>if (Wire.endTransmission(false) != 0) return false;</p> <p>\u5982\u679c\u901a\u4fe1\u5931\u8d25\uff0c\u76f4\u63a5\u8fd4\u56de false</p> <p>\u63a5\u7740\u5f80\u4e0b uint8_t got = Wire.requestFrom(addr, len); if (got != len) return false;</p> <p>Wire.requestFrom()\uff1a</p> <p>\u2705 Wire \u5e93\u81ea\u5e26</p> <p>\u4ece\u8bbe\u5907\u8bfb\u53d6 len \u4e2a\u5b57\u8282</p> <p>\u5982\u679c\u6ca1\u8bfb\u591f\uff0c\u5224\u5b9a\u5931\u8d25</p> <p>\u628a\u6570\u636e\u8bfb\u51fa\u6765 for (uint8_t i = 0; i &lt; len; i++) buf[i] = Wire.read(); return true;</p> <p>Wire.read()\uff1aWire \u5e93\u51fd\u6570</p> <p>\u628a\u5b57\u8282\u5b58\u8fdb\u4f60\u63d0\u4f9b\u7684\u6570\u7ec4 buf</p> <p>\u5728\u7cfb\u7edf\u4e2d\u7684\u4f5c\u7528</p> <p>\ud83d\udc49 \u6240\u6709\u4f20\u611f\u5668\u6570\u636e\u8bfb\u53d6\u7684\u57fa\u7840\u5de5\u5177\u51fd\u6570</p>"},{"location":"notes/arduino/projet/code/#24-mpl3115a2","title":"2.4 \u521d\u59cb\u5316 MPL3115A2\uff08\u81ea\u5df1\u5199\u7684\u903b\u8f91\uff09","text":"<p>bool mpl3115a2Init() {   if (!i2cWrite8(MPL3115A2_ADDR, 0x13, 0x07)) return false;</p> <p>\u8fd9\u884c\u4ec0\u4e48\u610f\u601d\uff1f</p> <p>0x13\uff1aPT_DATA_CFG \u5bc4\u5b58\u5668</p> <p>0x07\uff1a\u6253\u5f00\u6570\u636e\u5c31\u7eea\u4e2d\u65ad\uff08\u6e29\u5ea6/\u6c14\u538b\uff09</p> <p>\u8fd9\u662f MPL3115A2 \u6570\u636e\u624b\u518c\u89c4\u5b9a\u7684</p> <p>\ud83d\udc49 \u4f60\u4e0d\u662f\u201c\u968f\u4fbf\u5199\u201d\uff0c\u800c\u662f\u7167 datasheet \u914d\u7684</p> <p>if (!i2cWrite8(MPL3115A2_ADDR, 0x26, 0xB9)) return false;</p> <p>0x26\uff1aCTRL_REG1</p> <p>0xB9 \u542b\u4e49\uff08\u91cd\u8981\uff0c\u5199\u62a5\u544a\u53ef\u4ee5\u7528\uff09\uff1a</p> <p>ALT=0 \u2192 \u6e29\u5ea6/\u6c14\u538b\u6a21\u5f0f</p> <p>OSR \u2192 \u8fc7\u91c7\u6837</p> <p>ACTIVE=1 \u2192 \u5f00\u59cb\u6d4b\u91cf</p> <p>delay(10);   return true; }</p> <p>\u7ed9\u82af\u7247\u4e00\u70b9\u542f\u52a8\u65f6\u95f4</p> <p>\u8fd4\u56de\u521d\u59cb\u5316\u6210\u529f</p> <p>\u7ed3\u8bba</p> <p>\u2705 mpl3115a2Init() \u662f\u4f60\u81ea\u5df1\u5199\u7684</p> <p>\u26a0\ufe0f \u4f46\u5bc4\u5b58\u5668\u5730\u5740 &amp; \u6570\u503c\u6765\u81ea\u5b98\u65b9\u624b\u518c</p>"},{"location":"notes/arduino/projet/code/#25","title":"2.5 \u8bfb\u53d6\u6e29\u5ea6\uff08\u6838\u5fc3\u51fd\u6570\uff09","text":"<p>bool readTemperatureC(float &amp;tempC) {   uint8_t buf[2];   if (!i2cReadBytes(MPL3115A2_ADDR, 0x04, buf, 2)) return false;</p> <p>\u89e3\u91ca</p> <p>0x04\uff1a\u6e29\u5ea6\u5bc4\u5b58\u5668\u8d77\u59cb\u5730\u5740</p> <p>\u8fde\u7eed\u8bfb 2 \u4e2a\u5b57\u8282\uff08MSB + LSB\uff09</p> <p>\u5982\u679c\u5931\u8d25\u76f4\u63a5\u8fd4\u56de false</p> <p>int8_t msb = (int8_t)buf[0];   uint8_t lsb = buf[1];</p> <p>MSB\uff1a\u6e29\u5ea6\u6574\u6570\u90e8\u5206\uff08\u6709\u7b26\u53f7\uff09</p> <p>LSB\uff1a\u5c0f\u6570\u90e8\u5206\uff08\u9ad8 4 \u4f4d\u6709\u6548\uff09</p> <p>float frac = (float)(lsb &gt;&gt; 4) / 16.0f;</p> <p>MPL3115A2 \u7684\u6e29\u5ea6\u7cbe\u5ea6\u662f 1/16 \u00b0C</p> <p>\u53f3\u79fb 4 \u4f4d\u540e\u518d\u9664\u4ee5 16</p> <p>tempC = (float)msb + ((msb &gt;= 0) ? frac : -frac);   return true; }</p> <p>\u6b63\u6e29\uff1a\u52a0\u5c0f\u6570</p> <p>\u8d1f\u6e29\uff1a\u51cf\u5c0f\u6570\uff08\u8fd9\u662f datasheet \u63a8\u8350\u5199\u6cd5\uff09</p> <p>\u5728\u6574\u4e2a\u7cfb\u7edf\u91cc\u7684\u4f4d\u7f6e\uff08\u975e\u5e38\u91cd\u8981\uff09</p> <p>\ud83d\udc49 \u8fd9\u662f\u552f\u4e00\u4e00\u4e2a\u201c\u771f\u5b9e\u4e16\u754c \u2192 \u6570\u5b57\u4e16\u754c\u201d\u7684\u5165\u53e3</p> <p>\u4f20\u611f\u5668 \u2192 tempC</p> <p>\u540e\u9762\uff1a</p> <p>tempC \u2192 expectedDeg</p> <p>expectedDeg \u2192 expectedCountDrive</p> <p>expectedCountDrive \u2192 \u7535\u673a\u52a8\u4f5c</p>"},{"location":"notes/arduino/projet/code/#3_2","title":"\u7b2c 3 \u5927\u6bb5\uff1a\u6e29\u5ea6 \u2192 \u671f\u671b\u6307\u9488\u89d2\u5ea6\uff08\u5efa\u6a21\u6838\u5fc3\uff09","text":""},{"location":"notes/arduino/projet/code/#31","title":"3.1 \u6e29\u5ea6\u8303\u56f4\u53c2\u6570\uff08\u4f60\u81ea\u5df1\u5b9a\u4e49\u7684\u201c\u8bbe\u8ba1\u6307\u6807\u201d\uff09","text":"<pre><code>const float TEMP_MIN = 20.0f;\nconst float TEMP_MAX = 30.0f;\n</code></pre> <ul> <li>\u2705 \u5b8c\u5168\u7531\u4f60\u5b9a\u4e49</li> <li>\u8fd9\u662f\u7cfb\u7edf\u7684\u5de5\u4f5c\u6e29\u5ea6\u91cf\u7a0b</li> <li> <p>\u7269\u7406\u542b\u4e49\uff1a</p> </li> <li> <p>\u6e29\u5ea6 \u2264 20\u00b0C \u2192 \u5f53\u4f5c 20\u00b0C</p> </li> <li>\u6e29\u5ea6 \u2265 30\u00b0C \u2192 \u5f53\u4f5c 30\u00b0C</li> </ul> <p>\ud83d\udccc \u5728\u62a5\u544a\u4e2d\u53ef\u4ee5\u5199\u6210\uff1a</p> <p>\u7cfb\u7edf\u5bf9\u6e29\u5ea6\u8fdb\u884c\u9650\u5e45\u5904\u7406\uff0c\u4ec5\u5728 [20\u00b0C, 30\u00b0C] \u533a\u95f4\u5185\u8fdb\u884c\u89d2\u5ea6\u6620\u5c04\u3002</p>"},{"location":"notes/arduino/projet/code/#32","title":"3.2 \u89d2\u5ea6\u8303\u56f4\u53c2\u6570\uff08\u4f60\u81ea\u5df1\u5b9a\u4e49\u7684\u201c\u673a\u68b0\u6307\u6807\u201d\uff09","text":"<pre><code>const float ANGLE_MIN = -120.0f;\nconst float ANGLE_MAX =  120.0f;\n</code></pre> <ul> <li>\u2705 \u4f60\u81ea\u5df1\u5b9a\u4e49</li> <li>\u8868\u793a\u6307\u9488\u8f74\u7684\u5141\u8bb8\u65cb\u8f6c\u8303\u56f4</li> <li> <p>\u7269\u7406\u542b\u4e49\uff1a</p> </li> <li> <p>\u6700\u4f4e\u6e29\u5ea6 \u2192 \u6307\u9488\u6700\u5de6\uff08-120\u00b0\uff09</p> </li> <li>\u6700\u9ad8\u6e29\u5ea6 \u2192 \u6307\u9488\u6700\u53f3\uff08+120\u00b0\uff09</li> </ul> <p>\ud83d\udccc \u8fd9\u662f\u201c\u6e29\u5ea6\u8868\u76d8\u523b\u5ea6\u201d\u7684\u76f4\u63a5\u6570\u5b57\u5316\u4f53\u73b0\u3002</p>"},{"location":"notes/arduino/projet/code/#33","title":"3.3 \u6e29\u5ea6 \u2192 \u89d2\u5ea6\u6620\u5c04\u51fd\u6570\uff08\u4f60\u81ea\u5df1\u5199\u7684\u6838\u5fc3\u6a21\u578b\uff09","text":"<pre><code>static inline float tempToAngleDeg(float t) {\n</code></pre> <ul> <li>\u2705 \u4f60\u81ea\u5df1\u5199\u7684\u51fd\u6570</li> <li>\u8f93\u5165\uff1a\u6e29\u5ea6\uff08\u00b0C\uff09</li> <li>\u8f93\u51fa\uff1a\u671f\u671b\u6307\u9488\u8f74\u89d2\u5ea6\uff08\u00b0\uff09</li> </ul>"},{"location":"notes/arduino/projet/code/#_2","title":"\u7b2c\u4e00\u6b65\uff1a\u6e29\u5ea6\u9650\u5e45\uff08\u9632\u6b62\u5f02\u5e38\uff09","text":"<pre><code>  if (t &lt; TEMP_MIN) t = TEMP_MIN;\n  if (t &gt; TEMP_MAX) t = TEMP_MAX;\n</code></pre> <ul> <li> <p>\u9632\u6b62\uff1a</p> </li> <li> <p>\u4f20\u611f\u5668\u5f02\u5e38</p> </li> <li>\u8d85\u51fa\u91cf\u7a0b\u5bfc\u81f4\u6307\u9488\u4e71\u8f6c</li> <li>\u8fd9\u662f\u5de5\u7a0b\u4e2d\u975e\u5e38\u6807\u51c6\u7684\u505a\u6cd5</li> </ul> <p>\ud83d\udccc \u62a5\u544a\u672f\u8bed\uff1a</p> <p>\u4e3a\u63d0\u9ad8\u7cfb\u7edf\u9c81\u68d2\u6027\uff0c\u5bf9\u6e29\u5ea6\u8f93\u5165\u8fdb\u884c\u9971\u548c\u5904\u7406\uff08clamping\uff09\u3002</p>"},{"location":"notes/arduino/projet/code/#_3","title":"\u7b2c\u4e8c\u6b65\uff1a\u7ebf\u6027\u6620\u5c04\uff08\u6838\u5fc3\u516c\u5f0f\uff09","text":"<pre><code>  float a = ANGLE_MIN \n          + (t - TEMP_MIN) \n          * (ANGLE_MAX - ANGLE_MIN) \n          / (TEMP_MAX - TEMP_MIN);\n</code></pre> <p>\u8fd9\u662f\u6574\u5957\u7cfb\u7edf\u6700\u91cd\u8981\u7684\u4e00\u884c\u4e4b\u4e00\uff0c\u6211\u4eec\u6162\u6162\u62c6\u3002</p>"},{"location":"notes/arduino/projet/code/#_4","title":"\u6570\u5b66\u5f62\u5f0f\uff1a","text":"<p>[ a = a_{min} + \\frac{t - t_{min}}{t_{max} - t_{min}} (a_{max} - a_{min}) ]</p>"},{"location":"notes/arduino/projet/code/#_5","title":"\u7269\u7406\u542b\u4e49\uff1a","text":"<ul> <li>\u6e29\u5ea6\u5728 <code>[TEMP_MIN, TEMP_MAX]</code> \u5185</li> <li>\u6309\u6bd4\u4f8b\u6620\u5c04\u5230 <code>[ANGLE_MIN, ANGLE_MAX]</code></li> </ul>"},{"location":"notes/arduino/projet/code/#_6","title":"\u4f60\u7684\u5177\u4f53\u6570\u503c\uff1a","text":"<ul> <li>\u6e29\u5ea6\u8de8\u5ea6\uff1a30 \u2212 20 = 10\u00b0C</li> <li>\u89d2\u5ea6\u8de8\u5ea6\uff1a120 \u2212 (\u2212120) = 240\u00b0</li> <li>\u7075\u654f\u5ea6\uff1a   [   24^\\circ / ^\\circ C   ]</li> </ul> <p>\ud83d\udccc \u62a5\u544a\u53ef\u5199\uff1a</p> <p>\u672c\u7cfb\u7edf\u91c7\u7528\u7ebf\u6027\u6bd4\u4f8b\u6620\u5c04\uff0c\u5c06\u6e29\u5ea6\u53d8\u5316\u7b49\u6bd4\u4f8b\u8f6c\u6362\u4e3a\u6307\u9488\u89d2\u5ea6\u53d8\u5316\u3002</p>"},{"location":"notes/arduino/projet/code/#_7","title":"\u7b2c\u4e09\u6b65\uff1a\u89d2\u5ea6\u5f52\u4e00\u5316\uff08\u5b89\u5168\u63aa\u65bd\uff09","text":"<pre><code>  return wrap180(a);\n}\n</code></pre> <ul> <li>\u4f7f\u7528\u4f60\u524d\u9762\u5b9a\u4e49\u7684 <code>wrap180()</code></li> <li>\u4fdd\u8bc1\u89d2\u5ea6\u6c38\u8fdc\u5728 (-180\u00b0, 180\u00b0] \u5185</li> <li> <p>\u9632\u6b62\uff1a</p> </li> <li> <p>\u504f\u79fb\u53e0\u52a0</p> </li> <li>\u540c\u6b65\u6821\u51c6\u540e\u89d2\u5ea6\u8d8a\u754c</li> </ul> <p>\ud83d\udccc \u6ce8\u610f\uff1a</p> <p>\u5373\u4f7f\u4f60\u73b0\u5728\u89d2\u5ea6\u8303\u56f4\u662f \u00b1120\u00b0\uff0c \u8fd9\u4e2a\u51fd\u6570\u4f9d\u7136\u6709\u610f\u4e49\uff0c\u662f\u201c\u901a\u7528\u5b89\u5168\u4fdd\u62a4\u201d\u3002</p>"},{"location":"notes/arduino/projet/code/#34","title":"3.4 \u8fd9\u4e00\u6bb5\u5728\u7cfb\u7edf\u4e2d\u7684\u4f4d\u7f6e\uff08\u5f3a\u70c8\u5efa\u8bae\u5199\uff09","text":"<p>\u6574\u4e2a\u6570\u636e\u94fe\u8def\u662f\uff1a</p> <pre><code>\u771f\u5b9e\u6e29\u5ea6 (\u00b0C)\n   \u2193  readTemperatureC()\ntempC\n   \u2193  tempToAngleDeg()\nexpectedDeg\n   \u2193  expectedDegToTargetCount()\nexpectedCountDrive\n   \u2193  motion controller\n\u7535\u673a \u2192 \u6307\u9488\u8f74\n</code></pre> <p>\u8fd9\u4e00\u6b65\u4e0d\u6d89\u53ca\u7535\u673a\u3001\u4e0d\u6d89\u53ca PID\u3001\u4e0d\u6d89\u53ca\u7f16\u7801\u5668\uff0c \u5b83\u662f\u7eaf\u6570\u5b66\u5efa\u6a21\u5c42\u3002</p>"},{"location":"notes/arduino/projet/code/#35","title":"3.5 \u5982\u679c\u4ee5\u540e\u8981\u6539\u91cf\u7a0b\uff0c\u9700\u8981\u6539\u54ea\u91cc\uff1f","text":"<p>\u4f8b\u5982\u4f60\u8001\u5e08\u95ee\uff1a</p> <p>\u201c\u5982\u679c\u6e29\u5ea6\u8303\u56f4\u6539\u6210 -20~60\u00b0C\uff0c\u89d2\u5ea6\u6539\u6210 -90~90\u00b0\uff0c\u8981\u6539\u4ec0\u4e48\uff1f\u201d</p> <p>\u4f60\u53ef\u4ee5\u975e\u5e38\u81ea\u4fe1\u5730\u56de\u7b54\uff1a</p> <p>\u2705 \u53ea\u9700\u8981\u6539 4 \u4e2a\u53c2\u6570\uff1a</p> <pre><code>const float TEMP_MIN  = -20.0f;\nconst float TEMP_MAX  =  60.0f;\nconst float ANGLE_MIN = -90.0f;\nconst float ANGLE_MAX =  90.0f;\n</code></pre> <p>\u274c \u4e0d\u9700\u8981\u6539\uff1a</p> <ul> <li>\u7535\u673a\u63a7\u5236\u53c2\u6570</li> <li>\u7f16\u7801\u5668\u53c2\u6570</li> <li>\u8fd0\u52a8\u72b6\u6001\u673a</li> <li>PI / P / nudge \u903b\u8f91</li> </ul> <p>\ud83d\udccc \u8fd9\u662f\u4f60\u7a0b\u5e8f\u7ed3\u6784\u8bbe\u8ba1\u5f97\u975e\u5e38\u597d\u7684\u5730\u65b9\u3002</p> <p>\u5982\u679c\u4f60\u56de\u590d \u201c\u7ee7\u7eed\u201d\uff0c \u4e0b\u4e00\u6bb5\u6211\u4f1a\u8bb2\uff1a</p> <p>\ud83d\udc49 \u7535\u673a\u63a7\u5236\u4e0e\u7f16\u7801\u5668\u63a5\u53e3\uff08setMotor / readCountDrive\uff09 \u8fd9\u662f\u201c\u8f6f\u4ef6\u5982\u4f55\u771f\u6b63\u9a71\u52a8\u7269\u7406\u4e16\u754c\u201d\u7684\u90e8\u5206\uff0c\u4e5f\u662f\u4f60\u9707\u8361\u95ee\u9898\u5f53\u521d\u7684\u6839\u6e90\u4e4b\u4e00\u3002</p> <p>\u597d\uff0c\u6211\u4eec\u7ee7\u7eed \ud83d\udc4d \u8fd9\u4e00\u6bb5\u662f\u201c\u8f6f\u4ef6\u5982\u4f55\u771f\u6b63\u9a71\u52a8\u7269\u7406\u4e16\u754c\u201d\uff1a \ud83d\udc49 \u7535\u673a + \u7f16\u7801\u5668\u63a5\u53e3\u5c42\u3002 \u8fd9\u662f\u4f60\u4e4b\u524d\u51fa\u73b0\u9707\u52a8\u3001\u65b9\u5411\u53cd\u3001count \u98d8\u7b49\u95ee\u9898\u7684\u6839\u6e90\u5c42\uff0c\u975e\u5e38\u5173\u952e\u3002</p> <p>\u6211\u8fd8\u662f\u51e0\u884c\u51e0\u884c\u8bb2\uff0c\u5e76\u4e14\u660e\u786e\u544a\u8bc9\u4f60\uff1a</p> <ul> <li>\u54ea\u4e9b\u662f \u4f60\u81ea\u5df1\u5b9a\u4e49\u7684</li> <li>\u54ea\u4e9b\u662f \u5e93/Arduino \u5df2\u6709\u7684</li> </ul>"},{"location":"notes/arduino/projet/code/#4_2","title":"\u7b2c 4 \u5927\u6bb5\uff1a\u7535\u673a\u8f93\u51fa &amp; \u7f16\u7801\u5668\u8f93\u5165\uff08\u786c\u4ef6\u63a5\u53e3\u5c42\uff09 <p>\u8fd9\u4e00\u5c42\u7684\u7279\u70b9\u662f\uff1a \ud83d\udc49 \u4e0d\u505a\u201c\u667a\u80fd\u51b3\u7b56\u201d \ud83d\udc49 \u53ea\u505a\u6700\u5e95\u5c42\u7684 I/O \u5c01\u88c5</p>","text":""},{"location":"notes/arduino/projet/code/#41","title":"4.1 \u7535\u673a\u505c\u6b62\u51fd\u6570\uff08\u4f60\u81ea\u5df1\u5199\u7684\uff09","text":"<pre><code>void stopMotor() { \n  analogWrite(PIN_EN, 0); \n}\n</code></pre> <ul> <li>\u2705 \u4f60\u81ea\u5df1\u5199\u7684\u51fd\u6570</li> <li><code>analogWrite()</code>\uff1aArduino \u81ea\u5e26 API</li> </ul>"},{"location":"notes/arduino/projet/code/#_8","title":"\u4f5c\u7528","text":"<ul> <li>\u8ba9 PWM = 0</li> <li>\u7535\u673a\u4e0d\u901a\u7535</li> <li>\u6ca1\u6709\u4fdd\u6301\u529b\uff08\u4e0d\u662f\u5239\u8f66\uff09</li> </ul> <p>\ud83d\udccc \u5728\u4f60\u7684\u7cfb\u7edf\u91cc\uff1a</p> <ul> <li>STOP \u6a21\u5f0f</li> <li>NUDGE_OFF \u9636\u6bb5</li> <li>\u8fd0\u52a8\u5b8c\u6210\u540e   \u90fd\u4f1a\u8c03\u7528\u5b83</li> </ul>"},{"location":"notes/arduino/projet/code/#42","title":"4.2 \u7535\u673a\u9a71\u52a8\u51fd\u6570\uff08\u4f60\u81ea\u5df1\u5199\u7684\u5173\u952e\u5c01\u88c5\uff09","text":"<pre><code>void setMotor(bool dirHigh, int pwm) {\n</code></pre> <ul> <li>\u2705 \u4f60\u81ea\u5df1\u5199\u7684\u51fd\u6570</li> <li> <p>\u8f93\u5165\u4e24\u4e2a\u91cf\uff1a</p> </li> <li> <p><code>dirHigh</code>\uff1a\u903b\u8f91\u65b9\u5411\uff08\u6b63 / \u53cd\uff09</p> </li> <li><code>pwm</code>\uff1a\u901f\u5ea6\u5927\u5c0f\uff080~255\uff09</li> </ul>"},{"location":"notes/arduino/projet/code/#_9","title":"\u65b9\u5411\u53cd\u8f6c\u5904\u7406\uff08\u975e\u5e38\u91cd\u8981\uff09","text":"<pre><code>  if (INVERT_MOTOR_DIR) dirHigh = !dirHigh;\n</code></pre> <ul> <li><code>INVERT_MOTOR_DIR</code>\uff1a\u4f60\u81ea\u5df1\u5b9a\u4e49\u7684\u8c03\u8bd5\u53c2\u6570</li> <li> <p>\u89e3\u51b3\u95ee\u9898\uff1a</p> </li> <li> <p>\u201c\u4ee3\u7801\u91cc\u7b97\u7684\u662f\u6b63\u65b9\u5411\uff0c\u4f46\u7535\u673a\u5b9e\u9645\u53cd\u7740\u8f6c\u201d</p> </li> </ul> <p>\ud83d\udccc \u8fd9\u662f\u5de5\u7a0b\u4e2d\u6781\u5e38\u89c1\u505a\u6cd5\uff0c\u800c\u4e14\u975e\u5e38\u4e13\u4e1a\u3002</p>"},{"location":"notes/arduino/projet/code/#_10","title":"\u8f93\u51fa\u65b9\u5411\u4fe1\u53f7","text":"<pre><code>  digitalWrite(PIN_DIR, dirHigh ? HIGH : LOW);\n</code></pre> <ul> <li><code>digitalWrite()</code>\uff1aArduino \u81ea\u5e26</li> <li>\u63a7\u5236\u7535\u673a\u9a71\u52a8\u5668 DIR \u5f15\u811a</li> </ul>"},{"location":"notes/arduino/projet/code/#pwm","title":"\u8f93\u51fa PWM","text":"<pre><code>  analogWrite(PIN_EN, pwm);\n</code></pre> <ul> <li><code>analogWrite()</code>\uff1aArduino \u81ea\u5e26</li> <li> <p>\u672c\u8d28\uff1a</p> </li> <li> <p>\u63a7\u5236\u7535\u673a\u8f6c\u901f</p> </li> <li>\u4e0d\u662f\u63a7\u5236\u89d2\u5ea6</li> <li>\u4e0d\u662f\u63a7\u5236\u65f6\u95f4</li> </ul> <p>\ud83d\udccc \u975e\u5e38\u91cd\u8981\u4e00\u53e5\u8bdd\uff08\u4f60\u62a5\u544a\u91cc\u53ef\u4ee5\u5199\uff09\uff1a</p> <p>\u672c\u7cfb\u7edf\u4e2d\u7535\u673a\u4e3a\u901f\u5ea6\u63a7\u5236\u5bf9\u8c61\uff0c\u89d2\u5ea6\u63a7\u5236\u901a\u8fc7\u7f16\u7801\u5668\u53cd\u9988\u5728\u4e0a\u5c42\u8f6f\u4ef6\u4e2d\u5b9e\u73b0\u3002</p>"},{"location":"notes/arduino/projet/code/#43","title":"4.3 \u7f16\u7801\u5668\u5bf9\u8c61\uff08\u5e93\u63d0\u4f9b\uff09","text":"<pre><code>Encoder enc(PIN_ENC_A, PIN_ENC_B);\n</code></pre> <ul> <li>\u26d4 \u4e0d\u662f\u4f60\u5199\u7684</li> <li>\u2705 <code>Encoder</code> \u7c7b\u6765\u81ea <code>&lt;Encoder.h&gt;</code> \u5e93</li> </ul> <p>\u4f5c\u7528\uff1a</p> <ul> <li>\u81ea\u52a8\u5904\u7406\u4e2d\u65ad / \u8f6e\u8be2</li> <li>\u81ea\u52a8\u5224\u65ad A/B \u76f8\u65b9\u5411</li> <li>\u7ed9\u4f60\u4e00\u4e2a\u201c\u7d2f\u8ba1\u8ba1\u6570\u503c\u201d</li> </ul>"},{"location":"notes/arduino/projet/code/#44-count","title":"4.4 \u8bfb\u53d6\u7f16\u7801\u5668 count\uff08\u4f60\u81ea\u5df1\u5199\u7684\u5c01\u88c5\uff09","text":"<pre><code>long readCountDrive() {\n  long c = enc.read();\n</code></pre> <ul> <li><code>enc.read()</code>\uff1aEncoder \u5e93\u81ea\u5e26</li> <li>\u8fd4\u56de\u4e00\u4e2a long \u7c7b\u578b\u7d2f\u8ba1\u8ba1\u6570</li> <li>\u53ef\u80fd\u662f\u6b63\uff0c\u4e5f\u53ef\u80fd\u662f\u8d1f</li> </ul>"},{"location":"notes/arduino/projet/code/#_11","title":"\u7f16\u7801\u5668\u65b9\u5411\u53cd\u8f6c","text":"<pre><code>  if (INVERT_ENCODER) c = -c;\n  return c;\n}\n</code></pre> <ul> <li><code>INVERT_ENCODER</code>\uff1a\u4f60\u81ea\u5df1\u5b9a\u4e49</li> <li> <p>\u7528\u6765\u4fee\u6b63\uff1a</p> </li> <li> <p>A/B \u76f8\u63a5\u53cd</p> </li> <li>\u6216\u5b89\u88c5\u65b9\u5411\u53cd\u4e86</li> </ul> <p>\ud83d\udccc \u975e\u5e38\u91cd\u8981\uff1a</p> <p>\u7f16\u7801\u5668\u53ea\u8d1f\u8d23\u201c\u6570\u6570\u201d\uff0c\u65b9\u5411\u7684\u7269\u7406\u542b\u4e49\u662f\u8f6f\u4ef6\u8d4b\u4e88\u7684</p>"},{"location":"notes/arduino/projet/code/#45","title":"4.5 \u5c0f\u7ed3\uff1a\u8fd9\u4e00\u5c42\u201c\u53ea\u5e72\u4e09\u4ef6\u4e8b\u201d","text":"<p>\u4f60\u53ef\u4ee5\u5728\u62a5\u544a\u91cc\u603b\u7ed3\u4e3a\uff1a</p> <ol> <li> <p>stopMotor()</p> </li> <li> <p>\u5173\u95ed PWM</p> </li> <li> <p>\u7535\u673a\u65ad\u7535</p> </li> <li> <p>setMotor(dir, pwm)</p> </li> <li> <p>\u8f93\u51fa\u65b9\u5411</p> </li> <li> <p>\u8f93\u51fa\u901f\u5ea6\uff08PWM\uff09</p> </li> <li> <p>readCountDrive()</p> </li> <li> <p>\u4ece\u7f16\u7801\u5668\u8bfb\u53d6\u7d2f\u8ba1 count</p> </li> <li>\u7edf\u4e00\u65b9\u5411\u7b26\u53f7</li> </ol> <p>\u26a0\ufe0f \u8fd9\u4e00\u5c42 \u4e0d\u5173\u5fc3\uff1a</p> <ul> <li>\u6e29\u5ea6</li> <li>\u89d2\u5ea6</li> <li>r / l / r5</li> <li>\u7a33\u4e0d\u7a33\u5b9a</li> </ul> <p>\ud83d\udc49 \u6240\u6709\u201c\u806a\u660e\u7684\u4e1c\u897f\u201d\u90fd\u5728\u4e0b\u4e00\u5c42\uff1a\u8fd0\u52a8\u63a7\u5236\u72b6\u6001\u673a</p>"},{"location":"notes/arduino/projet/code/#46","title":"4.6 \u4f60\u4e4b\u524d\u6240\u6709\u95ee\u9898\uff0c\u5176\u5b9e\u90fd\u6765\u81ea\u8fd9\u91cc + \u4e0a\u4e00\u5c42","text":"<p>\u4f60\u4e4b\u524d\u9047\u5230\u7684\uff1a</p> <ul> <li>\u201cr \u4e00\u4e0b\u8f6c\u5f88\u591a\u5708\u201d</li> <li>\u201ccount \u6709\u65f6\u6b63\u6709\u65f6\u8d1f\u201d</li> <li>\u201c\u4e0d\u52a0\u624b\u963b\u5c3c\u5c31\u6296\u201d</li> <li>\u201c\u65b9\u5411\u53cd\u4e86\u201d</li> </ul> <p>\u672c\u8d28\u539f\u56e0\u603b\u7ed3\u4e00\u53e5\u8bdd\uff1a</p> <p>\u7535\u673a\u662f\u901f\u5ea6\u6267\u884c\u5668\uff0c\u800c\u4f60\u4e00\u5f00\u59cb\u8bd5\u56fe\u628a\u5b83\u5f53\u6210\u89d2\u5ea6\u6267\u884c\u5668\u6765\u7528</p> <p>\u73b0\u5728\u4f60\u8fd9\u5957\u7ed3\u6784\u5df2\u7ecf\u5b8c\u5168\u6b63\u786e\uff1a</p> <ul> <li>\u5e95\u5c42\uff1a\u901f\u5ea6 + count</li> <li>\u4e0a\u5c42\uff1a\u76ee\u6807 count + \u72b6\u6001\u673a</li> <li>\u6700\u4e0a\u5c42\uff1a\u6e29\u5ea6 \u2192 \u89d2\u5ea6 \u2192 count</li> </ul>"},{"location":"notes/arduino/projet/code/#5-count","title":"\u7b2c 5 \u5927\u6bb5\uff1a\u8fd0\u52a8\u63a7\u5236\u72b6\u6001\u673a\uff08\u6309 count \u7cbe\u786e\u5230\u4f4d\uff09  <p>\u6838\u5fc3\u76ee\u6807\uff1a\u8ba9\u7f16\u7801\u5668 count \u4ece\u5f53\u524d\u503c\u8d70\u5230 <code>targetCountDrive</code>\uff0c\u5e76\u4e14\u5c3d\u91cf\u505a\u5230 <code>err=0</code>\uff08\u6216\u5f88\u5c0f\uff09\u3002</p>","text":""},{"location":"notes/arduino/projet/code/#51","title":"5.1 \u533a\u57df\u5212\u5206\u53c2\u6570\uff08\u4f60\u81ea\u5df1\u5b9a\u4e49\u7684\u63a7\u5236\u7b56\u7565\u53c2\u6570\uff09","text":"<pre><code>const long FAR_ZONE = 8;\nconst long NEAR_ZONE = 3;\nconst long FINE_ZONE = 2;\n</code></pre> <ul> <li>\u2705 \u5168\u662f\u4f60\u81ea\u5df1\u5b9a\u4e49\u7684\u63a7\u5236\u53c2\u6570\uff08\u4e0d\u662f\u5e93\u81ea\u5e26\uff09</li> <li> <p>\u5b83\u4eec\u7528\u4e8e\u628a\u8bef\u5dee <code>err = target - count</code> \u5206\u6210\u4e0d\u540c\u201c\u5de5\u4f5c\u533a\u95f4\u201d\uff1a</p> </li> <li> <p>\u8bef\u5dee\u5927\uff1a\u5feb\u901f\u7c97\u8c03\uff08COARSE_FAST\uff09</p> </li> <li>\u8bef\u5dee\u4e2d\u7b49\uff1a\u6162\u901f\u7c97\u8c03\uff08COARSE_SLOW\uff09</li> <li>\u8bef\u5dee\u5f88\u5c0f\uff1a\u8fdb\u5165\u5fae\u8c03\uff08NUDGE\uff09</li> </ul> <p>\u4f60\u73b0\u5728\u5b9e\u9645\u4f7f\u7528\u7684\u4e3b\u8981\u662f\uff1a</p> <ul> <li><code>FAR_ZONE</code>\uff1a\u51b3\u5b9a fast/slow</li> <li><code>FINE_ZONE</code>\uff1a\u51b3\u5b9a\u4f55\u65f6\u8fdb\u5165 nudge</li> </ul> <p><code>NEAR_ZONE</code> \u5728\u4f60\u8fd9\u7248\u903b\u8f91\u91cc\u5176\u5b9e\u6ca1\u771f\u6b63\u7528\u5230\uff08\u4f60\u53ea\u7528 FAR_ZONE/FINE_ZONE\uff09\uff0c\u5b83\u4fdd\u7559\u4e5f\u6ca1\u95ee\u9898\u3002</p>"},{"location":"notes/arduino/projet/code/#52","title":"5.2 \u201c\u5230\u4f4d\u5224\u5b9a\u201d\u53c2\u6570\uff08\u4f60\u81ea\u5df1\u5b9a\u4e49\uff0c\u51b3\u5b9a\u7cbe\u5ea6/\u65f6\u95f4\uff09","text":"<pre><code>const long TOL_DONE = 0;\nconst unsigned long STABLE_MS_ZERO = 500;\nconst unsigned long STABLE_MS_ONE  = 800;\nconst bool ALLOW_FALLBACK_PLUSMINUS1 = true;\n</code></pre> <ul> <li>\u2705 \u90fd\u662f\u4f60\u81ea\u5df1\u5b9a\u4e49</li> </ul> <p>\u610f\u4e49\uff1a</p> <ul> <li><code>TOL_DONE = 0</code>\uff1a\u4f60\u8981\u6c42\u201c\u5c3d\u91cf\u591a\u6570 0 \u8bef\u5dee\u201d\uff0c\u6240\u4ee5\u628a\u5b8c\u6210\u76ee\u6807\u8bbe\u4e3a err \u5fc5\u987b=0</li> <li> <p><code>STABLE_MS_ZERO = 500</code>\uff1a<code>err==0</code> \u5fc5\u987b\u6301\u7eed 500ms \u624d\u7b97\u201c\u771f\u7684\u5230\u4f4d\u201d</p> </li> <li> <p>\u9632\u6b62\u521a\u597d\u626b\u5230 0 \u53c8\u5f39\u56de\u53bb</p> </li> <li> <p><code>STABLE_MS_ONE = 800</code> + <code>ALLOW_FALLBACK_PLUSMINUS1=true</code></p> </li> <li> <p>\u5982\u679c\u4e00\u76f4\u5f88\u96be\u505a\u5230 0\uff0c\u5c31\u5141\u8bb8 err=\u00b11 \u7a33\u5b9a 800ms \u5f53\u6210\u5b8c\u6210\uff08\u515c\u5e95\uff09</p> </li> <li>\u8fd9\u8ba9\u7cfb\u7edf\u4e0d\u4f1a\u65e0\u9650\u6296\u52a8\u5728 0 \u9644\u8fd1</li> </ul>"},{"location":"notes/arduino/projet/code/#53","title":"5.3 \u7c97\u8c03\u63a7\u5236\u53c2\u6570\uff08\u4f60\u81ea\u5df1\u5b9a\u4e49\uff0c\u51b3\u5b9a\u201c\u62c9\u8fd1\u901f\u5ea6\u201d\uff09","text":"<pre><code>const float KP_COARSE = 7.0f;\nconst int PWM_COARSE_MIN_FAST = 60;\nconst int PWM_COARSE_MAX_FAST = 130;\n\nconst int PWM_COARSE_MIN_SLOW = 55;\nconst int PWM_COARSE_MAX_SLOW = 100;\n</code></pre> <ul> <li>\u2705 \u90fd\u662f\u4f60\u81ea\u5df1\u5b9a\u4e49</li> </ul> <p>\u89e3\u91ca\uff1a</p> <ul> <li> <p><code>KP_COARSE</code>\uff1a\u7c97\u8c03\u9636\u6bb5\u7684 P \u63a7\u5236\u589e\u76ca</p> </li> <li> <p>\u8f93\u51fa\uff1a<code>u = KP_COARSE * err</code></p> </li> <li><code>err</code> \u4ee5 count \u4e3a\u5355\u4f4d\uff0c\u6240\u4ee5 u \u4e5f\u662f\u201c\u4e0e count \u8bef\u5dee\u6210\u6bd4\u4f8b\u201d\u7684\u63a7\u5236\u91cf</li> <li><code>PWM_COARSE_MIN_*</code>\uff1a\u6700\u5c0f PWM\uff08\u514b\u670d\u9759\u6469\u64e6\uff0c\u201c\u4e00\u5b9a\u8981\u52a8\u8d77\u6765\u201d\uff09</li> <li><code>PWM_COARSE_MAX_*</code>\uff1a\u6700\u5927 PWM\uff08\u907f\u514d\u8fc7\u51b2\u3001\u907f\u514d\u592a\u731b\uff09</li> </ul> <p>FAST vs SLOW</p> <ul> <li>FAST\uff1a\u8bef\u5dee\u5f88\u5927\uff0c\u7528\u66f4\u5f3a\u7684\u8f93\u51fa\uff0c\u5feb\u901f\u63a5\u8fd1</li> <li>SLOW\uff1a\u8bef\u5dee\u8f83\u5c0f\uff0c\u7528\u66f4\u6e29\u67d4\u7684\u8f93\u51fa\uff0c\u964d\u4f4e\u8fc7\u51b2\uff0c\u51c6\u5907\u8fdb\u5165 nudge</li> </ul>"},{"location":"notes/arduino/projet/code/#54-nudge-0","title":"5.4 \u5fae\u8c03 nudge \u53c2\u6570\uff08\u4f60\u81ea\u5df1\u5b9a\u4e49\uff0c\u51b3\u5b9a\u201c\u6700\u540e\u80fd\u4e0d\u80fd\u843d\u5728 0\u201d\uff09","text":"<pre><code>const int PWM_NUDGE = 55;\nconst unsigned long NUDGE_OFF_MS = 160;\nconst unsigned long NUDGE_ON_MS_COARSE = 35;\nconst unsigned long NUDGE_ON_MS_FINE   = 15;\n</code></pre> <ul> <li>\u2705 \u90fd\u662f\u4f60\u81ea\u5df1\u5b9a\u4e49</li> </ul> <p>\u4f5c\u7528\u975e\u5e38\u91cd\u8981\uff1a</p> <ul> <li><code>PWM_NUDGE</code>\uff1a\u5fae\u8c03\u8109\u51b2\u7684\u529b\u5ea6\uff08\u4e00\u822c\u63a5\u8fd1\u201c\u80fd\u52a8\u95e8\u69db\u201d\uff09</li> <li> <p><code>NUDGE_ON_MS_*</code>\uff1a\u8109\u51b2\u6301\u7eed\u65f6\u95f4</p> </li> <li> <p>err=2 \u65f6\u7528\u957f\u4e00\u70b9\uff08\u63a8\u8fdb\u66f4\u591a\uff09</p> </li> <li>err=1 \u65f6\u7528\u77ed\u4e00\u70b9\uff08\u53ea\u63a8\u4e00\u70b9\u70b9\uff0c\u5c3d\u91cf\u843d\u5230 0\uff09</li> <li> <p><code>NUDGE_OFF_MS</code>\uff1a\u8109\u51b2\u4e4b\u95f4\u7684\u7b49\u5f85\u65f6\u95f4</p> </li> <li> <p>\u8fd9\u5c31\u662f\u4f60\u4e4b\u524d\u53d1\u73b0\u201c\u52a0\u624b\u6307\u6469\u64e6\u5c31\u66f4\u51c6\u201d\u7684\u539f\u56e0\u4e4b\u4e00</p> </li> <li>OFF \u7b49\u5f85\u76f8\u5f53\u4e8e\u8ba9\u7cfb\u7edf\u81ea\u7136\u963b\u5c3c\u3001\u9f7f\u9699\u56de\u5f39\u7ed3\u675f\u518d\u6d4b\u4e00\u6b21 count</li> </ul>"},{"location":"notes/arduino/projet/code/#55","title":"5.5 \u63a7\u5236\u8c03\u5ea6\u53c2\u6570\uff08\u4f60\u81ea\u5df1\u5b9a\u4e49\uff09","text":"<pre><code>const unsigned long CTRL_MS  = 10;\nconst unsigned long PRINT_MS = 200;\nconst unsigned long TIMEOUT_MS = 7000;\n</code></pre> <ul> <li> <p>\u2705 \u81ea\u5df1\u5b9a\u4e49</p> </li> <li> <p><code>CTRL_MS=10ms</code>\uff1a\u8fd0\u52a8\u63a7\u5236\u66f4\u65b0\u9891\u7387 100Hz</p> </li> <li> <p><code>PRINT_MS=200ms</code>\uff1a\u4e32\u53e3\u8f93\u51fa\u9891\u7387</p> </li> <li> <p><code>TIMEOUT_MS=7000ms</code>\uff1a7\u79d2\u5230\u4e0d\u4e86\u5c31\u5f3a\u5236\u505c\u6b62\uff08\u9632\u6b62\u7f16\u7801\u5668\u5931\u6548\u4e00\u76f4\u8f6c\uff09</p> </li> </ul>"},{"location":"notes/arduino/projet/code/#56","title":"5.6 \u72b6\u6001\u673a\u679a\u4e3e\uff08\u4f60\u81ea\u5df1\u5b9a\u4e49\uff09","text":"<pre><code>enum MotionState { M_IDLE, M_COARSE_FAST, M_COARSE_SLOW, M_NUDGE_OFF, M_NUDGE_ON };\nMotionState mstate = M_IDLE;\n</code></pre> <ul> <li>\u2705 \u81ea\u5df1\u5b9a\u4e49</li> </ul> <p>\u542b\u4e49\uff1a</p> <ul> <li><code>M_IDLE</code>\uff1a\u7a7a\u95f2\uff0c\u7535\u673a\u5fc5\u987b\u505c</li> <li><code>M_COARSE_FAST</code>\uff1a\u5feb\u6863\u7c97\u8c03</li> <li><code>M_COARSE_SLOW</code>\uff1a\u6162\u6863\u7c97\u8c03</li> <li><code>M_NUDGE_OFF</code>\uff1a\u5fae\u8c03\u7b49\u5f85\uff08\u7535\u673a\u5173\uff09</li> <li><code>M_NUDGE_ON</code>\uff1a\u5fae\u8c03\u8109\u51b2\uff08\u7535\u673a\u5f00\u4e00\u5c0f\u6bb5\u65f6\u95f4\uff09</li> </ul>"},{"location":"notes/arduino/projet/code/#57","title":"5.7 \u76ee\u6807\u4e0e\u8ba1\u65f6\u53d8\u91cf\uff08\u4f60\u81ea\u5df1\u5b9a\u4e49\uff09","text":"<pre><code>long targetCountDrive = 0;\nunsigned long moveStartMs = 0;\n\nunsigned long phaseT0 = 0;\nunsigned long stableZeroT0 = 0;\nunsigned long stableOneT0  = 0;\n</code></pre> <ul> <li>\u2705 \u81ea\u5df1\u5b9a\u4e49</li> </ul> <p>\u89e3\u91ca\uff1a</p> <ul> <li><code>targetCountDrive</code>\uff1a\u76ee\u6807 count\uff08\u4f60\u5e0c\u671b count \u53d8\u6210\u591a\u5c11\uff09</li> <li><code>moveStartMs</code>\uff1a\u5f00\u59cb\u79fb\u52a8\u7684\u65f6\u95f4\uff0c\u7528\u4e8e timeout</li> <li><code>phaseT0</code>\uff1anudge on/off \u9636\u6bb5\u8d77\u59cb\u65f6\u95f4</li> <li><code>stableZeroT0</code>\uff1a\u7b2c\u4e00\u6b21\u8fdb\u5165 err==0 \u7684\u65f6\u95f4\uff08\u7528\u6765\u7b97\u6301\u7eed 500ms\uff09</li> <li><code>stableOneT0</code>\uff1a\u7b2c\u4e00\u6b21\u8fdb\u5165 |err|==1 \u7684\u65f6\u95f4\uff08\u7528\u6765\u7b97\u6301\u7eed 800ms\uff09</li> </ul>"},{"location":"notes/arduino/projet/code/#58-motionstartto","title":"5.8 \u542f\u52a8\u8fd0\u52a8\uff1a<code>motionStartTo()</code>","text":"<pre><code>void motionStartTo(long newTargetCount) {\n  targetCountDrive = newTargetCount;\n  moveStartMs = millis();\n  stableZeroT0 = 0;\n  stableOneT0  = 0;\n  mstate = M_COARSE_FAST;\n}\n</code></pre> <ul> <li>\u2705 \u4f60\u81ea\u5df1\u5199\u7684\u51fd\u6570</li> <li><code>millis()</code>\uff1aArduino \u81ea\u5e26\uff08\u8fd4\u56de\u7cfb\u7edf\u8fd0\u884c\u6beb\u79d2\u6570\uff09</li> </ul> <p>\u9010\u884c\u89e3\u91ca\uff1a</p> <ol> <li> <p><code>targetCountDrive = newTargetCount;</code>    \u8bbe\u7f6e\u76ee\u6807</p> </li> <li> <p><code>moveStartMs = millis();</code>    \u8bb0\u5f55\u5f00\u59cb\u65f6\u95f4</p> </li> <li> <p><code>stableZeroT0 = 0; stableOneT0 = 0;</code>    \u6e05\u7a7a\u7a33\u5b9a\u8ba1\u65f6\u5668\uff08\u56e0\u4e3a\u8fd9\u662f\u4e00\u6b21\u65b0\u7684\u8fd0\u52a8\uff09</p> </li> <li> <p><code>mstate = M_COARSE_FAST;</code>    \u65b0\u8fd0\u52a8\u9ed8\u8ba4\u4ece\u201c\u5feb\u6863\u7c97\u8c03\u201d\u5f00\u59cb</p> </li> </ol>"},{"location":"notes/arduino/projet/code/#59-motionmoveby","title":"5.9 \u76f8\u5bf9\u79fb\u52a8\uff1a<code>motionMoveBy()</code>","text":"<pre><code>void motionMoveBy(long delta) {\n  long c = readCountDrive();\n  motionStartTo(c + delta);\n}\n</code></pre> <ul> <li>\u2705 \u4f60\u81ea\u5df1\u5199\u7684\u51fd\u6570</li> <li><code>readCountDrive()</code> \u662f\u4f60\u5c01\u88c5\u7684\u7f16\u7801\u5668\u8bfb\u53d6</li> </ul> <p>\u89e3\u91ca\uff1a</p> <ul> <li>\u8bfb\u53d6\u5f53\u524d count = c</li> <li>\u76ee\u6807\u53d8\u6210 c + delta</li> <li>\u7136\u540e\u7528 <code>motionStartTo()</code> \u542f\u52a8\u72b6\u6001\u673a</li> </ul> <p>\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\uff1a</p> <ul> <li><code>r</code> \u5bf9\u5e94 <code>+12</code></li> <li><code>l</code> \u5bf9\u5e94 <code>-12</code></li> </ul> <p>\u800c\u4e14\u6bcf\u6b21\u90fd\u662f\u201c\u76f8\u5bf9\u79fb\u52a8\u201d</p>"},{"location":"notes/arduino/projet/code/#510-motionupdate-1","title":"5.10 <code>motionUpdate()</code> \u7b2c 1 \u6bb5\uff1a\u8bfb\u6570 + \u8bef\u5dee","text":"<pre><code>void motionUpdate() {\n  unsigned long now = millis();\n\n  long c = readCountDrive();\n  long err = targetCountDrive - c;\n  long aerr = labs(err);\n</code></pre> <ul> <li><code>millis()</code>\uff1a\u2705 Arduino \u81ea\u5e26\uff0c\u5f53\u524d\u8fd0\u884c\u65f6\u95f4\uff08ms\uff09</li> <li><code>readCountDrive()</code>\uff1a\u2705 \u4f60\u81ea\u5df1\u5199\u7684\u5c01\u88c5\uff08\u5185\u90e8\u7528 <code>enc.read()</code>\uff09</li> <li><code>targetCountDrive</code>\uff1a\u2705 \u4f60\u81ea\u5df1\u7ef4\u62a4\u7684\u76ee\u6807 count</li> <li><code>err = target - current</code>\uff1a\u2705 \u63a7\u5236\u8bef\u5dee\uff08count\u5355\u4f4d\uff09</li> <li><code>labs(err)</code>\uff1a\u2705 C \u6807\u51c6\u5e93\u51fd\u6570\uff08long absolute\uff09\uff0c\u5f97\u5230\u8bef\u5dee\u7edd\u5bf9\u503c</li> </ul> <p>\u5230\u8fd9\u91cc\uff0c\u4f60\u5df2\u7ecf\u5f97\u5230\u4e86\u201c\u6211\u79bb\u76ee\u6807\u8fd8\u5dee\u591a\u5c11 count\u201d\u3002</p>"},{"location":"notes/arduino/projet/code/#511-2","title":"5.11 \u7b2c 2 \u6bb5\uff1a\u8d85\u65f6\u4fdd\u62a4\uff08\u9632\u6b62\u4e00\u76f4\u8f6c\uff09","text":"<pre><code>  if (mstate != M_IDLE &amp;&amp; now - moveStartMs &gt; TIMEOUT_MS) {\n    mstate = M_IDLE;\n    stopMotor();\n  }\n</code></pre> <ul> <li><code>TIMEOUT_MS</code>\uff1a\u2705 \u4f60\u5b9a\u4e49\u7684 7000ms</li> <li><code>moveStartMs</code>\uff1a\u2705 \u4f60\u5728 <code>motionStartTo()</code> \u91cc\u8bb0\u5f55\u7684\u5f00\u59cb\u65f6\u95f4</li> <li>\u903b\u8f91\uff1a   \u53ea\u8981\u5f53\u524d\u4e0d\u662f\u7a7a\u95f2\u72b6\u6001\uff0c\u5e76\u4e14\u8fd0\u52a8\u65f6\u95f4\u8d85\u8fc7 7 \u79d2 \u2192 \u76f4\u63a5\u505c\u673a</li> </ul> <p>\u4e3a\u4ec0\u4e48\u5fc5\u987b\u8981\u6709\uff1f</p> <ul> <li>\u7f16\u7801\u5668\u65ad\u7ebf/\u677e\u52a8</li> <li>\u7535\u673a\u5361\u4f4f</li> <li>\u9f7f\u8f6e\u6253\u6ed1   \u8fd9\u4e9b\u60c5\u51b5\u5982\u679c\u6ca1\u6709 timeout\uff0c\u4f1a\u5bfc\u81f4\u7535\u673a\u4e00\u76f4\u8f93\u51fa PWM\uff0c\u98ce\u9669\u5f88\u5927\u3002</li> </ul>"},{"location":"notes/arduino/projet/code/#512-3-0","title":"5.12 \u7b2c 3 \u6bb5\uff1a\u7a33\u5b9a\u5230\u4f4d\u5224\u5b9a\uff08\u201c0\u8bef\u5dee\u8981\u6301\u7eed\u201d\uff09","text":"<p>\u8fd9\u4e00\u6bb5\u662f\u4f60\u7cfb\u7edf\u4e3a\u4ec0\u4e48\u201c\u770b\u8d77\u6765\u5f88\u7a33\u201d\u7684\u5173\u952e\u3002</p> <pre><code>  if (mstate != M_IDLE) {\n    if (err == 0) {\n      if (stableZeroT0 == 0) stableZeroT0 = now;\n    } else {\n      stableZeroT0 = 0;\n    }\n</code></pre> <p>\u9010\u884c\u89e3\u91ca\uff1a</p> <ul> <li>\u53ea\u6709\u5728\u201c\u8fd0\u52a8\u8fdb\u884c\u4e2d\u201d\uff08\u975e IDLE\uff09\u624d\u8ba1\u7b97\u7a33\u5b9a\u6027</li> <li> <p>\u5982\u679c <code>err==0</code>\uff1a</p> </li> <li> <p>\u7b2c\u4e00\u6b21\u8fbe\u5230 0 \u65f6\uff0c\u8bb0\u5f55\u65f6\u95f4 <code>stableZeroT0 = now</code></p> </li> <li>\u540e\u9762\u5982\u679c\u4e00\u76f4\u4fdd\u6301 0\uff0c\u5c31\u4e0d\u518d\u6539\u8fd9\u4e2a\u65f6\u95f4</li> <li> <p>\u5982\u679c <code>err != 0</code>\uff1a</p> </li> <li> <p>\u6e05\u96f6 <code>stableZeroT0</code>\uff0c\u610f\u5473\u7740\u201c\u7a33\u5b9a\u8ba1\u65f6\u4e2d\u65ad\uff0c\u5f97\u91cd\u65b0\u6765\u201d</p> </li> </ul> <p>\u63a5\u7740\u662f |err|==1 \u7684\u515c\u5e95\u8ba1\u65f6\uff1a</p> <pre><code>    if (labs(err) == 1) {\n      if (stableOneT0 == 0) stableOneT0 = now;\n    } else {\n      stableOneT0 = 0;\n    }\n</code></pre> <ul> <li>\u903b\u8f91\u5b8c\u5168\u540c\u4e0a\uff0c\u53ea\u662f\u6761\u4ef6\u4ece <code>err==0</code> \u6362\u6210 <code>|err|==1</code></li> <li>\u8fd9\u662f\u4e3a\u4e86\u907f\u514d\u201c\u6c38\u8fdc\u5728 0 \u9644\u8fd1\u9707\u8361\u4f46\u5c31\u662f\u78b0\u4e0d\u5230 0\u201d\u5bfc\u81f4\u4e00\u76f4\u4e0d\u7ed3\u675f</li> </ul> <p>\u7136\u540e\u662f\u771f\u6b63\u7684\u201c\u5b8c\u6210\u5224\u5b9a\u201d\uff1a</p> <pre><code>    if (TOL_DONE == 0) {\n      if (stableZeroT0 != 0 &amp;&amp; now - stableZeroT0 &gt;= STABLE_MS_ZERO) {\n        mstate = M_IDLE; stopMotor();\n      } else if (ALLOW_FALLBACK_PLUSMINUS1 &amp;&amp; stableOneT0 != 0 &amp;&amp; now - stableOneT0 &gt;= STABLE_MS_ONE) {\n        mstate = M_IDLE; stopMotor();\n      }\n    }\n  }\n</code></pre> <ul> <li><code>TOL_DONE==0</code>\uff1a\u8868\u793a\u4f60\u60f3\u201c\u76ee\u6807\u591a\u6570\u4e3a 0\u201d</li> <li>\u7b2c\u4e00\u4f18\u5148\u7ea7\uff1a   <code>err==0</code> \u8fde\u7eed\u4fdd\u6301 <code>STABLE_MS_ZERO=500ms</code> \u2192 \u5b8c\u6210</li> <li>\u7b2c\u4e8c\u4f18\u5148\u7ea7\uff08\u515c\u5e95\uff09\uff1a   \u5982\u679c\u5141\u8bb8 <code>\u00b11</code>\uff0c\u5e76\u4e14 <code>|err|==1</code> \u8fde\u7eed <code>800ms</code> \u2192 \u5b8c\u6210</li> </ul> <p>\u4e3a\u4ec0\u4e48\u8981\u201c\u6301\u7eed\u65f6\u95f4\u201d\u800c\u4e0d\u662f\u201c\u4e00\u77ac\u95f4\u5230 0 \u5c31\u7ed3\u675f\u201d\uff1f</p> <ul> <li>\u673a\u68b0\u6709\u60ef\u6027/\u9f7f\u9699/\u56de\u5f39</li> <li>\u4e00\u77ac\u95f4\u8bfb\u5230 0 \u53ef\u80fd\u53ea\u662f\u201c\u8def\u8fc7\u201d\uff0c\u9a6c\u4e0a\u53c8\u53d8\u6210 \u00b11   \u6301\u7eed\u65f6\u95f4\u80fd\u663e\u8457\u51cf\u5c11\u6296\u52a8\u3002</li> </ul>"},{"location":"notes/arduino/projet/code/#513-4","title":"5.13 \u7b2c 4 \u6bb5\uff1a\u72b6\u6001\u673a\u8f93\u51fa\uff08\u771f\u6b63\u63a7\u5236\u7535\u673a\uff09","text":"<p>\u5148\u770b\u5165\u53e3\uff1a</p> <pre><code>  if (mstate == M_IDLE) {\n    stopMotor();\n    return;\n  }\n</code></pre> <ul> <li>\u5982\u679c\u7a7a\u95f2\uff1a\u7535\u673a\u5fc5\u987b\u505c</li> <li>\u76f4\u63a5 return\uff0c\u4e0d\u8fdb\u5165\u4efb\u4f55\u8f93\u51fa\u903b\u8f91   \u8fd9\u4fdd\u8bc1\u4e86\u201c\u7a7a\u95f2\u72b6\u6001\u7edd\u5bf9\u4e0d\u4f1a\u53d1\u529b\u201d\u3002</li> </ul>"},{"location":"notes/arduino/projet/code/#5131-coarse","title":"5.13.1 \u7c97\u8c03\uff08COARSE\uff09\u5206\u652f","text":"<pre><code>  if (mstate == M_COARSE_FAST || mstate == M_COARSE_SLOW) {\n</code></pre> <p>\u8bf4\u660e\u5f53\u524d\u5904\u4e8e\u7c97\u8c03\uff1a\u8f93\u51fa\u8fde\u7eed PWM\uff0c\u8ba9\u5b83\u5feb\u901f\u63a5\u8fd1\u76ee\u6807\u3002</p>"},{"location":"notes/arduino/projet/code/#1-nudge","title":"(1) \u5224\u65ad\u662f\u5426\u8981\u5207\u5230 nudge","text":"<pre><code>    if (aerr &lt;= FINE_ZONE) {\n      mstate = M_NUDGE_OFF;\n      phaseT0 = now;\n      stopMotor();\n    }\n</code></pre> <ul> <li>\u5f53 |err| \u2264 2\uff08\u4f60\u7684 FINE_ZONE=2\uff09</li> <li>\u5207\u5230 <code>M_NUDGE_OFF</code>\uff08\u5148\u65ad\u7535\u7b49\u5f85\uff09</li> <li>\u8bb0\u5f55 <code>phaseT0</code>\uff0c\u7528\u4e8e nudge \u7684\u8ba1\u65f6</li> </ul> <p>\u4e3a\u4ec0\u4e48\u5148 OFF\uff1f</p> <ul> <li>\u8ba9\u7cfb\u7edf\u505c\u7a33\uff0c\u907f\u514d\u60ef\u6027\u5bfc\u81f4\u4e0b\u4e00\u6b21\u8109\u51b2\u5224\u65ad\u4e0d\u51c6</li> </ul>"},{"location":"notes/arduino/projet/code/#2-fast-slow","title":"(2) \u51b3\u5b9a FAST \u8fd8\u662f SLOW","text":"<pre><code>    else if (aerr &lt; FAR_ZONE) {\n      mstate = M_COARSE_SLOW;\n    } else {\n      mstate = M_COARSE_FAST;\n    }\n</code></pre> <ul> <li>|err| &lt; 8 \u2192 SLOW\uff08\u66f4\u6e29\u67d4\uff09</li> <li>|err| \u2265 8 \u2192 FAST\uff08\u66f4\u731b\uff09</li> </ul>"},{"location":"notes/arduino/projet/code/#3-coarse-pwm","title":"(3) \u5728 COARSE \u72b6\u6001\u4e0b\u8ba1\u7b97 PWM \u8f93\u51fa","text":"<pre><code>    if (mstate == M_COARSE_FAST || mstate == M_COARSE_SLOW) {\n      float u = KP_COARSE * (float)err;\n      bool dirHigh = (u &gt;= 0);\n      int pwm = (int)fabs(u);\n</code></pre> <ul> <li><code>u = Kp * err</code>\uff1a\u5178\u578b\u6bd4\u4f8b\u63a7\u5236</li> <li><code>dirHigh</code>\uff1a\u8bef\u5dee\u6b63 \u2192 \u5f80\u6b63\u65b9\u5411\u8f6c\uff1b\u8bef\u5dee\u8d1f \u2192 \u5f80\u53cd\u65b9\u5411\u8f6c</li> <li><code>pwm = |u|</code>\uff1a\u8f93\u51fa\u5f3a\u5ea6\u4e0e\u8bef\u5dee\u6210\u6b63\u6bd4</li> </ul> <p>\u6ce8\u610f\uff1a\u8fd9\u91cc\u662f P \u63a7\u5236\uff0c\u6ca1\u6709 I/D\u3002\u4f60\u7528 nudge \u89e3\u51b3\u9759\u6469\u64e6\u548c\u6700\u540e\u7684\u7cbe\u5ea6\u3002</p>"},{"location":"notes/arduino/projet/code/#4-pwm","title":"(4) PWM \u9650\u5e45\uff08\u201c\u80fd\u52a8\u201d+\u201c\u522b\u592a\u731b\u201d\uff09","text":"<p>FAST \u6863\uff1a</p> <pre><code>      if (mstate == M_COARSE_FAST) {\n        if (pwm &gt; PWM_COARSE_MAX_FAST) pwm = PWM_COARSE_MAX_FAST;\n        if (pwm &gt; 0 &amp;&amp; pwm &lt; PWM_COARSE_MIN_FAST) pwm = PWM_COARSE_MIN_FAST;\n      }\n</code></pre> <ul> <li>\u4e0a\u9650\uff1a\u4e0d\u8ba9\u5b83\u8fc7\u731b</li> <li>\u4e0b\u9650\uff1a\u4e0d\u8ba9\u5b83\u5361\u4f4f\u4e0d\u52a8\uff08\u5c24\u5176\u5feb\u6863\uff09</li> </ul> <p>SLOW \u6863\uff1a</p> <pre><code>      else {\n        if (pwm &gt; PWM_COARSE_MAX_SLOW) pwm = PWM_COARSE_MAX_SLOW;\n        if (pwm &gt; 0 &amp;&amp; pwm &lt; PWM_COARSE_MIN_SLOW) pwm = PWM_COARSE_MIN_SLOW;\n      }\n</code></pre> <ul> <li>\u540c\u7406\uff0c\u53ea\u662f max/min \u66f4\u4f4e</li> </ul> <p>\u6700\u540e\u771f\u6b63\u8f93\u51fa\uff1a</p> <pre><code>      setMotor(dirHigh, pwm);\n</code></pre>"},{"location":"notes/arduino/projet/code/#5132-offnudge_off","title":"5.13.2 \u5fae\u8c03 OFF\uff08NUDGE_OFF\uff09","text":"<pre><code>  else if (mstate == M_NUDGE_OFF) {\n    stopMotor();\n    if (now - phaseT0 &gt;= NUDGE_OFF_MS) {\n      mstate = M_NUDGE_ON;\n      phaseT0 = now;\n    }\n  }\n</code></pre> <ul> <li>OFF \u9636\u6bb5\uff1a\u7535\u673a\u65ad\u7535</li> <li>\u7b49\u5f85 <code>NUDGE_OFF_MS=160ms</code></li> <li>\u65f6\u95f4\u5230\u4e86\u8fdb\u5165 ON \u9636\u6bb5\uff0c\u5e76\u66f4\u65b0 phaseT0</li> </ul> <p>\u4e3a\u4ec0\u4e48 OFF \u8981\u8fd9\u4e48\u4e45\uff1f</p> <ul> <li>\u8ba9\u9f7f\u9699\u56de\u5f39\u7ed3\u675f</li> <li>\u8ba9\u7f16\u7801\u5668\u8bfb\u6570\u7a33\u5b9a</li> <li>\u8ba9\u60ef\u6027\u505c\u6b62   \u4f60\u4e4b\u524d\u201c\u52a0\u624b\u6469\u64e6\u66f4\u51c6\u201d\uff0c\u672c\u8d28\u5c31\u662f\u7ed9\u7cfb\u7edf\u52a0\u4e86\u963b\u5c3c\uff0c\u76f8\u5f53\u4e8e\u7f29\u77ed\u4e86\u201c\u505c\u7a33\u65f6\u95f4\u201d\u3002</li> </ul>"},{"location":"notes/arduino/projet/code/#5133-onnudge_on","title":"5.13.3 \u5fae\u8c03 ON\uff08NUDGE_ON\uff09","text":"<pre><code>  else if (mstate == M_NUDGE_ON) {\n    unsigned long onMs = (aerr &lt;= 1) ? NUDGE_ON_MS_FINE : NUDGE_ON_MS_COARSE;\n</code></pre> <ul> <li>\u5982\u679c |err|==1\uff1a\u7528\u66f4\u77ed\u7684\u8109\u51b2 15ms\uff08\u907f\u514d\u8fc7\u51b2\uff09</li> <li>\u5982\u679c |err|==2\uff1a\u7528\u7a0d\u957f\u7684\u8109\u51b2 35ms\uff08\u63a8\u52a8\u66f4\u660e\u663e\uff09</li> </ul> <p>\u65b9\u5411\u4e0e\u8f93\u51fa\uff1a</p> <pre><code>    bool dirHigh = (err &gt; 0);\n    setMotor(dirHigh, PWM_NUDGE);\n</code></pre> <ul> <li>err&gt;0 \u2192 \u5f80\u6b63\u65b9\u5411\u63a8\u4e00\u4e0b</li> <li>\u8f93\u51fa PWM_NUDGE\uff08\u63a5\u8fd1\u80fd\u52a8\u95e8\u69db\uff0c\u4e0d\u731b\uff09</li> </ul> <p>\u8109\u51b2\u7ed3\u675f\u5c31\u56de\u5230 OFF\uff1a</p> <pre><code>    if (now - phaseT0 &gt;= onMs) {\n      mstate = M_NUDGE_OFF;\n      phaseT0 = now;\n    }\n  }\n}\n</code></pre> <p>\u7ee7\u7eed \ud83d\udc4d \u63a5\u4e0b\u6765\u8bb2\u4f60\u4ee3\u7801\u7684\u540e\u534a\u6bb5\uff1a\u6a21\u5f0f\uff08STOP/GO\uff09\u3001\u4e32\u53e3\u547d\u4ee4\u3001sync \u6821\u51c6\u3001\u4ee5\u53ca loop() \u8c03\u5ea6\u7ed3\u6784\u3002\u6211\u8fd8\u662f\u6309\u4f60\u4ee3\u7801\u987a\u5e8f\u51e0\u884c\u51e0\u884c\u8bb2\uff0c\u5e76\u8bf4\u660e\u54ea\u4e9b\u662f\u4f60\u5b9a\u4e49\u7684\u3001\u54ea\u4e9b\u662f Arduino/\u5e93\u81ea\u5e26\u7684\u3002</p>"},{"location":"notes/arduino/projet/code/#6-stop-go","title":"\u7b2c 6 \u5927\u6bb5\uff1a\u6a21\u5f0f\u7cfb\u7edf\uff08STOP / GO\uff09\u4e0e\u4e32\u53e3\u547d\u4ee4","text":""},{"location":"notes/arduino/projet/code/#61","title":"6.1 \u6a21\u5f0f\u679a\u4e3e\uff08\u4f60\u81ea\u5df1\u5b9a\u4e49\uff09","text":"<pre><code>enum Mode { MODE_STOP, MODE_GO };\nMode mode = MODE_STOP;  // default power-on STOP\n</code></pre> <ul> <li>\u2705 <code>enum Mode</code> \u662f\u4f60\u81ea\u5df1\u5b9a\u4e49\u7684\u7c7b\u578b</li> <li><code>MODE_STOP / MODE_GO</code> \u662f\u4f60\u81ea\u5df1\u5b9a\u4e49\u7684\u4e24\u4e2a\u6a21\u5f0f</li> <li><code>mode = MODE_STOP</code>\uff1a\u4e0a\u7535\u9ed8\u8ba4 STOP\uff08\u7b26\u5408\u4f60\u6700\u521d\u9700\u6c42\uff1a\u9ed8\u8ba4\u505c\u673a\uff09</li> </ul> <p>\u6a21\u5f0f\u542b\u4e49\uff1a</p> <ul> <li>STOP\uff1a\u4e0d\u8ddf\u968f\u6e29\u5ea6\uff08\u7535\u673a\u9ed8\u8ba4\u505c\uff09\uff0c\u4f46\u4ecd\u5141\u8bb8\u624b\u52a8 r/l/r5/l5 \u505a\u6821\u51c6\u5fae\u8c03</li> <li>GO\uff1a\u81ea\u52a8\u8ddf\u968f\u6e29\u5ea6\uff08\u6e29\u5ea6\u53d8 \u2192 expectedDeg \u53d8 \u2192 \u76ee\u6807 count \u53d8 \u2192 \u7535\u673a\u52a8\u4f5c\uff09</li> </ul>"},{"location":"notes/arduino/projet/code/#62","title":"6.2 \u4e32\u53e3\u7f13\u5b58\uff08\u4f60\u81ea\u5df1\u5b9a\u4e49\uff09","text":"<pre><code>String cmdLine;\n</code></pre> <ul> <li>\u2705 \u4f60\u81ea\u5df1\u5b9a\u4e49\u7684\u53d8\u91cf</li> <li>\u7c7b\u578b <code>String</code> \u662f Arduino \u63d0\u4f9b\u7684\u5b57\u7b26\u4e32\u7c7b\uff08Arduino \u6838\u5fc3\u5e93\u81ea\u5e26\uff09</li> <li>\u7528\u9014\uff1a\u628a\u7528\u6237\u8f93\u5165\u7684\u4e00\u884c\u547d\u4ee4\uff08\u4f8b\u5982 <code>\"r5\"</code>\u3001<code>\"sync\"</code>\uff09\u7f13\u51b2\u8d77\u6765\uff0c\u76f4\u5230\u9047\u5230\u56de\u8f66</li> </ul>"},{"location":"notes/arduino/projet/code/#63-offset","title":"6.3 \u6821\u51c6\u504f\u79fb offset\uff08\u4f60\u81ea\u5df1\u5b9a\u4e49\uff0c\u89e3\u51b3\u201c\u65e0\u7edd\u5bf9\u96f6\u4f4d\u201d\uff09","text":"<pre><code>float calibOffsetDeg = 0.0f;\n</code></pre> <ul> <li>\u2705 \u4f60\u81ea\u5df1\u5b9a\u4e49\u7684\u53d8\u91cf</li> <li>\u7269\u7406\u610f\u4e49\uff1a\u6307\u9488\u8f74\u89d2\u5ea6\u7684\u201c\u96f6\u70b9\u504f\u79fb\u201d</li> <li>\u539f\u56e0\uff1a\u4f60\u7684\u7535\u673a/\u7f16\u7801\u5668\u6ca1\u6709\u7edd\u5bf9\u96f6\u70b9\uff0c\u4e0a\u7535 count=0 \u4e0d\u4ee3\u8868\u6307\u9488=0\u00b0</li> </ul> <p>\u4f60\u5b9a\u4e49\u4e86\u89d2\u5ea6\u6d4b\u91cf\u6a21\u578b\uff1a</p> <p>[ actualDeg = count \\cdot degPerCount + calibOffsetDeg ]</p> <p><code>sync</code> \u7684\u76ee\u7684\u5c31\u662f\u8c03\u6574 <code>calibOffsetDeg</code>\uff0c\u8ba9\u201c\u5f53\u524d\u6307\u9488\u4f4d\u7f6e=\u5f53\u524d\u6e29\u5ea6\u5e94\u6307\u5411\u7684\u4f4d\u7f6e\u201d\u3002</p>"},{"location":"notes/arduino/projet/code/#64-expected-actual","title":"6.4 expected / actual \u89d2\u5ea6\uff08\u4f60\u81ea\u5df1\u5b9a\u4e49\uff09","text":"<pre><code>float expectedDeg = 0.0f;\nfloat actualDeg   = 0.0f;\n</code></pre> <ul> <li>\u2705 \u4f60\u81ea\u5df1\u5b9a\u4e49\u7684\u53d8\u91cf</li> <li>expectedDeg\uff1a\u6e29\u5ea6\u6620\u5c04\u51fa\u6765\u7684\u201c\u5e94\u8be5\u6307\u5411\u7684\u89d2\u5ea6\u201d</li> <li>actualDeg\uff1a\u7f16\u7801\u5668\u6362\u7b97\u51fa\u6765\u7684\u201c\u5f53\u524d\u5b9e\u9645\u89d2\u5ea6\u201d</li> </ul>"},{"location":"notes/arduino/projet/code/#65-go-count","title":"6.5 GO \u6a21\u5f0f\u4e0b\u7684\u76ee\u6807 count\uff08\u4f60\u81ea\u5df1\u5b9a\u4e49\uff09","text":"<pre><code>long expectedCountDrive = 0;\n</code></pre> <ul> <li>\u2705 \u4f60\u81ea\u5df1\u5b9a\u4e49</li> <li>GO \u6a21\u5f0f\u4e0b\u6211\u4eec\u6700\u7ec8\u8981\u628a expectedDeg \u8f6c\u6362\u6210\u201c\u76ee\u6807 count\u201d\uff0c\u8ba9\u8fd0\u52a8\u63a7\u5236\u5668\u53bb\u8ffd\u5b83</li> </ul>"},{"location":"notes/arduino/projet/code/#66-expecteddeg-count","title":"6.6 expectedDeg \u2192 \u76ee\u6807 count \u7684\u6362\u7b97\u51fd\u6570\uff08\u4f60\u81ea\u5df1\u5199\uff09","text":"<pre><code>long expectedDegToTargetCount(float expDeg) {\n  float pure = wrap180(expDeg - calibOffsetDeg);\n  return lroundf(pure / degPerDriveCountOnShaft());\n}\n</code></pre>"},{"location":"notes/arduino/projet/code/#_12","title":"\u9010\u884c\u89e3\u91ca","text":"<ul> <li>\u2705 \u8fd9\u662f\u4f60\u81ea\u5df1\u5199\u7684\u51fd\u6570</li> <li><code>wrap180()</code>\uff1a\u4f60\u81ea\u5df1\u5199\u7684\u5de5\u5177\u51fd\u6570</li> <li><code>degPerDriveCountOnShaft()</code>\uff1a\u4f60\u81ea\u5df1\u5199\u7684\u6bd4\u4f8b\u5c3a\u51fd\u6570</li> <li><code>lroundf()</code>\uff1aC \u6807\u51c6\u6570\u5b66\u51fd\u6570\uff08Arduino \u652f\u6301\uff09</li> </ul> <p>\u6838\u5fc3\u63a8\u5bfc\u6765\u81ea\u6a21\u578b\uff1a</p> <p>[ actualDeg = count \\cdot degPerCount + offset ]</p> <p>\u60f3\u8ba9 <code>actualDeg = expDeg</code>\uff0c\u5219\uff1a</p> <p>[ count = \\frac{expDeg - offset}{degPerCount} ]</p> <p>\u5bf9\u5e94\u4ee3\u7801\u5c31\u662f\uff1a</p> <ul> <li><code>pure = expDeg - calibOffsetDeg</code></li> <li><code>count = pure / degPerCount</code></li> </ul> <p>\u8fd9\u4e00\u6b65\u5f88\u5173\u952e\uff1aoffset \u4e0d\u53c2\u4e0e\u6e29\u5ea6\u6620\u5c04\uff0c\u5b83\u53ea\u53c2\u4e0e\u201c\u89d2\u5ea6\u2194count\u201d\u7684\u6362\u7b97\u3002</p>"},{"location":"notes/arduino/projet/code/#67-handlecommand","title":"6.7 \u547d\u4ee4\u5904\u7406\u51fd\u6570 handleCommand\uff08\u4f60\u81ea\u5df1\u5199\uff09","text":"<pre><code>void handleCommand(String s) {\n  s.trim();\n  s.toLowerCase();\n</code></pre> <ul> <li><code>trim()</code> / <code>toLowerCase()</code>\uff1aArduino String \u81ea\u5e26\u65b9\u6cd5\uff08\u4e0d\u662f\u4f60\u5199\u7684\uff09</li> <li> <p>\u76ee\u7684\uff1a</p> </li> <li> <p>\u53bb\u6389\u7a7a\u683c/\u56de\u8f66\u6b8b\u7559</p> </li> <li>\u7edf\u4e00\u5927\u5c0f\u5199\uff0c\u907f\u514d\u7528\u6237\u8f93\u5165 \u201cR5\u201d \u65e0\u6548</li> </ul>"},{"location":"notes/arduino/projet/code/#stop-s","title":"STOP \u547d\u4ee4 s","text":"<pre><code>  if (s == \"s\") {\n    mode = MODE_STOP;\n    mstate = M_IDLE;\n    stopMotor();\n    return;\n  }\n</code></pre> <ul> <li><code>mode=STOP</code>\uff1a\u505c\u6b62\u81ea\u52a8\u8ddf\u968f</li> <li><code>mstate=M_IDLE</code>\uff1a\u5f3a\u5236\u53d6\u6d88\u4efb\u4f55\u6b63\u5728\u6267\u884c\u7684\u8fd0\u52a8\u4efb\u52a1</li> <li><code>stopMotor()</code>\uff1a\u786e\u4fdd\u7535\u673a\u65ad\u7535</li> <li><code>return</code>\uff1a\u7ed3\u675f\u5904\u7406</li> </ul>"},{"location":"notes/arduino/projet/code/#go-g","title":"GO \u547d\u4ee4 g","text":"<pre><code>  if (s == \"g\") {\n    mode = MODE_GO;\n    return;\n  }\n</code></pre> <ul> <li>\u5207\u6362\u5230\u81ea\u52a8\u8ddf\u968f</li> <li>\u4e0d\u76f4\u63a5 motionStartTo\uff0c\u56e0\u4e3a GO \u903b\u8f91\u5728 loop \u7684\u5468\u671f\u66f4\u65b0\u4e2d\u7edf\u4e00\u5904\u7406\uff08\u7ed3\u6784\u66f4\u5e72\u51c0\uff09</li> </ul>"},{"location":"notes/arduino/projet/code/#rlr5l5","title":"\u624b\u52a8\u5fae\u8c03\u547d\u4ee4 r/l/r5/l5","text":"<pre><code>  if (s == \"r\")  { motionMoveBy(+ONE_REV_COUNTS); return; }\n  if (s == \"l\")  { motionMoveBy(-ONE_REV_COUNTS); return; }\n  if (s == \"r5\") { motionMoveBy(+5 * ONE_REV_COUNTS); return; }\n  if (s == \"l5\") { motionMoveBy(-5 * ONE_REV_COUNTS); return; }\n</code></pre> <ul> <li><code>ONE_REV_COUNTS=12</code>\uff1a\u4f60\u5b9a\u4e49\u7684\u673a\u68b0\u53c2\u6570</li> <li>\u8fd9\u4e9b\u547d\u4ee4\u76f4\u63a5\u8c03\u7528\u201c\u4f60\u5b8c\u7f8e\u7684 motion \u72b6\u6001\u673a\u201d</li> <li>\u6ce8\u610f\uff1a\u5373\u4fbf\u5728 STOP \u6a21\u5f0f\uff0c\u4e5f\u80fd\u624b\u52a8\u5fae\u8c03\u2014\u2014\u8fd9\u7b26\u5408\u4f60\u6700\u65e9\u7684\u9700\u6c42\uff08\u6821\u51c6\u65f6\u4e0d\u968f\u6e29\u5ea6\u52a8\uff09</li> </ul>"},{"location":"notes/arduino/projet/code/#sync","title":"sync \u6821\u51c6\u547d\u4ee4\uff08\u4f60\u81ea\u5df1\u5199\u7684\u5173\u952e\u529f\u80fd\uff09","text":"<pre><code>  if (s == \"sync\") {\n    float err = wrap180(expectedDeg - actualDeg);\n    calibOffsetDeg = wrap180(calibOffsetDeg + err);\n    return;\n  }\n</code></pre> <p>\u8fd9\u662f\u6700\u503c\u5f97\u5199\u62a5\u544a\u7684\u90e8\u5206\u4e4b\u4e00\u3002</p>"},{"location":"notes/arduino/projet/code/#offset-expected-actual","title":"\u4e3a\u4ec0\u4e48\u662f \u201coffset += (expected - actual)\u201d\uff1f","text":"<p>\u4f60\u5e0c\u671b sync \u4e4b\u540e\uff0c\u5f53\u524d count \u4e0b\u7b97\u51fa\u6765\u7684\u89d2\u5ea6\u53d8\u6210 expectedDeg\u3002</p> <p>\u539f\u672c\uff1a [ actualDeg = count\\cdot degPer + offset ]</p> <p>\u4f60\u8981\u65b0\u7684 offset' \u4f7f\u5f97\uff1a [ expectedDeg = count\\cdot degPer + offset' ]</p> <p>\u6240\u4ee5\uff1a [ offset' = expectedDeg - count\\cdot degPer ]</p> <p>\u800c\u4f60\u5f53\u524d offset \u5df2\u7ecf\u6ee1\u8db3\uff1a [ actualDeg = count\\cdot degPer + offset \\Rightarrow count\\cdot degPer = actualDeg - offset ]</p> <p>\u4ee3\u5165\uff1a [ offset' = expectedDeg - (actualDeg - offset) = offset + (expectedDeg - actualDeg) ]</p> <p>\u6240\u4ee5\u6b63\u786e\u66f4\u65b0\u5c31\u662f\uff1a</p> <pre><code>offset = offset + (expected - actual)\n</code></pre> <p>\u4f60\u4ee3\u7801\u5b8c\u5168\u6b63\u786e\u3002</p> <p><code>wrap180()</code> \u662f\u4e3a\u4e86\u9632\u6b62\u504f\u79fb\u7d2f\u79ef\u8d8a\u754c\u3002</p>"},{"location":"notes/arduino/projet/code/#7-setup","title":"\u7b2c 7 \u5927\u6bb5\uff1asetup() \u521d\u59cb\u5316\uff08\u7cfb\u7edf\u4e0a\u7535\u884c\u4e3a\uff09  <pre><code>void setup() {\n  Serial.begin(9600);\n</code></pre> <ul> <li><code>Serial.begin(9600)</code>\uff1aArduino \u81ea\u5e26\u4e32\u53e3\u521d\u59cb\u5316</li> <li>\u6ce2\u7279\u7387 9600\uff08\u4f60\u8981\u6c42\u7684\uff09</li> </ul>  <pre><code>  pinMode(PIN_DIR, OUTPUT);\n  pinMode(PIN_EN, OUTPUT);\n  pinMode(PIN_ENC_A, INPUT_PULLUP);\n  pinMode(PIN_ENC_B, INPUT_PULLUP);\n  stopMotor();\n</code></pre> <ul> <li><code>pinMode()</code> / <code>INPUT_PULLUP</code>\uff1aArduino \u81ea\u5e26</li> <li>\u7f16\u7801\u5668\u7528\u4e0a\u62c9\u8f93\u5165\uff1a\u5e38\u89c1\u505a\u6cd5\uff0c\u51cf\u5c11\u60ac\u7a7a\u566a\u58f0</li> <li><code>stopMotor()</code>\uff1a\u4e0a\u7535\u5148\u786e\u4fdd\u7535\u673a\u4e0d\u52a8\uff08\u5b89\u5168\uff09</li> </ul>  <pre><code>  Wire.begin();\n  (void)mpl3115a2Init();\n</code></pre> <ul> <li><code>Wire.begin()</code>\uff1aWire \u5e93\u81ea\u5e26\uff0c\u542f\u52a8 I2C</li> <li><code>mpl3115a2Init()</code>\uff1a\u4f60\u5199\u7684\u521d\u59cb\u5316</li> <li><code>(void)</code>\uff1a\u8868\u793a\u201c\u6211\u4e0d\u5904\u7406\u8fd4\u56de\u503c\u201d\uff08\u4e0d\u5173\u5fc3\u5931\u8d25\u4e0e\u5426\uff09\uff0c\u4e3a\u4e86\u6d88\u9664\u7f16\u8bd1\u8b66\u544a</li> </ul>  <pre><code>  long c = readCountDrive();\n  actualDeg = driveCountToShaftDeg(c, calibOffsetDeg);\n</code></pre> <ul> <li>\u4e0a\u7535\u8bfb\u4e00\u6b21\u7f16\u7801\u5668\uff0c\u5f97\u5230\u5f53\u524d\u201c\u5b9e\u9645\u89d2\u5ea6\u201d</li> <li>\u56e0\u4e3a offset \u521d\u59cb\u4e3a 0\uff0c\u6240\u4ee5\u8fd9\u4e00\u6b65\u66f4\u591a\u662f\u4e3a\u4e86\u8ba9\u6253\u5370\u7684 actualDeg \u6709\u610f\u4e49</li> </ul>  <pre><code>  Serial.println(...);\n  Serial.print(...);\n</code></pre> <ul> <li>\u6253\u5370\u63d0\u793a\u4fe1\u606f\uff08\u8c03\u8bd5/\u5b9e\u9a8c\u62a5\u544a\u5f88\u597d\u7528\uff09</li> </ul>","text":""},{"location":"notes/arduino/projet/code/#8-loop","title":"\u7b2c 8 \u5927\u6bb5\uff1aloop() \u4e3b\u5faa\u73af\u8c03\u5ea6\uff08\u975e\u963b\u585e\u7ed3\u6784\uff09 <p>\u4f60 loop \u91cc\u4e3b\u8981\u5206\u4e09\u5757\uff1a</p> <ol> <li>\u8bfb\u4e32\u53e3\u547d\u4ee4\uff08\u968f\u65f6\u54cd\u5e94\uff09</li> <li>\u6bcf CTRL_MS \u505a\u4e00\u6b21\u63a7\u5236\u66f4\u65b0\uff08\u5b9a\u65f6\u6267\u884c\uff09</li> <li>\u6bcf PRINT_MS \u6253\u5370\u4e00\u6b21\u72b6\u6001\uff08\u5b9a\u65f6\u6267\u884c\uff09</li> </ol>","text":""},{"location":"notes/arduino/projet/code/#81","title":"8.1 \u8bfb\u4e32\u53e3\u547d\u4ee4\uff08\u4f60\u5199\u7684\u7f13\u51b2\u903b\u8f91\uff09","text":"<pre><code>while (Serial.available()) {\n  char ch = (char)Serial.read();\n</code></pre> <ul> <li><code>Serial.available()</code> / <code>Serial.read()</code>\uff1aArduino \u81ea\u5e26</li> <li>\u9010\u5b57\u8282\u8bfb\u5165</li> </ul> <p>\u9047\u5230\u6362\u884c/\u56de\u8f66\uff0c\u8ba4\u4e3a\u4e00\u6761\u547d\u4ee4\u7ed3\u675f\uff1a</p> <pre><code>  if (ch == '\\n' || ch == '\\r') {\n    if (cmdLine.length()) {\n      handleCommand(cmdLine);\n      cmdLine = \"\";\n    }\n  }\n</code></pre> <p>\u5426\u5219\u8ffd\u52a0\u5230\u5b57\u7b26\u4e32\uff1a</p> <pre><code>  else {\n    cmdLine += ch;\n    if (cmdLine.length() &gt; 64) cmdLine.remove(0, 32);\n  }\n</code></pre> <ul> <li><code>remove()</code> \u662f String \u81ea\u5e26\u65b9\u6cd5</li> <li>\u9632\u6b62\u7528\u6237\u4e71\u8f93\u5165\u5bfc\u81f4 cmdLine \u65e0\u9650\u957f</li> </ul>"},{"location":"notes/arduino/projet/code/#82-ctrl_ms-loop","title":"8.2 \u6bcf CTRL_MS \u66f4\u65b0\u4e00\u6b21\u63a7\u5236\uff08\u4f60\u5199\u7684\u201c\u5b9a\u65f6\u5668\u5f0f loop\u201d\uff09","text":"<pre><code>static unsigned long lastCtrl = 0;\nunsigned long now = millis();\nif (now - lastCtrl &gt;= CTRL_MS) {\n  lastCtrl = now;\n</code></pre> <ul> <li>\u8fd9\u662f\u5178\u578b\u201c\u975e\u963b\u585e\u5b9a\u65f6\u201d\u5199\u6cd5</li> <li>\u597d\u5904\uff1a\u4e0d\u7528 delay\uff0c\u7cfb\u7edf\u80fd\u53ca\u65f6\u54cd\u5e94\u4e32\u53e3</li> </ul>"},{"location":"notes/arduino/projet/code/#821-expecteddeg","title":"8.2.1 \u8bfb\u6e29\u5ea6 \u2192 expectedDeg","text":"<pre><code>  float tempC = 0.0f;\n  bool tOk = readTemperatureC(tempC);\n  if (tOk) expectedDeg = tempToAngleDeg(tempC);\n</code></pre> <ul> <li><code>readTemperatureC()</code>\uff1a\u4f60\u5199\u7684 I2C \u8bfb\u53d6</li> <li><code>tempToAngleDeg()</code>\uff1a\u4f60\u5199\u7684\u7ebf\u6027\u6620\u5c04</li> <li>tOk \u5931\u8d25\u5c31\u4e0d\u66f4\u65b0 expectedDeg\uff08\u4fdd\u6301\u4e0a\u4e00\u6b21\u503c\uff09</li> </ul>"},{"location":"notes/arduino/projet/code/#822-actualdeg","title":"8.2.2 \u8bfb\u7f16\u7801\u5668 \u2192 actualDeg","text":"<pre><code>  long countDrive = readCountDrive();\n  actualDeg = driveCountToShaftDeg(countDrive, calibOffsetDeg);\n</code></pre> <ul> <li><code>readCountDrive()</code>\uff1a\u4f60\u5199\u7684\u5c01\u88c5\uff08\u5185\u90e8 enc.read\uff09</li> <li><code>driveCountToShaftDeg()</code>\uff1a\u4f60\u5199\u7684\u6362\u7b97\uff08count\u2192\u89d2\u5ea6 + offset\uff09</li> </ul>"},{"location":"notes/arduino/projet/code/#823-go","title":"8.2.3 GO \u6a21\u5f0f\uff1a\u76ee\u6807\u53d8\u5316\u624d\u542f\u52a8\u8fd0\u52a8","text":"<pre><code>  if (mode == MODE_GO) {\n    expectedCountDrive = expectedDegToTargetCount(expectedDeg);\n\n    if (expectedCountDrive != targetCountDrive) {\n      motionStartTo(expectedCountDrive);\n    }\n  }\n</code></pre> <p>\u8fd9\u4e00\u6bb5\u975e\u5e38\u5173\u952e\uff1a\u53ea\u5728\u76ee\u6807 count \u6539\u53d8\u65f6\u624d\u542f\u52a8\u4e00\u6b21\u8fd0\u52a8\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u505a\uff1f</p> <ul> <li> <p>\u5982\u679c\u4f60\u6bcf\u4e2a CTRL_MS \u90fd\u5f3a\u884c motionStartTo\uff0c\u4f1a\u4e00\u76f4\u91cd\u7f6e\u72b6\u6001\u673a\uff1a</p> </li> <li> <p>\u7a33\u5b9a\u8ba1\u65f6\u6e05\u96f6</p> </li> <li>\u72b6\u6001\u6c38\u8fdc\u5728 COARSE_FAST</li> <li>\u4f1a\u5bfc\u81f4\u6296\u52a8/\u9707\u8361</li> <li>\u73b0\u5728\u8fd9\u6837\u5199\uff1a\u72b6\u6001\u673a\u53ef\u4ee5\u81ea\u5df1\u5b8c\u6574\u8dd1\u5b8c\u4e00\u6b21\u8fd0\u52a8\u4efb\u52a1</li> </ul>"},{"location":"notes/arduino/projet/code/#824-stop","title":"8.2.4 STOP \u6a21\u5f0f\uff1a\u6ca1\u6709\u8fd0\u52a8\u4efb\u52a1\u5c31\u505c\u673a","text":"<pre><code>  if (mode == MODE_STOP &amp;&amp; mstate == M_IDLE) {\n    stopMotor();\n  }\n</code></pre> <ul> <li>STOP \u6a21\u5f0f\u9ed8\u8ba4\u7535\u673a\u505c</li> <li>\u4f46\u5982\u679c\u4f60\u624b\u52a8\u8f93\u5165 r/l \u89e6\u53d1\u4e86 motionMoveBy\uff0c\u6b64\u65f6 mstate != IDLE\uff0c\u5c31\u4e0d\u4f1a\u5f3a\u5236 stop\uff08\u4fdd\u8bc1\u624b\u52a8\u52a8\u4f5c\u80fd\u5b8c\u6210\uff09</li> </ul>"},{"location":"notes/arduino/projet/code/#825","title":"8.2.5 \u8fd0\u884c\u8fd0\u52a8\u72b6\u6001\u673a\uff08\u53ea\u8981\u76ee\u6807\u5b58\u5728\u5c31\u4f1a\u52a8\uff09","text":"<pre><code>  motionUpdate();\n</code></pre> <ul> <li>\u8fd9\u662f\u4f60\u6700\u6838\u5fc3\u7684\u63a7\u5236\u5668\uff0c\u6211\u4eec\u4e0a\u4e00\u6bb5\u8bb2\u8fc7</li> </ul>"},{"location":"notes/arduino/projet/code/#83","title":"8.3 \u5b9a\u65f6\u6253\u5370\uff08\u4f60\u5199\u7684\u8c03\u8bd5\u8f93\u51fa\uff09","text":"<pre><code>static unsigned long lastPrint = 0;\nif (now - lastPrint &gt;= PRINT_MS) {\n  lastPrint = now;\n  ...\n}\n</code></pre> <p>\u6253\u5370\u5185\u5bb9\uff1a</p> <ul> <li>\u6e29\u5ea6 <code>T=</code></li> <li>expectedDeg</li> <li>actualDeg</li> <li>countDrive</li> <li>mode</li> </ul> <p>\u8fd9\u5bf9\u5b9e\u9a8c\u62a5\u544a\u4e5f\u5f88\u91cd\u8981\uff1a\u4f60\u53ef\u4ee5\u622a\u56fe\u4f5c\u4e3a\u5b9e\u9a8c\u7ed3\u679c\u3002</p>"},{"location":"notes/arduino/projet/code/#_13","title":"\u8fd9\u4e00\u6bb5\u7684\u201c\u8c01\u5b9a\u4e49\u7684\u201d\u603b\u7ed3","text":"<p>\u2705 \u4f60\u81ea\u5df1\u5b9a\u4e49/\u5b9e\u73b0\uff1a</p> <ul> <li><code>Mode</code>\u3001<code>mode</code></li> <li><code>calibOffsetDeg</code>\u3001<code>expectedDeg</code>\u3001<code>actualDeg</code></li> <li><code>expectedDegToTargetCount()</code></li> <li><code>handleCommand()</code></li> <li>loop \u5185\u90e8\u8c03\u5ea6\u903b\u8f91\uff08lastCtrl/lastPrint\uff09</li> </ul> <p>\u2705 Arduino/\u5e93\u63d0\u4f9b\uff1a</p> <ul> <li><code>Serial.begin/available/read/print/println</code></li> <li><code>millis()</code></li> <li><code>pinMode()</code></li> <li><code>Wire.begin()</code></li> <li><code>Encoder enc</code> \u7684 <code>enc.read()</code></li> </ul> <p>\u5982\u679c\u4f60\u613f\u610f\uff0c\u6211\u8fd8\u53ef\u4ee5\u628a\u4f60\u6574\u6bb5\u201csync \u6821\u51c6\u63a8\u5bfc\u201d\u5199\u6210\u62a5\u544a\u5f62\u5f0f\uff08\u542b\u516c\u5f0f\u63a8\u5bfc\uff09\uff0c\u4ee5\u53ca\u628a\u72b6\u6001\u673a\u753b\u6210\u4e00\u4e2a\u7b80\u5355\u7684\u6d41\u7a0b\u56fe\u63cf\u8ff0\uff08\u6587\u5b57\u7248/\u4f2a\u4ee3\u7801\u7248\uff09\u3002</p>"},{"location":"notes/arduino/projet/pre/","title":"Pre","text":""},{"location":"notes/arduino/projet/pre/#_1","title":"\ud83d\udcc4 \u5bf9\u5e94\u9875","text":"<ul> <li>Lecture des donn\u00e9es</li> <li>Rotation du moteur et initialisation de l\u2019angle</li> <li>Commandes et modes de fonctionnement</li> </ul>"},{"location":"notes/arduino/projet/pre/#_2","title":"\ud83c\udde8\ud83c\uddf3 \u4e2d\u6587\uff08\u4f60\u7684\u7248\u672c\uff0c\u8f7b\u5fae\u6574\u7406\uff09","text":""},{"location":"notes/arduino/projet/pre/#lecture-des-donnees","title":"\ud83d\udd39 \u6570\u636e\u8bfb\u53d6\uff08Lecture des donn\u00e9es\uff09","text":"<p>\u9996\u5148\uff0c\u6e29\u5ea6\u7531 MPL3115A2 \u6e29\u5ea6\u4f20\u611f\u5668 \u901a\u8fc7 I\u00b2C \u901a\u4fe1 \u8bfb\u53d6\uff0c \u5f97\u5230\u7a33\u5b9a\u7684\u6e29\u5ea6\u503c\u540e\uff0c\u518d\u7ebf\u6027\u8f6c\u6362\u4e3a\u76ee\u6807\u89d2\u5ea6\u3002</p> <p>\u5176\u6b21\uff0c\u7535\u673a\u7684\u65cb\u8f6c\u89d2\u5ea6\u662f\u65e0\u6cd5\u76f4\u63a5\u6d4b\u91cf\u7684\uff0c \u56e0\u6b64\u6211\u4eec\u901a\u8fc7 \u7535\u673a\u7f16\u7801\u5668\u7684\u8ba1\u6570\u503c \u6765\u8ba1\u7b97\u89d2\u5ea6\u3002</p> <p>\u901a\u8fc7\u5b9e\u9a8c\u6211\u4eec\u5f97\u5230\uff1a</p> <ul> <li>\u9a71\u52a8\u8f6e\u65cb\u8f6c\u4e00\u5708\uff0c\u5bf9\u5e94 12 \u4e2a\u7f16\u7801\u5668\u8ba1\u6570</li> <li>\u6307\u9488\u8f74\u65cb\u8f6c 360\u00b0\uff0c\u9700\u8981 52.734 \u5708\u9a71\u52a8\u8f6e</li> </ul> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u5173\u7cfb\u5f0f\uff0c \u6765\u63a7\u5236\u7535\u673a\u65cb\u8f6c\u5230\u5bf9\u5e94\u7684\u89d2\u5ea6\u3002</p>"},{"location":"notes/arduino/projet/pre/#_3","title":"\ud83d\udd39 \u7535\u673a\u65cb\u8f6c\u4e0e\u89d2\u5ea6\u521d\u59cb\u5316","text":"<p>\uff08Rotation du moteur et initialisation de l\u2019angle\uff09</p> <p>\u672c\u7cfb\u7edf\u4e2d\u6ca1\u6709\u7269\u7406\u610f\u4e49\u4e0a\u7684\u7edd\u5bf9\u96f6\u4f4d\uff0c \u7535\u673a\u548c\u4f20\u52a8\u673a\u6784\u53ea\u80fd\u6d4b\u91cf\u89d2\u5ea6\u7684\u53d8\u5316\u91cf\u3002</p> <p>\u56e0\u6b64\u5728\u7cfb\u7edf\u4e0a\u7535\u540e\uff0c \u6211\u4eec\u8bbe\u8ba1\u4e86\u4e00\u5957\u8f6f\u4ef6\u521d\u59cb\u5316\u6d41\u7a0b\u3002</p> <p>\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u4e32\u53e3\u547d\u4ee4\u624b\u52a8\u8c03\u6574\u6307\u9488\u4f4d\u7f6e\uff1a</p> <ul> <li><code>r / l</code>\uff1a\u6b63\u5411\u6216\u53cd\u5411\u65cb\u8f6c\u4e00\u5708</li> <li><code>r5 / l5</code>\uff1a\u6b63\u5411\u6216\u53cd\u5411\u65cb\u8f6c\u4e94\u5708</li> </ul> <p>\u5f53\u6307\u9488\u88ab\u8c03\u6574\u5230\u6b63\u786e\u4f4d\u7f6e\u540e\uff0c \u4f7f\u7528 <code>sync</code> \u547d\u4ee4\uff0c \u5c06\u5f53\u524d\u89d2\u5ea6\u8bbe\u5b9a\u4e3a\u8f6f\u4ef6\u53c2\u8003\u96f6\u4f4d\uff0c\u4ece\u800c\u5b8c\u6210\u6807\u5b9a\u3002</p>"},{"location":"notes/arduino/projet/pre/#_4","title":"\ud83d\udd39 \u547d\u4ee4\u4e0e\u5de5\u4f5c\u6a21\u5f0f","text":"<p>\uff08Commandes et modes de fonctionnement\uff09</p> <p>\u7cfb\u7edf\u4e3b\u8981\u6709\u4e24\u79cd\u5de5\u4f5c\u6a21\u5f0f\u3002</p> <p>STOP \u6a21\u5f0f \u662f\u9ed8\u8ba4\u6a21\u5f0f\uff0c \u6b64\u65f6\u7535\u673a\u4e0d\u4f1a\u81ea\u52a8\u8fd0\u52a8\u3002 \u901a\u5e38\u5728\u8be5\u6a21\u5f0f\u4e0b\uff0c \u4f7f\u7528\u6307\u4ee4\u8c03\u6574\u7535\u673a\u7684\u521d\u59cb\u89d2\u5ea6\u3002</p> <p>\u5f53\u6307\u9488\u6307\u5411\u5b9e\u9645\u6e29\u5ea6\u540e\uff0c \u8f93\u5165\u6307\u4ee4 <code>sync\u3001g</code>\uff0c \u7cfb\u7edf\u8fdb\u5165 GO \u6a21\u5f0f\u3002</p> <p>\u5728 GO \u6a21\u5f0f \u4e0b\uff0c \u7cfb\u7edf\u4f1a\u6301\u7eed\u8ddf\u968f\u6e29\u5ea6\u53d8\u5316\u3002 \u6bcf\u5f53\u6e29\u5ea6\u53d1\u751f\u53d8\u5316\u65f6\uff0c \u7a0b\u5e8f\u4f1a\u91cd\u65b0\u8ba1\u7b97\u76ee\u6807\u89d2\u5ea6\uff0c \u5e76\u4e14\u53ea\u6709\u5728\u76ee\u6807\u53d1\u751f\u53d8\u5316\u65f6\uff0c \u624d\u89e6\u53d1\u7535\u673a\u8fd0\u52a8\u3002</p>"},{"location":"notes/arduino/projet/pre/#_5","title":"\ud83c\uddeb\ud83c\uddf7 \u6cd5\u8bed\u7248\u672c\uff08\u7b80\u5355\u8bcd\u6c47 + \u53e3\u8bed\u5316\uff09","text":""},{"location":"notes/arduino/projet/pre/#lecture-des-donnees_1","title":"\ud83d\udd39 Lecture des donn\u00e9es","text":"<p>D\u2019abord, la temp\u00e9rature est mesur\u00e9e par le capteur MPL3115A2 gr\u00e2ce \u00e0 une communication I\u00b2C.</p> <p>La valeur de temp\u00e9rature est stable, puis elle est convertie de fa\u00e7on lin\u00e9aire en un angle cible.</p> <p>Ensuite, l\u2019angle de rotation du moteur ne peut pas \u00eatre mesur\u00e9 directement.</p> <p>On utilise donc le comptage de l\u2019encodeur pour calculer l\u2019angle.</p> <p>Exp\u00e9rimentalement, on a obtenu que :</p> <ul> <li>un tour du volant d\u2019entra\u00eenement correspond \u00e0 12 counts,</li> <li>et 52,734 tours du volant correspondent \u00e0 360 degr\u00e9s   de rotation de l\u2019aiguille.</li> </ul> <p>Gr\u00e2ce \u00e0 cette relation, on peut commander la rotation du moteur pour atteindre l\u2019angle souhait\u00e9.</p>"},{"location":"notes/arduino/projet/pre/#rotation-du-moteur-et-initialisation-de-langle","title":"\ud83d\udd39 Rotation du moteur et initialisation de l\u2019angle","text":"<p>Le moteur n\u2019a pas de position z\u00e9ro physique.</p> <p>Le moteur et le m\u00e9canisme permettent seulement de mesurer la variation de l\u2019angle.</p> <p>C\u2019est pourquoi, apr\u00e8s la mise sous tension, on a mis en place une initialisation logicielle.</p> <p>L\u2019utilisateur peut ajuster manuellement la position de l\u2019aiguille avec des commandes s\u00e9rie :</p> <ul> <li><code>r / l</code> pour une rotation d\u2019un tour,</li> <li><code>r5 / l5</code> pour une rotation de cinq tours.</li> </ul> <p>Une fois la position correcte atteinte, la commande <code>sync</code> permet de d\u00e9finir la position actuelle comme r\u00e9f\u00e9rence logicielle.</p>"},{"location":"notes/arduino/projet/pre/#commandes-et-modes-de-fonctionnement","title":"\ud83d\udd39 Commandes et modes de fonctionnement","text":"<p>Le syst\u00e8me fonctionne avec deux modes principaux.</p> <p>Le mode STOP est le mode par d\u00e9faut. Dans ce mode, le moteur ne bouge pas automatiquement.</p> <p>En g\u00e9n\u00e9ral, on utilise les commandes <code>r / l / r5 / l5</code> pour r\u00e9gler la position initiale de l\u2019aiguille.</p> <p>Quand l\u2019aiguille indique la temp\u00e9rature r\u00e9elle, on entre la commande <code>sync</code> et <code>g</code> pour passer en mode GO.</p> <p>En mode GO, le syst\u00e8me suit en continu les variations de temp\u00e9rature.</p> <p>\u00c0 chaque changement de temp\u00e9rature,le programme recalcule l\u2019angle cible, et le moteur ne bouge que si la consigne change.</p>"},{"location":"notes/arduino/projet/projet/","title":"Projet","text":"\u529f\u80fd \u6a21\u5757\u5f15\u811a Arduino Mega I2C SCL SCL D21 I2C SDA SDA D20 \u7535\u673a\u65b9\u5411 DIR D8 \u7535\u673a\u4f7f\u80fd(PWM) EN D9 \u7f16\u7801\u5668A SA D2 \u7f16\u7801\u5668B SB D3 <p>\u4f7f\u7528encoder.h\u5e93\u505a\u4e00\u4e2a\u611f\u5e94\u6e29\u5ea6\u7684\u673a\u5668\uff0c\u5176\u539f\u7406\u662f\uff0c\u5f53\u6e29\u5ea6\u53d8\u5316\u65f6\uff0c\u68c0\u6d4b\u6e29\u5ea6\uff0c\u7136\u540e\u9a71\u52a8\u8f6e\u8f6c\u52a8\u4f20\u52a8\u8f74\u901a\u8fc7\u6307\u9488\u6307\u5411\u8be5\u6e29\u5ea6\u3002\u6e29\u5ea6\u8303\u56f420-30\u6444\u6c0f\u5ea6\uff0c\u6307\u9488\u89d2\u5ea6-180\u5230180\u5ea6\uff08\u537320\u6444\u6c0f\u5ea6\u548c30\u6444\u6c0f\u5ea6\u6307\u9488\u5728\u540c\u4e00\u4e2a\u89d2\u5ea6\uff09\u3002\u5176\u6b21\u7531\u4e8e\u7535\u673a\u6ca1\u6709\u9ed8\u8ba40\u89d2\u5ea6\u6211\u9700\u8981\u51e0\u4e2a\u529f\u80fd\uff0c\u9996\u5148\u662fs\uff0c\u8f93\u5165s\u4f7f\u673a\u5668\u505c\u6b62\u8fd0\u884c\uff0c\u5373\u4f7f\u6e29\u5ea6\u6539\u53d8\u7535\u673a\u4e5f\u4e0d\u968f\u7740\u53d8\u5316\uff0c\u5e76\u9ed8\u8ba4\u4e0a\u7535\u8fdb\u5165s\u6a21\u5f0f\uff0cg\uff0c\u8f93\u5165g\u4ee3\u8868go\uff0c\u4f7f\u673a\u5668\u6b63\u5e38\u8fd0\u884c\u3002r\uff0c\u8f93\u5165r\u4f7f\u6307\u9488\u5f80\u53f3\u504f\u8f6c\u4e00\u70b9\uff0c\u7528\u4e8e\u5fae\u8c03\uff0cl\uff0c\u8f93\u5165l\u4f7f\u6307\u9488\u5f80\u5de6\u504f\u8f6c\u4e00\u70b9\uff0cr5\u3001l5\uff0c\u8f93\u5165r5\u3001l5\u4f7f\u6307\u9488\u591a\u8f6c\u52a8\u4e00\u70b9\u7528\u4e8e\u7c97\u8c03\u3002\u5f53\u524d\u6e29\u5ea6\uff0c\u8be5\u6e29\u5ea6\u6240\u5bf9\u5e94\u7684\u89d2\u5ea6\uff08\u9884\u671f\u89d2\u5ea6\uff09\uff0c\u5b9e\u9645\u89d2\u5ea6\uff08\u7535\u673a\u8f6c\u52a8\u540e\u7684\u5b9e\u9645\u89d2\u5ea6\uff09\uff0ccount\u7528\u4e8e\u8ba1\u6570\uff0csync\uff0c\u8f93\u5165sync\u4f7f\u5f53\u524d\u7684\u5b9e\u9645\u89d2\u5ea6=\u9884\u671f\u89d2\u5ea6\u3002\u6bd4\u5982\u6b64\u65f6\u662f22.5\u6444\u6c0f\u5ea6\u5e94\u8be5\u5bf9\u5e94-90\u5ea6\uff0cgo\u4e4b\u540e\u5b9e\u9645\u89d2\u5ea6\u4e5f\u4e3a-90\u5ea6\uff0c\u800c\u6307\u9488\u5374\u6307\u541125\u6444\u6c0f\u5ea6\uff0c\u5219\u9700\u8981\u8f93\u5165l\u3001r\u8ba9\u5b9e\u9645\u89d2\u5ea6\u504f\u8f6c\uff0c\u6bd4\u5982\u504f\u8f6c\u5230-180\u5ea6\uff0c\u7136\u540e\u8f93\u5165sync\u4f7f\u8fd9\u4e2a-180\u53d8\u4e3a-90.\u6ce2\u7279\u7387\u4e3a9600\uff0c\u4f7f\u7528pi\u63a7\u5236\uff08\u4e0d\u7528d\uff09\uff0c\u4e32\u53e3\u8f93\u51fa\u4e3a\uff1a\u6e29\u5ea6\u4f20\u611f\u5668\u6d4b\u5f97\u7684\u6e29\u5ea6\uff1b\u5f53\u524d\u6e29\u5ea6\u5bf9\u5e94\u7684\u9884\u671f\u65cb\u8f6c\u89d2\u5ea6\u3001\u5b9e\u9645\u65cb\u8f6c\u89d2\u5ea6\uff0c\u8ba1\u6570\u5668count\u6b21\u6570\u3002\u7535\u673a\u51cf\u901f\u6bd4\u4e3a1\uff1a52.734</p> <p>STOP \u662f\uff1a \u505c\u673a\u4e0d\u52a8\uff08\u7535\u673a\u5b8c\u5168\u4e0d\u9a71\u52a8\uff09\uff0c\u6e29\u5ea6\u53d8\u4e5f\u4e0d\u52a8\uff1b \u53ea\u6709\u53d1 r/l/r5/l5 \u65f6\u624d\u201c\u52a8\u4e00\u4e0b\u201d\uff0c\u5230\u4f4d\u5c31\u9a6c\u4e0a\u505c\u6b62\u9a71\u52a8\uff0c\u4e0d\u518d\u4fdd\u6301\u3002</p> <p>\u6240\u4ee5\u8981\u6539\u6210\uff1aSTOP \u4e0b\u5b8c\u5168\u4e0d\u8f93\u51fa\uff0c\u65b0\u589e\u4e00\u4e2a JOG \u6a21\u5f0f\uff1a\u53ea\u5728 jog \u65f6\u505a\u77ed\u6682\u95ed\u73af\uff0c\u5230\u4e86\u5c31\u7acb\u523b\u56de\u5230 STOP \u5e76\u5173 PWM\u3002</p>"},{"location":"notes/arduino/projet/projet/#include","title":"include","text":""},{"location":"notes/arduino/projet/projet/#include_1","title":"include  <p>\u8fd9\u4e2a\u6bb5\u4ee3\u7801\u5df2\u7ecf\u5b9e\u73b0\u4e86r/l/r5/l5\u7684\u529f\u80fd</p>","text":""},{"location":"notes/arduino/projet/projet/#include_2","title":"include  <p>const uint8_t PIN_DIR = 8; const uint8_t PIN_EN  = 9; const uint8_t PIN_ENC_A = 2; const uint8_t PIN_ENC_B = 3;</p> <p>const bool INVERT_MOTOR_DIR = true; const bool INVERT_ENCODER   = true;</p> <p>const long ONE_REV_COUNTS = 12;</p> <p>// zones const long FAR_ZONE = 8;      // |err| &gt;= 8 -&gt; coarse const long NEAR_ZONE = 3;     // 3 &lt;= |err| &lt; 8 -&gt; slow coarse const long FINE_ZONE = 2;     // |err| &lt;= 2 -&gt; fine nudge (try to land on 0)</p> <p>// tolerance &amp; stability goals const long TOL_DONE = 0;              // \u4f60\u8981\u201c\u591a\u6570=0\u201d\uff1a\u5b8c\u6210\u6761\u4ef6\u8bbe\u4e3a0 const unsigned long STABLE_MS_ZERO = 500; // \u8fde\u7eed500ms\u4fdd\u6301err==0\u624d\u7ed3\u675f const unsigned long STABLE_MS_ONE  = 800; // \u5982\u679c\u4e00\u76f4\u505a\u4e0d\u52300\uff0c\u5141\u8bb8err=\u00b11\u7a33\u5b9a800ms\u4e5f\u7ed3\u675f\uff08\u53ef\u9009\u515c\u5e95\uff09 const bool ALLOW_FALLBACK_PLUSMINUS1 = true;</p> <p>// coarse P const float KP_COARSE = 7.0f; const int PWM_COARSE_MIN_FAST = 60; const int PWM_COARSE_MAX_FAST = 130;</p> <p>const int PWM_COARSE_MIN_SLOW = 55; const int PWM_COARSE_MAX_SLOW = 100;</p> <p>// nudge const int PWM_NUDGE = 55;                 // \u8d34\u8fd1\u201c\u80fd\u52a8\u95e8\u69db\u201d const unsigned long NUDGE_OFF_MS = 160;   // \u7b49\u5f85\u505c\u7a33\uff08\u5f88\u5173\u952e\uff09</p> <p>const unsigned long NUDGE_ON_MS_COARSE = 35; // err=2\u65f6\u7528 const unsigned long NUDGE_ON_MS_FINE   = 15; // err=1\u65f6\u7528\uff08\u66f4\u77ed\uff0c\u4e89\u53d6\u843d\u52300\uff09</p> <p>// control timing const unsigned long CTRL_MS  = 10; const unsigned long PRINT_MS = 100; const unsigned long TIMEOUT_MS = 7000;</p> <p>Encoder enc(PIN_ENC_A, PIN_ENC_B);</p> <p>enum State { IDLE, COARSE_FAST, COARSE_SLOW, NUDGE_OFF, NUDGE_ON }; State st = IDLE;</p> <p>long target = 0; unsigned long startMs = 0;</p> <p>unsigned long phaseT0 = 0; unsigned long stableZeroT0 = 0; unsigned long stableOneT0  = 0;</p> <p>String line;</p> <p>long readCount() {   long c = enc.read();   if (INVERT_ENCODER) c = -c;   return c; }</p> <p>void stopMotor() { analogWrite(PIN_EN, 0); }</p> <p>void setMotor(bool dirHigh, int pwm) {   if (INVERT_MOTOR_DIR) dirHigh = !dirHigh;   digitalWrite(PIN_DIR, dirHigh ? HIGH : LOW);   analogWrite(PIN_EN, pwm); }</p> <p>void startMoveBy(long delta) {   long c = readCount();   target = c + delta;   startMs = millis();   stableZeroT0 = 0;   stableOneT0 = 0;   st = COARSE_FAST; }</p> <p>void setup() {   Serial.begin(9600);   pinMode(PIN_DIR, OUTPUT);   pinMode(PIN_EN, OUTPUT);   pinMode(PIN_ENC_A, INPUT_PULLUP);   pinMode(PIN_ENC_B, INPUT_PULLUP);   stopMotor();   Serial.println(F(\"Hybrid+Fine (aim 0 error) ready. Commands: r l r5 l5 s z\")); }</p> <p>void loop() {   while (Serial.available()) {     char ch = (char)Serial.read();     if (ch == '\\n' || ch == '\\r') {       if (line.length()) {         line.trim(); line.toLowerCase();         if (line == \"r\")  startMoveBy(+ONE_REV_COUNTS);         if (line == \"l\")  startMoveBy(-ONE_REV_COUNTS);         if (line == \"r5\") startMoveBy(+5 * ONE_REV_COUNTS);         if (line == \"l5\") startMoveBy(-5 * ONE_REV_COUNTS);         if (line == \"s\") { st = IDLE; stopMotor(); }         if (line == \"z\") { enc.write(0); st = IDLE; stopMotor(); target = 0; }         line = \"\";       }     } else {       line += ch;       if (line.length() &gt; 16) line.remove(0, 8);     }   }</p> <p>static unsigned long lastCtrl = 0;   unsigned long now = millis();   if (now - lastCtrl &gt;= CTRL_MS) {     lastCtrl = now;</p> <pre><code>long c = readCount();\nlong err = target - c;\nlong aerr = labs(err);\n\n// timeout\nif (st != IDLE &amp;&amp; now - startMs &gt; TIMEOUT_MS) {\n  st = IDLE;\n  stopMotor();\n}\n\n// stability tracking\nif (st != IDLE) {\n  if (err == 0) {\n    if (stableZeroT0 == 0) stableZeroT0 = now;\n  } else {\n    stableZeroT0 = 0;\n  }\n\n  if (labs(err) == 1) {\n    if (stableOneT0 == 0) stableOneT0 = now;\n  } else {\n    stableOneT0 = 0;\n  }\n\n  // finish condition: prefer true zero\n  if (TOL_DONE == 0) {\n    if (stableZeroT0 != 0 &amp;&amp; now - stableZeroT0 &gt;= STABLE_MS_ZERO) {\n      st = IDLE; stopMotor();\n    } else if (ALLOW_FALLBACK_PLUSMINUS1 &amp;&amp; stableOneT0 != 0 &amp;&amp; now - stableOneT0 &gt;= STABLE_MS_ONE) {\n      st = IDLE; stopMotor();\n    }\n  }\n}\n\n// state machine\nif (st == IDLE) {\n  stopMotor();\n}\nelse if (st == COARSE_FAST || st == COARSE_SLOW) {\n  if (aerr &lt;= FINE_ZONE) {\n    st = NUDGE_OFF;\n    phaseT0 = now;\n    stopMotor();\n  } else if (aerr &lt; NEAR_ZONE) {\n    st = COARSE_SLOW;\n  } else if (aerr &lt; FAR_ZONE) {\n    st = COARSE_SLOW;\n  } else {\n    st = COARSE_FAST;\n  }\n\n  if (st == COARSE_FAST || st == COARSE_SLOW) {\n    float u = KP_COARSE * (float)err;\n    bool dirHigh = (u &gt;= 0);\n    int pwm = (int)fabs(u);\n\n    if (st == COARSE_FAST) {\n      if (pwm &gt; PWM_COARSE_MAX_FAST) pwm = PWM_COARSE_MAX_FAST;\n      if (pwm &gt; 0 &amp;&amp; pwm &lt; PWM_COARSE_MIN_FAST) pwm = PWM_COARSE_MIN_FAST;\n    } else {\n      if (pwm &gt; PWM_COARSE_MAX_SLOW) pwm = PWM_COARSE_MAX_SLOW;\n      if (pwm &gt; 0 &amp;&amp; pwm &lt; PWM_COARSE_MIN_SLOW) pwm = PWM_COARSE_MIN_SLOW;\n    }\n    setMotor(dirHigh, pwm);\n  }\n}\nelse if (st == NUDGE_OFF) {\n  stopMotor();\n  if (now - phaseT0 &gt;= NUDGE_OFF_MS) {\n    st = NUDGE_ON;\n    phaseT0 = now;\n  }\n}\nelse if (st == NUDGE_ON) {\n  // choose shorter pulse when |err|==1 to land at 0\n  unsigned long onMs = (aerr &lt;= 1) ? NUDGE_ON_MS_FINE : NUDGE_ON_MS_COARSE;\n\n  bool dirHigh = (err &gt; 0);\n  setMotor(dirHigh, PWM_NUDGE);\n\n  if (now - phaseT0 &gt;= onMs) {\n    st = NUDGE_OFF;\n    phaseT0 = now;\n  }\n}\n\n// print\nstatic unsigned long lastP = 0;\nif (now - lastP &gt;= PRINT_MS) {\n  lastP = now;\n  Serial.print(F(\"count=\")); Serial.print(c);\n  Serial.print(F(\" target=\")); Serial.print(target);\n  Serial.print(F(\" err=\")); Serial.print(err);\n  Serial.print(F(\" state=\"));\n  switch (st) {\n    case IDLE: Serial.println(F(\"IDLE\")); break;\n    case COARSE_FAST: Serial.println(F(\"COARSE_FAST\")); break;\n    case COARSE_SLOW: Serial.println(F(\"COARSE_SLOW\")); break;\n    case NUDGE_OFF: Serial.println(F(\"NUDGE_OFF\")); break;\n    case NUDGE_ON: Serial.println(F(\"NUDGE_ON\")); break;\n  }\n}\n</code></pre> <p>} }</p>","text":""},{"location":"notes/arduino/projet/thoughts/","title":"Thoughts","text":"<p>\u7f16\u7801\u5668\u8ba1\u6570\u5e76\u975e\u7531\u8f6f\u4ef6\u5b9a\u4e49\uff0c\u800c\u662f\u7531\u7f16\u7801\u5668\u786c\u4ef6\u7ed3\u6784\u53ca\u5176\u8f93\u51fa\u8109\u51b2\u6570\u51b3\u5b9a\u3002\u7a0b\u5e8f\u901a\u8fc7 Encoder \u5e93\u5bf9 A/B \u76f8\u4fe1\u53f7\u8fdb\u884c\u89e3\u7801\u5e76\u7d2f\u79ef\u8ba1\u6570\u3002\u7ecf\u5b9e\u9a8c\u6d4b\u5f97\uff0c\u624b\u52a8\u8f6c\u52a8\u9a71\u52a8\u8f6e\u4e00\u5708\uff0c\u7f16\u7801\u5668\u8ba1\u6570\u53d8\u5316\u4e3a 12\uff0c\u56e0\u6b64\u8be5\u6570\u503c\u88ab\u7528\u4e8e\u540e\u7eed\u89d2\u5ea6\u6362\u7b97\u4e0e\u63a7\u5236\u903b\u8f91\u3002 void loop() {   Serial.println(enc.read()); } \u56e0\u6b64\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bfb\u53d6\u7f16\u7801\u5668\u7684\u8ba1\u6570\u503c\u6765\u786e\u5b9a\u9a71\u52a8\u8f6e\u7684\u65cb\u8f6c\u89d2\u5ea6\u548c\u4f4d\u7f6e\uff0c\u4ece\u800c\u5b9e\u73b0\u7cbe\u786e\u7684\u8fd0\u52a8\u63a7\u5236\u3002</p> <p>\u9996\u5148\u8bfb\u53d6\u6e29\u5ea6\u6570\u636e \u5c06\u6e29\u5ea6\u6570\u636e\u7ebf\u6027\u8f6c\u5316\u4e3a\u5f27\u5ea6</p>"},{"location":"notes/arduino/projet/thoughts/#i2c","title":"\u6e29\u5ea6\u8bfb\u53d6\u9a8c\u8bc1\uff1aI2C \u80fd\u7a33\u5b9a\u8bfb\u53d6\u6e29\u5ea6\u503c","text":""},{"location":"notes/arduino/projet/thoughts/#count12","title":"\u7f16\u7801\u5668\u9a8c\u8bc1\uff1a\u786e\u8ba4\u9a71\u52a8\u8f6e\u4e00\u5708 count=12\uff0c\u65b9\u5411\u6b63\u8d1f\u6b63\u786e","text":""},{"location":"notes/arduino/projet/thoughts/#rlr5l5","title":"\u4e3a\u89e3\u51b3\u6821\u51c6\u95ee\u9898\uff0c\u8bbe\u8ba1\u6821\u51c6\u52a8\u4f5c\uff08r/l/r5/l5\uff09","text":"<p>\u5355\u6b65\u52a8\u4f5c\u9a8c\u8bc1\uff08r/l/r5/l5\uff09r\u6307\u4ee4\u662f\u53f3\u8f6c\u4e00\u5708\uff0cl\u6307\u4ee4\u662f\u5de6\u8f6c\u4e00\u5708\uff0c\u6570\u5b57\u8868\u793a\u8f6c\u52a8\u5708\u6570 \u53d1\u73b0PI \u63a7\u5236\u4e0b\uff0c\u63a7\u5236\u96be\u5ea6\u5927\u5bfc\u81f4r/l\u6307\u4ee4\u4e0d\u80fd\u51c6\u786e\u5730\u5230\u8fbe\u76ee\u6807\u4f4d\u7f6e \u5f15\u5165pulse-based integral compensation\u673a\u5236\uff0c\u4ee5\u63d0\u9ad8\u63a7\u5236\u7cbe\u5ea6 \u8bbe\u8ba1nudge\u6a21\u5f0f\uff0c\u5b9e\u73b0\u5fae\u8c03\u529f\u80fd\u3002\u6700\u7ec8\u4fdd\u8bc1\u8f93\u5165r/l \u6307\u4ee4\u540e\uff0c\u8ba1\u6570\u5668\u7684\u8bef\u5dee\u80fd\u63a7\u5236\u5728\u00b11\u4ee5\u5185\u4e14\u5927\u90e8\u5206\u65f6\u5019\u4e3a0 \u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e2a\u601d\u8def\u9700\u8981\u8bbe\u8ba1\u72b6\u6001\u673a M_IDLE, M_COARSE_FAST, M_COARSE_SLOW, M_NUDGE_OFF, M_NUDGE_ON \u6700\u7ec8\u7528P\u63a7\u5236+nudge\u63a7\u5236\u5b9e\u73b0\u4e86\u8f83\u4e3a\u6ee1\u610f\u7684\u6821\u51c6\u6307\u4ee4\u63a7\u5236\u6548\u679c</p> <p>\u8bbe\u8ba1\u601d\u8def 1. \u95ee\u9898\u80cc\u666f\u4e0e\u603b\u4f53\u76ee\u6807</p> <p>\u672c\u9879\u76ee\u65e8\u5728\u8bbe\u8ba1\u5e76\u5b9e\u73b0\u4e00\u79cd\u57fa\u4e8e\u7535\u673a\u4e0e\u7f16\u7801\u5668\u7684\u6307\u9488\u5f0f\u6e29\u5ea6\u663e\u793a\u7cfb\u7edf\u3002\u7cfb\u7edf\u901a\u8fc7\u6e29\u5ea6\u4f20\u611f\u5668\u5b9e\u65f6\u91c7\u96c6\u73af\u5883\u6e29\u5ea6\uff0c\u5e76\u9a71\u52a8\u7535\u673a\u5e26\u52a8\u6307\u9488\u65cb\u8f6c\uff0c\u4f7f\u6307\u9488\u6307\u5411\u4e0e\u5f53\u524d\u6e29\u5ea6\u5bf9\u5e94\u7684\u523b\u5ea6\u4f4d\u7f6e\u3002</p> <p>\u7531\u4e8e\u6240\u91c7\u7528\u7684\u7535\u673a\u4e0e\u4f20\u52a8\u673a\u6784\u4e0d\u5b58\u5728\u7269\u7406\u4e0a\u7684\u7edd\u5bf9\u96f6\u4f4d\uff0c\u540c\u65f6\u7cfb\u7edf\u5b58\u5728\u9759\u6469\u64e6\u3001\u9f7f\u9699\u548c\u8d1f\u8f7d\u4e0d\u786e\u5b9a\u6027\u7b49\u975e\u7406\u60f3\u56e0\u7d20\uff0c\u56e0\u6b64\u5fc5\u987b\u91c7\u7528\u95ed\u73af\u63a7\u5236\u7ed3\u6784\uff0c\u5e76\u8bbe\u8ba1\u53ef\u9760\u7684\u4eba\u5de5\u6821\u51c6\u673a\u5236\uff0c\u4ee5\u4fdd\u8bc1\u7cfb\u7edf\u5728\u957f\u671f\u8fd0\u884c\u4e2d\u7684\u51c6\u786e\u6027\u548c\u7a33\u5b9a\u6027\u3002</p> <ol> <li>\u7cfb\u7edf\u529f\u80fd\u62c6\u5206\u4e0e\u603b\u4f53\u67b6\u6784</li> </ol> <p>\u6839\u636e\u529f\u80fd\u9700\u6c42\uff0c\u5c06\u7cfb\u7edf\u5212\u5206\u4e3a\u4ee5\u4e0b\u4e24\u4e2a\u5de5\u4f5c\u5c42\u6b21\uff1a</p> <p>\u76ee\u6807\u751f\u6210\u5c42</p> <p>\u6839\u636e\u6e29\u5ea6\u4f20\u611f\u5668\u8f93\u51fa\u751f\u6210\u671f\u671b\u6307\u9488\u89d2\u5ea6</p> <p>\u6839\u636e\u4eba\u5de5\u6821\u51c6\u6307\u4ee4\uff08r / l / r5 / l5\uff09\u751f\u6210\u76f8\u5bf9\u4f4d\u79fb\u76ee\u6807</p> <p>\u4f4d\u7f6e\u63a7\u5236\u5c42</p> <p>\u4ee5\u7f16\u7801\u5668\u8ba1\u6570\uff08count\uff09\u4f5c\u4e3a\u552f\u4e00\u53cd\u9988\u91cf</p> <p>\u901a\u8fc7\u95ed\u73af\u63a7\u5236\u9a71\u52a8\u7535\u673a\uff0c\u4f7f\u5b9e\u9645\u4f4d\u7f6e\u903c\u8fd1\u671f\u671b\u4f4d\u7f6e</p> <p>\u8be5\u7ed3\u6784\u4f7f\u5f97\u6821\u51c6\u52a8\u4f5c\u4e0e\u6e29\u5ea6\u8ddf\u968f\u52a8\u4f5c\u53ef\u4ee5\u5171\u4eab\u540c\u4e00\u5957\u4f4d\u7f6e\u63a7\u5236\u5668\uff0c\u4ec5\u5728\u76ee\u6807\u751f\u6210\u65b9\u5f0f\u4e0a\u6709\u6240\u533a\u522b\u3002</p> <ol> <li>\u5173\u952e\u9a8c\u8bc1\u4e0e\u95ee\u9898\u53d1\u73b0\u8fc7\u7a0b 3.1 \u6e29\u5ea6\u8bfb\u53d6\u9a8c\u8bc1</li> </ol> <p>\u9996\u5148\u5bf9\u6e29\u5ea6\u4f20\u611f\u5668\u8fdb\u884c\u5355\u72ec\u9a8c\u8bc1\uff0c\u786e\u8ba4 Arduino \u80fd\u591f\u901a\u8fc7 I\u00b2C \u603b\u7ebf\u7a33\u5b9a\u8bfb\u53d6\u6e29\u5ea6\u6570\u636e\uff0c\u5e76\u6b63\u786e\u89e3\u6790\u4e3a\u6444\u6c0f\u5ea6\u6570\u503c\uff0c\u4e3a\u540e\u7eed\u89d2\u5ea6\u6620\u5c04\u63d0\u4f9b\u53ef\u9760\u8f93\u5165\u3002</p> <p>3.2 \u7f16\u7801\u5668\u9a8c\u8bc1</p> <p>\u5728\u673a\u68b0\u7cfb\u7edf\u4e2d\uff0c\u7f16\u7801\u5668\u5b89\u88c5\u4e8e\u9a71\u52a8\u8f6e\u8f74\u4e0a\u3002\u901a\u8fc7\u5b9e\u9a8c\u6d4b\u5f97\uff1a\u9a71\u52a8\u8f6e\u8f6c\u52a8\u4e00\u6574\u5708\u65f6\uff0c\u7f16\u7801\u5668\u8ba1\u6570\u53d8\u5316\u4e3a 12\u3002 \u540c\u65f6\u786e\u8ba4\u7f16\u7801\u5668\u6b63\u8d1f\u65b9\u5411\u4e0e\u7269\u7406\u8f6c\u52a8\u65b9\u5411\u4e00\u81f4\uff0c\u4e3a\u540e\u7eed\u4f4d\u7f6e\u63a7\u5236\u5960\u5b9a\u57fa\u7840\u3002</p> <ol> <li>\u6821\u51c6\u95ee\u9898\u4e0e\u5355\u6b65\u52a8\u4f5c\u8bbe\u8ba1</li> </ol> <p>\u7531\u4e8e\u7cfb\u7edf\u4e0d\u5b58\u5728\u7edd\u5bf9\u96f6\u4f4d\uff0c\u5fc5\u987b\u5f15\u5165\u4eba\u5de5\u6821\u51c6\u673a\u5236\u3002\u4e3a\u6b64\u8bbe\u8ba1\u4e86\u4ee5\u4e0b\u6821\u51c6\u6307\u4ee4\uff1a</p> <p>r / l\uff1a\u9a71\u52a8\u8f6e\u6b63\u5411 / \u53cd\u5411\u8f6c\u52a8 1 \u5708\uff08\u00b112 count\uff09</p> <p>r5 / l5\uff1a\u9a71\u52a8\u8f6e\u6b63\u5411 / \u53cd\u5411\u8f6c\u52a8 5 \u5708\uff08\u00b160 count\uff09</p> <p>\u8fd9\u4e9b\u6307\u4ee4\u5141\u8bb8\u7528\u6237\u5728 STOP \u6a21\u5f0f\u4e0b\u624b\u52a8\u8c03\u6574\u6307\u9488\u4f4d\u7f6e\uff0c\u5e76\u901a\u8fc7 sync \u6307\u4ee4\u5c06\u5f53\u524d\u6307\u9488\u4f4d\u7f6e\u5b9a\u4e49\u4e3a\u6b63\u786e\u53c2\u8003\u4f4d\u7f6e\uff0c\u4ece\u800c\u5efa\u7acb\u8f6f\u4ef6\u5c42\u9762\u7684\u89d2\u5ea6\u504f\u79fb\u91cf\u3002</p> <ol> <li>\u63a7\u5236\u7b56\u7565\u9009\u62e9\u4e0e\u6539\u8fdb 5.1 \u4f20\u7edf PI \u63a7\u5236\u7684\u5c40\u9650\u6027</li> </ol> <p>\u5728\u521d\u671f\u5c1d\u8bd5\u4e2d\uff0c\u66fe\u8003\u8651\u91c7\u7528 PI \u63a7\u5236\u4ee5\u6d88\u9664\u7a33\u6001\u8bef\u5dee\u3002\u7136\u800c\u5728\u5b9e\u9645\u8c03\u8bd5\u4e2d\u53d1\u73b0\uff1a</p> <p>\u7f16\u7801\u5668\u5206\u8fa8\u7387\u8f83\u4f4e\uff0c\u53cd\u9988\u4fe1\u53f7\u4e3a\u79bb\u6563\u8ba1\u6570</p> <p>\u7cfb\u7edf\u5b58\u5728\u660e\u663e\u9759\u6469\u64e6\u4e0e\u9f7f\u9699</p> <p>PWM \u5b58\u5728\u201c\u80fd\u52a8\u95e8\u69db\u201d\uff0c\u79ef\u5206\u9879\u6613\u7d2f\u79ef\u5e76\u7a81\u7136\u91ca\u653e</p> <p>\u4e0a\u8ff0\u56e0\u7d20\u5bfc\u81f4 PI \u63a7\u5236\u5728\u672c\u7cfb\u7edf\u4e2d\u96be\u4ee5\u7a33\u5b9a\u6574\u5b9a\uff0c\u5bb9\u6613\u5f15\u53d1\u632f\u8361\u548c\u8fc7\u51b2\uff0c\u5c24\u5176\u5728 r/l \u7b49\u5355\u6b65\u52a8\u4f5c\u4e2d\u96be\u4ee5\u7cbe\u786e\u5230\u4f4d\u3002</p> <p>5.2 \u5f15\u5165\u8109\u51b2\u5f0f\u79ef\u5206\u8865\u507f\u601d\u60f3\uff08Nudge\uff09</p> <p>\u4e3a\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\uff0c\u672c\u9879\u76ee\u653e\u5f03\u8fde\u7eed\u79ef\u5206\u63a7\u5236\uff0c\u8f6c\u800c\u91c7\u7528\u8109\u51b2\u5f0f\u79ef\u5206\u8865\u507f\uff08pulse-based integral compensation\uff09\u7684\u5de5\u7a0b\u7b56\u7565\uff1a</p> <p>\u5728\u8bef\u5dee\u8f83\u5927\u65f6\uff0c\u4f7f\u7528\u6bd4\u4f8b\u63a7\u5236\uff08P control\uff09\u5feb\u901f\u903c\u8fd1\u76ee\u6807</p> <p>\u5728\u8bef\u5dee\u8f83\u5c0f\u65f6\uff0c\u91c7\u7528\u77ed\u65f6 PWM \u8109\u51b2\u63a8\u8fdb\uff08nudge\uff09</p> <p>\u6bcf\u6b21\u8109\u51b2\u540e\u5f3a\u5236\u65ad\u7535\u7b49\u5f85\u7cfb\u7edf\u505c\u7a33\uff0c\u518d\u91cd\u65b0\u8bc4\u4f30\u8bef\u5dee</p> <p>\u8be5\u65b9\u6cd5\u5728\u5de5\u7a0b\u6548\u679c\u4e0a\u7b49\u6548\u4e8e\u79ef\u5206\u4f5c\u7528\uff0c\u80fd\u591f\u9010\u6b65\u6d88\u9664\u7a33\u6001\u8bef\u5dee\uff0c\u540c\u65f6\u907f\u514d\u79ef\u5206\u9971\u548c\u548c\u6301\u7eed\u632f\u8361\u3002</p> <ol> <li>\u57fa\u4e8e\u72b6\u6001\u673a\u7684\u8fd0\u52a8\u63a7\u5236\u8bbe\u8ba1</li> </ol> <p>\u4e3a\u5b9e\u73b0\u4e0a\u8ff0\u63a7\u5236\u7b56\u7565\uff0c\u7cfb\u7edf\u8bbe\u8ba1\u4e86\u4e00\u5957\u6709\u9650\u72b6\u6001\u673a\uff0c\u5305\u542b\u4ee5\u4e0b\u72b6\u6001\uff1a</p> <p>M_IDLE\uff1a\u7a7a\u95f2\u72b6\u6001\uff0c\u7535\u673a\u5173\u95ed</p> <p>M_COARSE_FAST\uff1a\u7c97\u8c03\u5feb\u901f\u903c\u8fd1\u72b6\u6001</p> <p>M_COARSE_SLOW\uff1a\u7c97\u8c03\u6162\u901f\u903c\u8fd1\u72b6\u6001</p> <p>M_NUDGE_OFF\uff1a\u65ad\u7535\u7b49\u5f85\u505c\u7a33\u72b6\u6001</p> <p>M_NUDGE_ON\uff1a\u8109\u51b2\u5fae\u8c03\u63a8\u8fdb\u72b6\u6001</p> <p>\u72b6\u6001\u673a\u6839\u636e\u5f53\u524d\u8bef\u5dee\u5927\u5c0f\u5728\u4e0d\u540c\u72b6\u6001\u4e4b\u95f4\u5207\u6362\uff0c\u5b9e\u73b0\u4ece\u5feb\u901f\u54cd\u5e94\u5230\u9ad8\u7cbe\u5ea6\u5b9a\u4f4d\u7684\u5e73\u6ed1\u8fc7\u6e21\u3002</p> <ol> <li>\u63a7\u5236\u6548\u679c\u4e0e\u7edf\u4e00\u6027</li> </ol> <p>\u901a\u8fc7\u4e0a\u8ff0\u8bbe\u8ba1\uff0c\u7cfb\u7edf\u6700\u7ec8\u5b9e\u73b0\uff1a</p> <p>r / l / r5 / l5 \u6821\u51c6\u6307\u4ee4\u540e\uff0c\u8ba1\u6570\u8bef\u5dee\u7a33\u5b9a\u63a7\u5236\u5728 \u00b11 \u4ee5\u5185\uff0c\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u4e3a 0</p> <p>\u540c\u4e00\u5957\u72b6\u6001\u673a\u4e0e\u63a7\u5236\u903b\u8f91\u540c\u65f6\u9002\u7528\u4e8e\uff1a</p> <p>\u4eba\u5de5\u6821\u51c6\uff08\u76f8\u5bf9\u4f4d\u79fb\u63a7\u5236\uff09</p> <p>\u6e29\u5ea6\u8ddf\u968f\uff08\u7edd\u5bf9\u4f4d\u7f6e\u63a7\u5236\uff09</p> <p>\u4e24\u79cd\u6a21\u5f0f\u4ec5\u5728\u76ee\u6807\u751f\u6210\u65b9\u5f0f\u4e0a\u4e0d\u540c\uff0c\u800c\u5e95\u5c42\u4f4d\u7f6e\u63a7\u5236\u5668\u5b8c\u5168\u7edf\u4e00\uff0c\u4fdd\u8bc1\u4e86\u7cfb\u7edf\u7ed3\u6784\u7684\u7b80\u6d01\u6027\u4e0e\u53ef\u7ef4\u62a4\u6027\u3002</p> <ol> <li>\u5c0f\u7ed3</li> </ol> <p>\u672c\u9879\u76ee\u901a\u8fc7\u5c06\u63a7\u5236\u91cd\u70b9\u7edf\u4e00\u5230\u7f16\u7801\u5668\u8ba1\u6570\u57df\uff0c\u5e76\u91c7\u7528\u57fa\u4e8e\u72b6\u6001\u673a\u7684\u6bd4\u4f8b\u63a7\u5236\u4e0e\u8109\u51b2\u5fae\u8c03\u76f8\u7ed3\u5408\u7684\u65b9\u6cd5\uff0c\u5728\u4f4e\u5206\u8fa8\u7387\u7f16\u7801\u5668\u548c\u5f3a\u975e\u7ebf\u6027\u673a\u68b0\u6761\u4ef6\u4e0b\uff0c\u5b9e\u73b0\u4e86\u7a33\u5b9a\u3001\u7cbe\u786e\u4e14\u53ef\u6821\u51c6\u7684\u6307\u9488\u5f0f\u6e29\u5ea6\u663e\u793a\u7cfb\u7edf\u3002</p>"},{"location":"notes/linux/basic/","title":"mkdir -p ~/catkin_ws/src","text":"<p>mkdir = make directory\uff08\u521b\u5efa\u6587\u4ef6\u5939\uff09 -p = parents\uff08\u7236\u76ee\u5f55\uff09 \u542b\u4e49\u662f\uff1a \u5982\u679c\u4e2d\u95f4\u7684\u76ee\u5f55\u4e0d\u5b58\u5728\uff0c\u5c31\u4e00\u8d77\u5e2e\u6211\u521b\u5efa \u6ca1\u6709 -p mkdir catkin_ws/src \u5982\u679c catkin_ws \u4e0d\u5b58\u5728\uff0c\u4f1a\u76f4\u63a5\u62a5\u9519 ~ = \u4f60\u7684 \u5bb6\u76ee\u5f55\u7b49\u4ef7\u4e8e\uff1a/home/\u4f60\u7684\u7528\u6237\u540dmkdir -p ~/catkin_ws/src\u7b49\u4ef7\u4e8e\uff1a mkdir -p /home/\u4f60\u7684\u7528\u6237\u540d/catkin_ws/src</p>"},{"location":"notes/linux/basic/#nano-testcpp","title":"nano test.cpp","text":"<p>\u7528\u6765\u6253\u5f00\u7f16\u8f91\u6587\u672c\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u5219\u521b\u5efa\u65b0\u6587\u4ef6</p>"},{"location":"notes/linux/basic/#ls","title":"ls\u5217\u51fa\u5f53\u524d\u76ee\u5f55\u91cc\u7684\u6587\u4ef6\u548c\u6587\u4ef6\u5939","text":""},{"location":"notes/linux/basic/#_1","title":"mkdir -p ~/catkin_ws/src","text":"\u7b26\u53f7 \u542b\u4e49 . \u5f53\u524d\u76ee\u5f55 .. \u4e0a\u4e00\u7ea7\u76ee\u5f55\uff08\u7236\u76ee\u5f55\uff09"},{"location":"notes/ros/basic/","title":"catkin \u662f\u4ec0\u4e48\uff1f","text":"<p>catkin \u662f ROS \u7684\u6784\u5efa\u7cfb\u7edf  \u7528\u6765\u751f\u6210\uff1a \u53ef\u6267\u884c\u7a0b\u5e8f \u5e93 \u63a5\u53e3\uff08message / service\uff09</p>"},{"location":"notes/ros/basic/#workspace","title":"workspace \u662f\u4ec0\u4e48\uff1f","text":"<p>\u4e00\u4e2a workspace = \u4e00\u4e2a ROS \u5de5\u4f5c\u533a \u91cc\u9762\u653e\u7684\u662f\u4e00\u6574\u5957 \u76f8\u5173 ROS \u4ee3\u7801</p>"},{"location":"notes/ros/basic/#workspace_1","title":"workspace \u7684\u6807\u51c6\u7ed3\u6784","text":"<p>catkin_ws/ \u251c\u2500\u2500 src/        \u2190 \u4f60\u5199\u4ee3\u7801\u7684\u5730\u65b9\uff08\u6700\u91cd\u8981\uff09 \u2502   \u251c\u2500\u2500 CMakeLists.txt \u2502   \u251c\u2500\u2500 package_1/ \u2502   \u251c\u2500\u2500 package_2/ \u2502 \u251c\u2500\u2500 build/      \u2190 \u7f16\u8bd1\u4e2d\u95f4\u6587\u4ef6\uff08\u4e0d\u7528\u78b0\uff09 \u251c\u2500\u2500 devel/      \u2190 \u751f\u6210\u7684\u53ef\u6267\u884c\u7a0b\u5e8f\u3001\u73af\u5883 \u2514\u2500\u2500 install/   \u2190 \u53ef\u9009\uff0c\u5b89\u88c5\u7a7a\u95f4</p>"},{"location":"notes/ros/basic/#ros-package","title":"\u4ec0\u4e48\u662f ROS package\uff1f","text":"<p>package \u662f ROS \u4e2d\u6700\u5c0f\u7684\u6784\u5efa\u5355\u4f4d \u4e00\u4e2a package = \u4e00\u4e2a ROS \u5c0f\u9879\u76ee</p>"},{"location":"notes/ros/basic/#package","title":"\u4e00\u4e2a package \u91cc\u4e00\u822c\u6709\u4ec0\u4e48\uff1f","text":"<p>my_pkg/ \u251c\u2500\u2500 src/        \u2190 C++ \u6e90\u6587\u4ef6 \u251c\u2500\u2500 include/    \u2190 \u5934\u6587\u4ef6 \u251c\u2500\u2500 msg/        \u2190 \u81ea\u5b9a\u4e49\u6d88\u606f\uff08\u4ee5\u540e\uff09 \u251c\u2500\u2500 srv/        \u2190 \u81ea\u5b9a\u4e49\u670d\u52a1\uff08\u4ee5\u540e\uff09 \u251c\u2500\u2500 launch/     \u2190 \u542f\u52a8\u6587\u4ef6\uff08\u4ee5\u540e\uff09 \u251c\u2500\u2500 package.xml \u2190 \u8eab\u4efd\u8bc1 + \u4f9d\u8d56\u58f0\u660e(\u5305\u540d\u3001\u7248\u672c\u3001\u4f5c\u8005\u3001\u8bb8\u53ef\u8bc1\u3001\u4f9d\u8d56\u7b49) \u2514\u2500\u2500 CMakeLists.txt \u2190 \u7f16\u8bd1\u8bf4\u660e\u4e66</p>"},{"location":"notes/ros/basic/#package_1","title":"\u521b\u5efa package","text":"<p>\u521b\u5efa\u4e00\u4e2a\u53eb first_pkg \u7684\u5305 \u5b83\u4f9d\u8d56\uff1a <p>roscpp\uff08C++\uff09</p> <p>rospy\uff08Python\uff09</p> <p>std_msgs\uff08\u6807\u51c6\u6d88\u606f\uff09</p>"},{"location":"notes/ros/basic/#_1","title":"catkin \u662f\u4ec0\u4e48\uff1f","text":"\u540d\u79f0 \u4e00\u53e5\u8bdd\u7406\u89e3 <code>ros::init</code> \u542f\u52a8 ROS \u8282\u70b9 <code>ros::NodeHandle</code> \u8282\u70b9\u4e0e ROS \u901a\u4fe1\u7684\u5165\u53e3 <code>ros::Rate</code> \u63a7\u5236\u5faa\u73af\u9891\u7387 <code>ROS_INFO</code> ROS \u98ce\u683c\u65e5\u5fd7\u8f93\u51fa <code>ros::ok</code> \u5224\u65ad\u8282\u70b9\u662f\u5426\u8be5\u7ee7\u7eed\u8fd0\u884c NodeHandle \u662f\u8bbf\u95ee topic/service/param \u7684\u5165\u53e3 \u5b83\u5fc5\u987b\u5728 ros::init() \u4e4b\u540e\u521b\u5efa"},{"location":"notes/ros/basic/#source-catkin_wsdevelsetupbash","title":"source ~/catkin_ws/devel/setup.bash","text":"<p>\u8ba9\u5f53\u524d\u7ec8\u7aef\u73af\u5883\u8ba4\u8bc6\u65b0\u5efa\u7684 workspace</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/","title":"\u5d4c\u5165\u5f0f\u5b9e\u4e60\u9762\u8bd5 50 \u9898\uff5c\u76f4\u63a5\u53ef\u80cc\u7248\uff08\u542b\u8ffd\u95ee\uff09","text":"<p>\u4f7f\u7528\u65b9\u6cd5\uff1a\u6bcf\u9898\u5148\u80cc\u201c\u4e3b\u56de\u7b54\u201d\uff0830\u201360 \u79d2\uff09\uff0c\u518d\u80cc1\u20132 \u6761\u8ffd\u95ee\u5373\u53ef\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#a-15","title":"A. \u5b58\u50a8 / \u542f\u52a8 / \u88f8\u673a\uff081\u20135\uff09","text":""},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#1-flash-memory","title":"1. \u4ec0\u4e48\u662f Flash Memory\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aFlash Memory\uff08\u95ea\u5b58\uff09\u662f Non-Volatile Memory\uff08\u975e\u6613\u5931\u6027\u5b58\u50a8\u5668\uff09\uff0c\u65ad\u7535\u4e0d\u4e22\u6570\u636e\uff1b\u5d4c\u5165\u5f0f\u4e2d\u5e38\u5b58 Bootloader\u3001\u5e94\u7528\u7a0b\u5e8f\u3001\u53c2\u6570\u3002\u5e38\u89c1 NOR Flash\uff08\u9002\u5408\u4ee3\u7801\u5b58\u50a8\u3001XIP\uff09\u548c NAND Flash\uff08\u5bb9\u91cf\u5927\u3001\u5e38\u7528\u4e8e\u6570\u636e\uff09\u3002 \u8ffd\u95ee\uff1aNOR vs NAND \u600e\u4e48\u9009\uff1f \u8ffd\u95ee\u7b54\uff1a\u9700\u8981\u76f4\u63a5\u6267\u884c\u4ee3\u7801/\u968f\u673a\u8bfb\u591a\u2192NOR\uff1b\u5927\u5bb9\u91cf\u5b58\u50a8/\u987a\u5e8f\u8bfb\u5199\u2192NAND\uff08\u901a\u5e38\u914d\u6587\u4ef6\u7cfb\u7edf/\u574f\u5757\u7ba1\u7406\uff09\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#2-bootloader","title":"2. \u4ec0\u4e48\u662f Bootloader\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aBootloader \u662f\u4e0a\u7535\u540e\u6267\u884c\u7684\u7b2c\u4e00\u6bb5\u7a0b\u5e8f\uff0c\u8d1f\u8d23\u786c\u4ef6\u521d\u59cb\u5316\u3001\u9009\u62e9/\u52a0\u8f7d\u56fa\u4ef6\u5e76\u8df3\u8f6c\u5230\u5e94\u7528\uff1b\u5e38\u5e26\u5347\u7ea7\u529f\u80fd\uff08\u4e32\u53e3/USB/CAN/\u4ee5\u592a\u7f51/OTA\uff09\u3002 \u8ffd\u95ee\uff1aBootloader \u5347\u7ea7\u5982\u4f55\u9632\u6b62\u53d8\u7816\uff1f \u8ffd\u95ee\u7b54\uff1a\u5e38\u7528\u53cc\u5206\u533a A/B\u3001\u5347\u7ea7\u5305\u6821\u9a8c\uff08CRC/\u7b7e\u540d\uff09\u3001\u65ad\u70b9\u7eed\u4f20/\u56de\u6eda\u3001\u5199\u5b8c\u518d\u5207\u6362\u542f\u52a8\u6807\u5fd7\u4f4d\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#3","title":"3. \u4ec0\u4e48\u662f\u88f8\u673a\u7f16\u7a0b\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aBare Metal\uff08\u88f8\u673a\uff09\u662f\u65e0\u64cd\u4f5c\u7cfb\u7edf\uff0c\u7a0b\u5e8f\u76f4\u63a5\u8dd1\u5728\u786c\u4ef6\u4e0a\uff1b\u5178\u578b\u7ed3\u6784\uff1a\u4e3b\u5faa\u73af + \u4e2d\u65ad\uff1b\u4f18\u70b9\u7b80\u5355\u3001\u8d44\u6e90\u5360\u7528\u5c0f\u3001\u5b9e\u65f6\u6027\u597d\u3002 \u8ffd\u95ee\uff1a\u88f8\u673a\u5982\u4f55\u7ec4\u7ec7\u590d\u6742\u903b\u8f91\uff1f \u8ffd\u95ee\u7b54\uff1a\u7528\u6709\u9650\u72b6\u6001\u673a\uff08FSM\uff09\u3001\u4e8b\u4ef6\u961f\u5217\u3001\u5b9a\u65f6\u5668\u9a71\u52a8\u4efb\u52a1\u5207\u7247\uff0c\u628a\u8017\u65f6\u5de5\u4f5c\u653e\u4e3b\u5faa\u73af\uff0cISR \u53ea\u505a\u201c\u7f6e\u6807\u5fd7/\u642c\u6570\u636e\u201d\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#4-gpio-timer-pwm","title":"4. GPIO / Timer / PWM \u5206\u522b\u505a\u4ec0\u4e48\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aGPIO\uff08General-Purpose Input/Output\uff09\u505a\u901a\u7528\u8f93\u5165\u8f93\u51fa\uff1bTimer \u505a\u8ba1\u6570/\u5b9a\u65f6/\u6355\u83b7\u6bd4\u8f83/\u89e6\u53d1\u4e2d\u65ad\uff1bPWM\uff08Pulse Width Modulation\uff09\u901a\u8fc7\u5360\u7a7a\u6bd4\u8f93\u51fa\u7b49\u6548\u6a21\u62df\u91cf\uff0c\u7528\u4e8e\u7535\u673a\u8c03\u901f\u3001\u706f\u5149\u8c03\u5149\u7b49\u3002 \u8ffd\u95ee\uff1aPWM \u9891\u7387\u548c\u5206\u8fa8\u7387\u600e\u4e48\u6743\u8861\uff1f \u8ffd\u95ee\u7b54\uff1a\u9891\u7387\u8d8a\u9ad8\u53ef\u542c\u566a\u66f4\u5c0f\u4f46\u5206\u8fa8\u7387\u53ef\u80fd\u4e0b\u964d\uff08\u53d7\u5b9a\u65f6\u5668\u65f6\u949f\u4e0e ARR/PSC \u9650\u5236\uff09\uff1b\u6309\u8d1f\u8f7d\u7279\u6027\u9009\u9891\u7387\uff0c\u518d\u5c3d\u91cf\u63d0\u9ad8\u8ba1\u6570\u8303\u56f4\u63d0\u5347\u5206\u8fa8\u7387\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#5-nvic","title":"5. \u4ec0\u4e48\u662f\u4e2d\u65ad\u63a7\u5236\u5668\uff08NVIC\uff09\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aARM Cortex-M \u5e38\u7528 NVIC\uff08Nested Vectored Interrupt Controller\uff09\uff0c\u8d1f\u8d23\u4e2d\u65ad\u4f7f\u80fd\u3001\u4f18\u5148\u7ea7\u3001\u5411\u91cf\u8df3\u8f6c\u4e0e\u4e2d\u65ad\u5d4c\u5957\u3002 \u8ffd\u95ee\uff1a\u4e2d\u65ad\u91cc\u80fd\u505a\u590d\u6742\u8ba1\u7b97\u5417\uff1f \u8ffd\u95ee\u7b54\uff1a\u4e0d\u5efa\u8bae\uff1bISR \u8981\u77ed\u5c0f\uff0c\u505a\u201c\u8bfb\u5bc4\u5b58\u5668/\u6e05\u6807\u5fd7/\u628a\u6570\u636e\u653e\u7f13\u51b2/\u7f6e\u4e8b\u4ef6\u201d\uff0c\u590d\u6742\u5904\u7406\u653e\u4e3b\u5faa\u73af\u6216\u4efb\u52a1\u91cc\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#b-612","title":"B. \u901a\u4fe1\u534f\u8bae\uff086\u201312\uff09","text":""},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#6-i2c","title":"6. \u4ec0\u4e48\u662f I2C\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aI2C\uff08Inter-Integrated Circuit\uff09\u662f\u4e24\u7ebf\u540c\u6b65\u4e32\u884c\u603b\u7ebf\uff1aSCL\uff08Serial Clock Line\uff09+ SDA\uff08Serial Data Line\uff09\uff0c\u4e3b\u4ece\u67b6\u6784\uff0c\u901a\u8fc7\u5730\u5740\u533a\u5206\u8bbe\u5907\uff1b\u5e38\u7528\u901f\u7387 100 kHz\u3001400 kHz\u3002 \u8ffd\u95ee\uff1aI2C \u4e3a\u4ec0\u4e48\u8981\u4e0a\u62c9\u7535\u963b\uff1f \u8ffd\u95ee\u7b54\uff1aI2C \u662f\u5f00\u6f0f/\u5f00\u96c6\u7535\u6781\u8f93\u51fa\uff0c\u9700\u8981\u5916\u90e8\u4e0a\u62c9\u5f62\u6210\u9ad8\u7535\u5e73\uff0c\u5e76\u652f\u6301\u591a\u8bbe\u5907\u201c\u7ebf\u4e0e\u201d\u5171\u4eab\u3002 \u8ffd\u95ee\u4ec0\u4e48\u662f\u540c\u6b65\u548c\u5f02\u6b65\uff1f \u8ffd\u95ee\u7b54\u540c\u6b65\uff08Synchronous\uff09\u662f\u6307\u8c03\u7528\u65b9\u5728\u53d1\u8d77\u64cd\u4f5c\u540e\uff0c\u5fc5\u987b\u7b49\u5f85\u64cd\u4f5c\u5b8c\u6210\u5e76\u5f97\u5230\u7ed3\u679c\uff0c\u671f\u95f4\u4f1a\u88ab\u963b\u585e\uff1b \u5f02\u6b65\uff08Asynchronous\uff09\u662f\u6307\u8c03\u7528\u65b9\u5728\u53d1\u8d77\u64cd\u4f5c\u540e\uff0c\u4e0d\u9700\u8981\u7b49\u5f85\u7ed3\u679c\uff0c\u64cd\u4f5c\u5728\u540e\u53f0\u6267\u884c\uff0c\u5b8c\u6210\u540e\u901a\u8fc7\u56de\u8c03\u3001\u4e8b\u4ef6\u6216\u901a\u77e5\u7684\u65b9\u5f0f\u544a\u77e5\u7ed3\u679c\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#7-usart-uart","title":"7. USART / UART \u662f\u4ec0\u4e48\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aUSART\uff08Universal Synchronous/Asynchronous Receiver Transmitter\uff09\u53ef\u540c\u6b65\u4e5f\u53ef\u5f02\u6b65\uff1bUART\uff08Universal Asynchronous Receiver/Transmitter\uff09\u4e13\u6307\u5f02\u6b65\u3002\u5e38\u7528\u4e8e\u70b9\u5bf9\u70b9\u4e32\u53e3\u901a\u4fe1\uff0c\u5178\u578b\u6ce2\u7279\u7387 9600/115200\u3002 \u8ffd\u95ee\uff1a\u5982\u4f55\u505a\u4e32\u53e3\u6536\u5305\u4e0d\u4e22\u6570\u636e\uff1f \u8ffd\u95ee\u7b54\uff1a\u7528\u4e2d\u65ad\u6216 DMA + \u73af\u5f62\u7f13\u51b2\u533a\uff0c\u6309\u5e27\u5934/\u957f\u5ea6/\u6821\u9a8c\u89e3\u6790\uff1b\u907f\u514d ISR \u91cc\u9010\u5b57\u8282\u505a\u91cd\u903b\u8f91\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#8-spi","title":"8. \u4ec0\u4e48\u662f SPI\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aSPI\uff08Serial Peripheral Interface\uff09\u5168\u53cc\u5de5\u540c\u6b65\u901a\u4fe1\uff0c\u5e38\u89c1\u7ebf\uff1aSCLK/MOSI/MISO/CS\uff1b\u901f\u5ea6\u9ad8\u3001\u534f\u8bae\u7b80\u5355\uff0c\u9002\u5408\u9ad8\u901f\u4f20\u611f\u5668/Flash\u3002 \u8ffd\u95ee\uff1aSPI \u4e3a\u4ec0\u4e48\u8981\u7247\u9009 CS\uff1f \u8ffd\u95ee\u7b54\uff1a\u603b\u7ebf\u4e0a\u53ef\u6302\u591a\u4e2a\u4ece\u8bbe\u5907\uff0cCS \u7528\u4e8e\u9009\u62e9\u76ee\u6807\u4ece\u673a\u5e76\u754c\u5b9a\u4e00\u6b21\u4f20\u8f93\u7684\u8fb9\u754c\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#9-can","title":"9. \u4ec0\u4e48\u662f CAN\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aCAN\uff08Controller Area Network\uff09\u662f\u591a\u4e3b\u3001\u5dee\u5206\u3001\u9ad8\u53ef\u9760\u603b\u7ebf\uff0c\u901a\u8fc7 Message ID \u4ef2\u88c1\uff0c\u6297\u5e72\u6270\u5f3a\uff0c\u5e7f\u6cdb\u7528\u4e8e\u6c7d\u8f66/\u5de5\u4e1a\u3002 \u8ffd\u95ee\uff1aCAN \u6807\u51c6\u5e27\u548c\u6269\u5c55\u5e27\u533a\u522b\uff1f \u8ffd\u95ee\u7b54\uff1a\u4e3b\u8981\u662f ID \u4f4d\u5bbd\uff1a\u6807\u51c6\u5e27 11 \u4f4d ID\uff0c\u6269\u5c55\u5e27 29 \u4f4d ID\uff1bID \u4e5f\u53c2\u4e0e\u4f18\u5148\u7ea7\u4ef2\u88c1\uff08\u6570\u503c\u8d8a\u5c0f\u4f18\u5148\u7ea7\u8d8a\u9ad8\uff09\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#10-i2s","title":"10. \u4ec0\u4e48\u662f I2S\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aI2S\uff08Inter-IC Sound\uff09\u7528\u4e8e\u97f3\u9891\u6570\u636e\u4f20\u8f93\uff0c\u5e38\u89c1\u4fe1\u53f7\uff1aBCLK/LRCLK/SD\uff1b\u8fde\u63a5\u97f3\u9891 Codec\u3001DAC/ADC\u3002 \u8ffd\u95ee\uff1aI2S \u6570\u636e\u683c\u5f0f\u5e38\u89c1\u6709\u54ea\u4e9b\uff1f \u8ffd\u95ee\u7b54\uff1aPhilips I2S\u3001Left-Justified\u3001Right-Justified\uff1b\u5dee\u5f02\u4e3b\u8981\u5728\u6570\u636e\u5bf9\u9f50\u4e0e\u65f6\u949f\u8fb9\u6cbf\u91c7\u6837\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#11","title":"11. \u4f20\u611f\u5668\u6570\u636e\u683c\u5f0f\u3001\u901f\u7387\u600e\u4e48\u63cf\u8ff0\uff1f","text":"<p>\u4e3b\u56de\u7b54\u6a21\u677f\uff1a\u8bf4\u660e\u201c\u534f\u8bae + \u901f\u7387 + \u5e27\u7ed3\u6784\u201d\uff1a\u4f8b\u5982 I2C 400 kHz\uff1b\u5bc4\u5b58\u5668\u8bfb\u53d6\uff0c\u539f\u59cb\u6570\u636e 16 bit/24 bit\uff0c\u6309\u91cf\u7a0b\u4e0e\u6bd4\u4f8b\u6362\u7b97\uff1b\u82e5\u6709\u6821\u9a8c\u8bf4\u660e CRC/\u5947\u5076\u6821\u9a8c\u3002 \u8ffd\u95ee\uff1a\u5982\u679c\u6570\u636e\u5076\u5c14\u9519\u600e\u4e48\u529e\uff1f \u8ffd\u95ee\u7b54\uff1a\u52a0\u6821\u9a8c\uff08CRC/\u6821\u9a8c\u548c\uff09\u3001\u8d85\u65f6\u91cd\u4f20\u3001\u6ee4\u6ce2/\u53bb\u6bdb\u523a\uff1b\u786c\u4ef6\u4e0a\u68c0\u67e5\u7ebf\u957f\u3001\u4e0a\u62c9\u3001\u7ec8\u7aef\u7535\u963b\u4e0e\u5730\u53c2\u8003\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#12-pwm","title":"12. PWM \u7684\u7528\u9014\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aPWM \u901a\u8fc7\u5360\u7a7a\u6bd4\u63a7\u5236\u7b49\u6548\u529f\u7387/\u7535\u538b\uff0c\u5e38\u7528\u4e8e\u7535\u673a\u3001LED\u3001\u8702\u9e23\u5668\u3001\u8235\u673a\u3002 \u8ffd\u95ee\uff1a\u8235\u673a PWM \u4e3a\u4ec0\u4e48\u662f 50 Hz\uff1f \u8ffd\u95ee\u7b54\uff1a\u4f20\u7edf\u8235\u673a\u63a7\u5236\u8109\u5bbd\uff08\u7ea6 1\u20132 ms\uff09\u6620\u5c04\u89d2\u5ea6\uff0c\u5468\u671f\u901a\u5e38 20 ms\uff0850 Hz\uff09\u662f\u884c\u4e1a\u5e38\u7528\u7ea6\u5b9a\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#c-rtos-1320","title":"C. RTOS / \u5e76\u53d1\uff0813\u201320\uff09","text":""},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#13-rtos","title":"13. \u4ec0\u4e48\u662f RTOS \u8c03\u5ea6\u5668\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aRTOS\uff08Real-Time Operating System\uff09\u8c03\u5ea6\u5668\u6309\u4f18\u5148\u7ea7/\u5c31\u7eea\u72b6\u6001\u9009\u62e9\u4efb\u52a1\u8fd0\u884c\uff0c\u652f\u6301\u62a2\u5360\u4ee5\u6ee1\u8db3\u5b9e\u65f6\u6027\u3002 \u8ffd\u95ee\uff1a\u62a2\u5360\u5f0f vs \u534f\u4f5c\u5f0f\uff1f \u8ffd\u95ee\u7b54\uff1a\u62a2\u5360\u5f0f\u9ad8\u4f18\u5148\u7ea7\u53ef\u968f\u65f6\u6253\u65ad\u4f4e\u4f18\u5148\u7ea7\uff1b\u534f\u4f5c\u5f0f\u9760\u4efb\u52a1\u4e3b\u52a8\u8ba9\u51fa CPU\uff0c\u7b80\u5355\u4f46\u5b9e\u65f6\u6027\u5f31\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#14","title":"14. \u5982\u4f55\u8fdb\u884c\u5b9e\u65f6\u4efb\u52a1\u8c03\u5ea6\u548c\u4f18\u5148\u7ea7\u7ba1\u7406\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u6309\u4e1a\u52a1\u5b9e\u65f6\u6027\u5206\u7ea7\uff1a\u786c\u5b9e\u65f6\u9ad8\u4f18\u5148\u7ea7\uff1b\u7528\u4e92\u65a5\u9501\uff08Mutex\uff09\u4fdd\u62a4\u5171\u4eab\u8d44\u6e90\uff0c\u7528\u4fe1\u53f7\u91cf\uff08Semaphore\uff09/\u6d88\u606f\u961f\u5217\u505a\u540c\u6b65\u4e0e\u901a\u4fe1\uff1b\u907f\u514d\u4f18\u5148\u7ea7\u53cd\u8f6c\u3002 \u8ffd\u95ee\uff1a\u4f18\u5148\u7ea7\u53cd\u8f6c\u600e\u4e48\u89e3\u51b3\uff1f \u8ffd\u95ee\u7b54\uff1a\u4f18\u5148\u7ea7\u7ee7\u627f\uff08Priority Inheritance\uff09\u6216\u4f18\u5148\u7ea7\u5929\u82b1\u677f\uff08Priority Ceiling\uff09\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#15","title":"15. \u4ec0\u4e48\u662f\u540c\u6b65\u548c\u4e92\u65a5\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u540c\u6b65\uff08Synchronization\uff09\u534f\u8c03\u4efb\u52a1\u987a\u5e8f/\u4e8b\u4ef6\u5230\u8fbe\uff1b\u4e92\u65a5\uff08Mutual Exclusion\uff09\u4fdd\u8bc1\u5171\u4eab\u8d44\u6e90\u540c\u4e00\u65f6\u523b\u53ea\u88ab\u4e00\u4e2a\u4efb\u52a1\u8bbf\u95ee\u3002 \u8ffd\u95ee\uff1aMutex \u548c Semaphore \u533a\u522b\uff1f \u8ffd\u95ee\u7b54\uff1aMutex \u7528\u4e8e\u4e92\u65a5\uff0c\u901a\u5e38\u6709\u201c\u6240\u6709\u6743\u201d\uff1bSemaphore \u9002\u5408\u8ba1\u6570\u8d44\u6e90\u6216\u4e8b\u4ef6\u901a\u77e5\uff0c\u4e0d\u5f3a\u8c03\u6240\u6709\u6743\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#16","title":"16. \u8fdb\u7a0b\u548c\u7ebf\u7a0b\u901a\u4fe1\u65b9\u5f0f\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aIPC\uff08Inter-Process Communication\uff09\u5e38\u89c1\uff1a\u7ba1\u9053\u3001\u6d88\u606f\u961f\u5217\u3001\u5171\u4eab\u5185\u5b58\u3001Socket\uff1b\u7ebf\u7a0b\u95f4\u7528 mutex\u3001condition variable\uff08\u6761\u4ef6\u53d8\u91cf\uff09\u3001semaphore\u3002 \u8ffd\u95ee\uff1a\u5171\u4eab\u5185\u5b58\u4e3a\u4ec0\u4e48\u5feb\uff1f \u8ffd\u95ee\u7b54\uff1a\u907f\u514d\u62f7\u8d1d\uff0c\u76f4\u63a5\u5171\u4eab\u5730\u5740\u7a7a\u95f4\uff0c\u4f46\u9700\u989d\u5916\u540c\u6b65\u4fdd\u8bc1\u4e00\u81f4\u6027\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#17","title":"17. \u5e38\u89c1\u8c03\u5ea6\u7b97\u6cd5\u6709\u54ea\u4e9b\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aFCFS\uff08First-Come First-Served\uff09\u3001RR\uff08Round Robin\uff09\u3001\u4f18\u5148\u7ea7\u8c03\u5ea6\uff1b\u5b9e\u65f6\u7cfb\u7edf\u5e38\u89c1 FIFO / RR\uff08\u6309\u4f18\u5148\u7ea7\u961f\u5217\uff09\u3002 \u8ffd\u95ee\uff1aRR \u7684\u4f18\u7f3a\u70b9\uff1f \u8ffd\u95ee\u7b54\uff1a\u516c\u5e73\u3001\u5b9e\u73b0\u7b80\u5355\uff1b\u65f6\u95f4\u7247\u9009\u62e9\u4e0d\u5f53\u4f1a\u5bfc\u81f4\u5207\u6362\u5f00\u9500\u5927\u6216\u54cd\u5e94\u53d8\u6162\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#18","title":"18. \u4ec0\u4e48\u662f\u4e2d\u65ad\u5d4c\u5957\u548c\u4e2d\u65ad\u4f18\u5148\u7ea7\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u9ad8\u4f18\u5148\u7ea7\u4e2d\u65ad\u53ef\u6253\u65ad\u4f4e\u4f18\u5148\u7ea7\u4e2d\u65ad\u6267\u884c\uff1b\u7528\u4e8e\u4fdd\u8bc1\u5173\u952e\u4e8b\u4ef6\u4f18\u5148\u54cd\u5e94\u3002 \u8ffd\u95ee\uff1a\u5982\u4f55\u907f\u514d\u4e2d\u65ad\u201c\u6253\u65ad\u592a\u591a\u201d\u5bfc\u81f4\u7cfb\u7edf\u4e0d\u7a33\uff1f \u8ffd\u95ee\u7b54\uff1a\u5408\u7406\u8bbe\u7f6e\u4f18\u5148\u7ea7\u3001\u63a7\u5236 ISR \u65f6\u957f\u3001\u7528 DMA/\u7f13\u51b2\u3001\u5fc5\u8981\u65f6\u4e34\u754c\u533a\u77ed\u6682\u5173\u4e2d\u65ad\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#19-exceptioninterrupt","title":"19. \u5f02\u5e38\uff08Exception\uff09\u548c\u4e2d\u65ad\uff08Interrupt\uff09\u533a\u522b\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aInterrupt \u591a\u7531\u5916\u8bbe/\u5916\u90e8\u4e8b\u4ef6\u89e6\u53d1\uff1bException \u591a\u7531 CPU \u5185\u90e8\u4e8b\u4ef6\uff08Fault\u3001SVC\uff09\u89e6\u53d1\uff1b\u90fd\u4f1a\u5f15\u8d77\u63a7\u5236\u6d41\u5207\u6362\u3002 \u8ffd\u95ee\uff1aHardFault \u5e38\u89c1\u539f\u56e0\uff1f \u8ffd\u95ee\u7b54\uff1a\u975e\u6cd5\u5730\u5740\u8bbf\u95ee\u3001\u6808\u6ea2\u51fa\u3001\u672a\u5bf9\u9f50\u8bbf\u95ee\u3001\u51fd\u6570\u6307\u9488\u8dd1\u98de\u7b49\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#20","title":"20. \u4ec0\u4e48\u662f\u7528\u6237\u6001\u548c\u5185\u6838\u6001\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u7528\u6237\u6001\u6743\u9650\u4f4e\uff0c\u4e0d\u80fd\u76f4\u63a5\u8bbf\u95ee\u786c\u4ef6\uff1b\u5185\u6838\u6001\u6743\u9650\u9ad8\uff0c\u7cfb\u7edf\u8c03\u7528\u4ece\u7528\u6237\u6001\u5207\u5230\u5185\u6838\u6001\u5b8c\u6210\u654f\u611f\u64cd\u4f5c\u3002 \u8ffd\u95ee\uff1a\u4e3a\u4ec0\u4e48\u8981\u533a\u5206\uff1f \u8ffd\u95ee\u7b54\uff1a\u9694\u79bb\u4e0e\u5b89\u5168\uff0c\u907f\u514d\u7528\u6237\u7a0b\u5e8f\u7834\u574f\u7cfb\u7edf\u8d44\u6e90\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#d-c-c-2135","title":"D. C / C++ \u8bed\u8a00\uff0821\u201335\uff09","text":""},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#21-c-c","title":"21. C \u548c C++ \u7684\u533a\u522b\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aC \u9762\u5411\u8fc7\u7a0b\u3001\u8d34\u8fd1\u786c\u4ef6\uff1bC++ \u5728\u6b64\u57fa\u7840\u4e0a\u652f\u6301\u9762\u5411\u5bf9\u8c61\uff08OOP\uff09\u3001\u6a21\u677f\u7b49\uff0c\u66f4\u5229\u4e8e\u590d\u6742\u7cfb\u7edf\u67b6\u6784\u4e0e\u590d\u7528\u3002 \u8ffd\u95ee\uff1a\u5d4c\u5165\u5f0f\u66f4\u63a8\u8350\u7528\u54ea\u4e2a\uff1f \u8ffd\u95ee\u7b54\uff1a\u8d44\u6e90\u7d27\u5f20/\u9a71\u52a8\u5c42\u5e38\u7528 C\uff1b\u4e1a\u52a1\u590d\u6742/\u9700\u8981\u62bd\u8c61\u590d\u7528\u53ef\u7528 C++\uff0c\u4f46\u8981\u63a7\u5236\u5f02\u5e38\u3001RTTI\u3001\u52a8\u6001\u5206\u914d\u7b49\u5f00\u9500\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#22","title":"22. \u4ec0\u4e48\u662f\u6307\u9488\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u6307\u9488\u662f\u5b58\u653e\u5730\u5740\u7684\u53d8\u91cf\uff1b\u5d4c\u5165\u5f0f\u4e2d\u5e38\u7528\u4e8e\u53c2\u6570\u4f20\u9012\u3001\u6570\u7ec4\u8bbf\u95ee\u3001\u4ee5\u53ca\u8bbf\u95ee Memory-Mapped Register\uff08\u5185\u5b58\u6620\u5c04\u5bc4\u5b58\u5668\uff09\u3002 \u8ffd\u95ee\uff1avolatile \u548c\u5bc4\u5b58\u5668\u8bbf\u95ee\u5173\u7cfb\uff1f \u8ffd\u95ee\u7b54\uff1a\u5bc4\u5b58\u5668\u503c\u53ef\u80fd\u88ab\u786c\u4ef6\u6539\u53d8\uff0c\u9700 volatile \u9632\u6b62\u7f16\u8bd1\u5668\u4f18\u5316\u6389\u8bfb\u5199\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#23","title":"23. \u5f15\u7528\u548c\u6307\u9488\u533a\u522b\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u5f15\u7528\u5fc5\u987b\u521d\u59cb\u5316\u4e14\u4e0d\u53ef\u91cd\u65b0\u7ed1\u5b9a\uff1b\u6307\u9488\u53ef\u4e3a\u7a7a\u3001\u53ef\u6539\u6307\u5411\uff0c\u4f46\u9700\u8981\u624b\u52a8\u89e3\u5f15\u7528\u5e76\u6ce8\u610f\u5b89\u5168\u3002 \u8ffd\u95ee\uff1a\u4ec0\u4e48\u65f6\u5019\u66f4\u9002\u5408\u5f15\u7528\uff1f \u8ffd\u95ee\u7b54\uff1a\u51fd\u6570\u53c2\u6570\u4f20\u9012\u4e2d\u5e0c\u671b\u201c\u4e0d\u4e3a\u7a7a\u4e14\u8bed\u4e49\u6e05\u6670\u201d\u65f6\u7528\u5f15\u7528\uff08C++\uff09\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#24-struct","title":"24. \u4ec0\u4e48\u662f\u7ed3\u6784\u4f53\uff08struct\uff09\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u7528\u6237\u81ea\u5b9a\u4e49\u590d\u5408\u7c7b\u578b\uff0c\u628a\u591a\u4e2a\u6210\u5458\u7ec4\u5408\u5728\u4e00\u8d77\uff1b\u5e38\u7528\u4e8e\u63cf\u8ff0\u5916\u8bbe\u914d\u7f6e\u3001\u901a\u4fe1\u5e27\u3002 \u8ffd\u95ee\uff1a\u7ed3\u6784\u4f53\u5bf9\u9f50\uff08padding\uff09\u4f1a\u5e26\u6765\u4ec0\u4e48\uff1f \u8ffd\u95ee\u7b54\uff1a\u4f1a\u63d2\u5165\u586b\u5145\u5b57\u8282\u5bfc\u81f4\u5927\u5c0f\u53d8\u5927\uff1b\u901a\u4fe1/\u5b58\u50a8\u65f6\u8981\u6ce8\u610f\u5bf9\u9f50\u3001packed\u3001\u6216\u624b\u52a8\u5e8f\u5217\u5316\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#25-struct-union","title":"25. struct \u548c union \u533a\u522b\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1astruct \u6210\u5458\u72ec\u7acb\u5360\u5185\u5b58\uff0c\u603b\u5927\u5c0f\u7d2f\u52a0\uff1bunion \u5171\u7528\u540c\u4e00\u5757\u5185\u5b58\uff0c\u5927\u5c0f\u53d6\u6700\u5927\u6210\u5458\uff0c\u53ea\u80fd\u201c\u540c\u4e00\u65f6\u523b\u89e3\u91ca\u4e00\u79cd\u7c7b\u578b\u201d\u3002 \u8ffd\u95ee\uff1aunion \u5e38\u89c1\u7528\u9014\uff1f \u8ffd\u95ee\u7b54\uff1a\u8282\u7701\u5185\u5b58\u3001\u534f\u8bae\u89e3\u6790\uff08\u540c\u4e00\u6bb5\u6570\u636e\u6309\u5b57\u8282/\u6574\u578b\u89e3\u91ca\uff09\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#26-class","title":"26. \u4ec0\u4e48\u662f\u7c7b\uff08class\uff09\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u7c7b\u5c01\u88c5\u6570\u636e\u4e0e\u65b9\u6cd5\uff0c\u652f\u6301\u5c01\u88c5/\u7ee7\u627f/\u591a\u6001\uff0c\u63d0\u9ad8\u53ef\u7ef4\u62a4\u6027\u4e0e\u6269\u5c55\u6027\u3002 \u8ffd\u95ee\uff1aclass \u548c struct \u533a\u522b\uff1f \u8ffd\u95ee\u7b54\uff1aC++ \u4e2d\u9ed8\u8ba4\u8bbf\u95ee\u6743\u9650\u4e0d\u540c\uff1aclass \u9ed8\u8ba4 private\uff0cstruct \u9ed8\u8ba4 public\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#27-c","title":"27. C++ \u5982\u4f55\u5b9e\u73b0\u591a\u6001\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u901a\u8fc7 virtual function\uff08\u865a\u51fd\u6570\uff09\u5b9e\u73b0\u8fd0\u884c\u65f6\u591a\u6001\uff1b\u57fa\u7c7b\u6307\u9488/\u5f15\u7528\u6307\u5411\u6d3e\u751f\u7c7b\u5bf9\u8c61\uff0c\u8c03\u7528\u865a\u51fd\u6570\u89e6\u53d1\u52a8\u6001\u7ed1\u5b9a\u3002 \u8ffd\u95ee\uff1a\u7eaf\u865a\u51fd\u6570\u4f5c\u7528\uff1f \u8ffd\u95ee\u7b54\uff1a\u5b9a\u4e49\u63a5\u53e3/\u62bd\u8c61\u7c7b\uff0c\u5f3a\u5236\u6d3e\u751f\u7c7b\u5b9e\u73b0\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#28-malloc-free","title":"28. \u8865\u9f50\uff1a\u4ec0\u4e48\u662f malloc / free\uff1f\u5728\u5d4c\u5165\u5f0f\u8981\u6ce8\u610f\u4ec0\u4e48\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1amalloc\uff08Memory Allocation\uff09\u5728\u5806\u4e0a\u52a8\u6001\u5206\u914d\u5185\u5b58\uff0cfree \u91ca\u653e\uff1b\u5d4c\u5165\u5f0f\u9700\u5173\u6ce8\u5185\u5b58\u788e\u7247\u3001\u6cc4\u6f0f\u4e0e\u5b9e\u65f6\u6027\u6296\u52a8\u3002 \u8ffd\u95ee\uff1a\u4ec0\u4e48\u65f6\u5019\u5c3d\u91cf\u4e0d\u7528 malloc\uff1f \u8ffd\u95ee\u7b54\uff1a\u786c\u5b9e\u65f6/\u957f\u671f\u8fd0\u884c\u573a\u666f\u5c3d\u91cf\u7528\u9759\u6001/\u6808/\u5185\u5b58\u6c60\uff0c\u907f\u514d\u788e\u7247\u548c\u4e0d\u53ef\u9884\u6d4b\u5ef6\u8fdf\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#29-macro","title":"29. \u4ec0\u4e48\u662f\u5b8f\u5b9a\u4e49\uff08macro\uff09\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u5b8f\u5728\u9884\u5904\u7406\u9636\u6bb5\u505a\u6587\u672c\u66ff\u6362\uff0c\u53ef\u7528\u4e8e\u5e38\u91cf\u3001\u6761\u4ef6\u7f16\u8bd1\uff1b\u7f3a\u70b9\u662f\u65e0\u7c7b\u578b\u68c0\u67e5\u3001\u6613\u5f15\u5165\u526f\u4f5c\u7528\u3002 \u8ffd\u95ee\uff1a\u5b8f\u548c inline \u51fd\u6570\u600e\u4e48\u9009\uff1f \u8ffd\u95ee\u7b54\uff1a\u6709\u7c7b\u578b/\u8c03\u8bd5\u53cb\u597d\u9700\u6c42\u7528 inline\uff1b\u7b80\u5355\u5e38\u91cf\u7528\u5b8f\u6216 const/constexpr\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#30-namespace","title":"30. \u4ec0\u4e48\u662f\u547d\u540d\u7a7a\u95f4\uff08namespace\uff09\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1anamespace \u7528\u4e8e\u7ec4\u7ec7\u7b26\u53f7\u3001\u9632\u6b62\u547d\u540d\u51b2\u7a81\uff0c\u4f8b\u5982 std\u3002 \u8ffd\u95ee\uff1a\u4e3a\u4ec0\u4e48\u4e0d\u63a8\u8350\u5728\u5934\u6587\u4ef6\u5199 <code>using namespace std;</code>\uff1f \u8ffd\u95ee\u7b54\uff1a\u4f1a\u6c61\u67d3\u5168\u5c40\u547d\u540d\u7a7a\u95f4\uff0c\u5bfc\u81f4\u51b2\u7a81\u4e0e\u4e8c\u4e49\u6027\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#31","title":"31. \u6307\u9488\u548c\u6570\u7ec4\u533a\u522b\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u6570\u7ec4\u662f\u8fde\u7eed\u5185\u5b58\u5757\u3001\u5927\u5c0f\u56fa\u5b9a\uff1b\u6307\u9488\u662f\u5730\u5740\u53d8\u91cf\u53ef\u6539\u6307\u5411\uff1bsizeof(\u6570\u7ec4) \u5f97\u5230\u603b\u5927\u5c0f\uff0csizeof(\u6307\u9488) \u662f\u6307\u9488\u5927\u5c0f\u3002 \u8ffd\u95ee\uff1a\u51fd\u6570\u5f62\u53c2\u91cc\u6570\u7ec4\u4f1a\u9000\u5316\u5417\uff1f \u8ffd\u95ee\u7b54\uff1a\u4f1a\u9000\u5316\u4e3a\u6307\u9488\uff0c\u56e0\u6b64\u5728\u51fd\u6570\u91cc sizeof(arr) \u5f97\u5230\u7684\u662f\u6307\u9488\u5927\u5c0f\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#32","title":"32. \u5982\u4f55\u5224\u65ad\u5927\u7aef/\u5c0f\u7aef\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u770b\u4f4e\u5730\u5740\u5b58\u4f4e\u5b57\u8282\u8fd8\u662f\u9ad8\u5b57\u8282\uff1b\u4f4e\u5730\u5740\u5b58\u4f4e\u5b57\u8282\u662f\u5c0f\u7aef\uff1bSTM32 \u5c0f\u7aef\u3002 \u8ffd\u95ee\uff1a\u7f51\u7edc\u5b57\u8282\u5e8f\u662f\u4ec0\u4e48\uff1f \u8ffd\u95ee\u7b54\uff1a\u901a\u5e38\u6307\u5927\u7aef\uff1b\u8de8\u5e73\u53f0\u901a\u4fe1\u9700 htonl/ntohl \u7b49\u8f6c\u6362\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#33-strcpy","title":"33. \u624b\u5199 strcpy\uff08\u5e76\u8bf4\u6ce8\u610f\u70b9\uff09","text":"<p>\u4e3b\u56de\u7b54\uff1a</p> <pre><code>char* my_strcpy(char* dest, const char* src){\n    char* ret = dest;\n    while((*dest++ = *src++) != '\\0');\n    return ret;\n}\n</code></pre> <p>\u6ce8\u610f dest \u7a7a\u95f4\u5fc5\u987b\u8db3\u591f\u3001src \u5fc5\u987b\u4ee5 '\\0' \u7ed3\u5c3e\uff1b\u4e0d\u5904\u7406\u5185\u5b58\u91cd\u53e0\uff08\u91cd\u53e0\u5e94\u4f7f\u7528 memmove \u601d\u8def\uff09\u3002 \u8ffd\u95ee\uff1a\u600e\u4e48\u9632\u6b62\u6ea2\u51fa\uff1f \u8ffd\u95ee\u7b54\uff1a\u4f20\u5165\u957f\u5ea6\uff0c\u7528 strncpy/strlcpy\uff08\u82e5\u53ef\u7528\uff09\u6216\u81ea\u5df1\u505a\u8fb9\u754c\u68c0\u67e5\u5e76\u4fdd\u8bc1 '\\0' \u7ed3\u5c3e\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#34","title":"34. \u9012\u5f52\u9700\u8981\u6ce8\u610f\u4ec0\u4e48\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u5fc5\u987b\u6709\u7ec8\u6b62\u6761\u4ef6\uff1b\u6bcf\u6b21\u8c03\u7528\u6d88\u8017\u6808\uff1b\u5d4c\u5165\u5f0f\u6808\u5c0f\uff0c\u907f\u514d\u6df1\u9012\u5f52\u3002 \u8ffd\u95ee\uff1a\u9012\u5f52\u80fd\u66ff\u4ee3\u5417\uff1f \u8ffd\u95ee\u7b54\uff1a\u591a\u6570\u53ef\u7528\u5faa\u73af + \u663e\u5f0f\u6808/\u961f\u5217\u66ff\u4ee3\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#35-c","title":"35. C \u6587\u4ef6\u64cd\u4f5c\u6709\u54ea\u4e9b\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1afopen \u6253\u5f00\u3001fread/fwrite \u8bfb\u5199\u3001fclose \u5173\u95ed\uff1b\u5d4c\u5165\u5f0f Linux \u5e38\u7528\u4e8e\u6587\u4ef6/\u8bbe\u5907\u8282\u70b9\u64cd\u4f5c\u3002 \u8ffd\u95ee\uff1aMCU \u88f8\u673a\u4e5f\u80fd fopen \u5417\uff1f \u8ffd\u95ee\u7b54\uff1a\u901a\u5e38\u4e0d\u884c\uff0c\u9664\u975e\u6709\u6587\u4ef6\u7cfb\u7edf\uff08FATFS \u7b49\uff09\u548c\u5b58\u50a8\u4ecb\u8d28\u652f\u6301\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#e-mcu-3643","title":"E. MCU / \u4e2d\u65ad / \u5de5\u7a0b\uff0836\u201343\uff09","text":""},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#36","title":"36. \u5355\u7247\u673a\u4e2d\u65ad\u57fa\u672c\u6d41\u7a0b\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u4e2d\u65ad\u89e6\u53d1\u2192\u4fdd\u5b58\u73b0\u573a\u2192\u8fdb\u5165 ISR\u2192\u5904\u7406\u5e76\u6e05\u6807\u5fd7\u2192\u6062\u590d\u73b0\u573a\u8fd4\u56de\uff1b\u7528\u4e8e\u5904\u7406\u5f3a\u5b9e\u65f6\u4e8b\u4ef6\u3002 \u8ffd\u95ee\uff1aISR \u91cc\u6700\u5fcc\u8bb3\u4ec0\u4e48\uff1f \u8ffd\u95ee\u7b54\uff1a\u957f\u65f6\u95f4\u963b\u585e\uff08printf\u3001\u7b49\u5f85\u9501\u3001\u5ef6\u65f6\uff09\uff0c\u4f1a\u5f71\u54cd\u7cfb\u7edf\u5b9e\u65f6\u6027\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#37","title":"37. \u4ec0\u4e48\u662f\u4e2d\u65ad\u5411\u91cf\u8868\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u4fdd\u5b58\u5404\u4e2d\u65ad/\u5f02\u5e38\u5165\u53e3\u5730\u5740\u7684\u8868\uff1bCPU \u6839\u636e\u4e2d\u65ad\u53f7\u67e5\u8868\u8df3\u8f6c\u5230\u5bf9\u5e94 ISR\u3002 \u8ffd\u95ee\uff1a\u5411\u91cf\u8868\u80fd\u91cd\u5b9a\u4f4d\u5417\uff1f \u8ffd\u95ee\u7b54\uff1a\u5f88\u591a MCU \u652f\u6301\uff08\u5982\u901a\u8fc7 VTOR\uff09\uff0c\u7528\u4e8e Bootloader/APP \u5206\u533a\u5207\u6362\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#38","title":"38. \u5e38\u89c1\u4e2d\u65ad\u7c7b\u578b\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u5916\u90e8\u4e2d\u65ad\u3001\u5b9a\u65f6\u5668\u4e2d\u65ad\u3001\u4e32\u53e3\u4e2d\u65ad\u3001ADC \u4e2d\u65ad\u7b49\u3002 \u8ffd\u95ee\uff1a\u5916\u90e8\u4e2d\u65ad\u6309\u952e\u600e\u4e48\u6d88\u6296\uff1f \u8ffd\u95ee\u7b54\uff1a\u4e2d\u65ad\u91cc\u53ea\u7f6e\u6807\u5fd7\uff0c\u4e3b\u5faa\u73af/\u5b9a\u65f6\u5668\u5ef6\u65f6\u786e\u8ba4\uff1b\u6216\u7528\u5b9a\u65f6\u5668\u91c7\u6837\u6ee4\u6ce2\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#39","title":"39. \u8f6e\u8be2\u548c\u4e2d\u65ad\u533a\u522b\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u8f6e\u8be2\u5360 CPU\u3001\u5b9e\u65f6\u6027\u5dee\uff1b\u4e2d\u65ad\u4e8b\u4ef6\u9a71\u52a8\uff0c\u6548\u7387\u9ad8\u3001\u54cd\u5e94\u5feb\u3002 \u8ffd\u95ee\uff1a\u4ec0\u4e48\u65f6\u5019\u53cd\u800c\u7528\u8f6e\u8be2\uff1f \u8ffd\u95ee\u7b54\uff1a\u4e8b\u4ef6\u9891\u7e41\u4e14\u5904\u7406\u6781\u77ed\u3001\u6216\u542f\u52a8\u9636\u6bb5\u7b80\u5355\u8bfb\u72b6\u6001\u3001\u6216\u4e3a\u907f\u514d\u4e2d\u65ad\u6296\u52a8\u65f6\u53ef\u7528\u8f6e\u8be2\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#40-gpio","title":"40. GPIO \u57fa\u672c\u5de5\u4f5c\u65b9\u5f0f\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u914d\u7f6e\u8f93\u5165/\u8f93\u51fa\u6a21\u5f0f\u4e0e\u4e0a\u4e0b\u62c9\uff1b\u8f93\u5165\u8bfb\u7535\u5e73\uff0c\u8f93\u51fa\u5199\u7535\u5e73\uff1b\u5e38\u7528\u4e8e\u6309\u952e/LED\u3002 \u8ffd\u95ee\uff1a\u5f00\u6f0f\u8f93\u51fa\u662f\u4ec0\u4e48\uff1f \u8ffd\u95ee\u7b54\uff1a\u53ea\u80fd\u62c9\u4f4e\u4e0d\u80fd\u4e3b\u52a8\u62c9\u9ad8\uff0c\u9700\u8981\u4e0a\u62c9\u7535\u963b\uff0c\u9002\u5408\u603b\u7ebf\u5171\u4eab\uff08\u5982 I2C\uff09\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#41-c","title":"41. C \u4ee3\u7801\u548c\u6307\u4ee4\u7684\u5173\u7cfb\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aC \u4f1a\u88ab\u7f16\u8bd1\u6210\u673a\u5668\u6307\u4ee4\u6267\u884c\uff1b\u5199\u6cd5\u5f71\u54cd\u6307\u4ee4\u6570\u91cf\u3001\u6027\u80fd\u4e0e\u4ee3\u7801\u5927\u5c0f\uff1b\u5d4c\u5165\u5f0f\u9700\u5173\u6ce8\u4f18\u5316\u3001\u5185\u8054\u3001\u8bbf\u5b58\u3002 \u8ffd\u95ee\uff1avolatile \u4f1a\u5f71\u54cd\u4ec0\u4e48\uff1f \u8ffd\u95ee\u7b54\uff1a\u7981\u6b62\u67d0\u4e9b\u4f18\u5316\uff0c\u4fdd\u8bc1\u6bcf\u6b21\u90fd\u771f\u5b9e\u8bfb\u5199\u5185\u5b58/\u5bc4\u5b58\u5668\uff0c\u9002\u7528\u4e8e\u786c\u4ef6\u5bc4\u5b58\u5668\u4e0e\u591a\u7ebf\u7a0b\u5171\u4eab\u53d8\u91cf\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#42-pid","title":"42. PID \u63a7\u5236\u7b80\u8ff0\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aP \u63d0\u5347\u54cd\u5e94\u901f\u5ea6\uff0cI \u6d88\u9664\u7a33\u6001\u8bef\u5dee\uff0cD \u6291\u5236\u8d85\u8c03\uff1b\u5e38\u7528\u4e8e\u901f\u5ea6\u73af/\u4f4d\u7f6e\u73af\u3002 \u8ffd\u95ee\uff1a\u79ef\u5206\u9971\u548c\u600e\u4e48\u5904\u7406\uff1f \u8ffd\u95ee\u7b54\uff1a\u79ef\u5206\u9650\u5e45\u3001\u6761\u4ef6\u79ef\u5206\u3001\u8f93\u51fa\u9650\u5e45\u4e0e\u53cd\u79ef\u5206\uff08anti-windup\uff09\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#43-foc","title":"43. FOC \u662f\u4ec0\u4e48\uff08\u88ab\u95ee\u5230\u5c31\u8bf4\uff09\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aFOC\uff08Field-Oriented Control\uff09\u78c1\u573a\u5b9a\u5411\u63a7\u5236\uff0c\u628a\u4e09\u76f8\u7535\u6d41\u53d8\u6362\u5230 d-q \u5750\u6807\u7cfb\u5b9e\u73b0\u89e3\u8026\u63a7\u5236\uff0c\u63d0\u5347\u6548\u7387\u4e0e\u52a8\u6001\u6027\u80fd\u3002 \u8ffd\u95ee\uff1aFOC \u91cc Clarke/Park \u53d8\u6362\u76ee\u7684\uff1f \u8ffd\u95ee\u7b54\uff1a\u628a\u4e09\u76f8\u91cf\u8f6c\u6362\u5230\u65cb\u8f6c\u5750\u6807\u7cfb\uff0c\u4f7f\u8f6c\u77e9/\u52b1\u78c1\u5206\u91cf\u53ef\u5206\u522b\u63a7\u5236\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#f-linux-4450","title":"F. Linux / \u7f51\u7edc\uff0844\u201350\uff09","text":""},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#44-tcp","title":"44. TCP \u670d\u52a1\u5668\u5efa\u7acb\u6d41\u7a0b\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1asocket \u2192 bind \u2192 listen \u2192 accept \u2192 recv/send \u2192 close\u3002 \u8ffd\u95ee\uff1aaccept \u662f\u5e72\u4ec0\u4e48\uff1f \u8ffd\u95ee\u7b54\uff1a\u4ece\u76d1\u542c socket \u4e0a\u63a5\u6536\u8fde\u63a5\u8bf7\u6c42\uff0c\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u5df2\u8fde\u63a5 socket \u4e13\u7528\u4e8e\u4e0e\u8be5\u5ba2\u6237\u7aef\u901a\u4fe1\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#45-tcp-udp","title":"45. TCP \u548c UDP \u533a\u522b\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aTCP \u9762\u5411\u8fde\u63a5\u3001\u53ef\u9760\u3001\u6709\u6d41\u63a7\u4e0e\u62e5\u585e\u63a7\u5236\uff1bUDP \u65e0\u8fde\u63a5\u3001\u5f00\u9500\u5c0f\u3001\u5ef6\u8fdf\u4f4e\u4f46\u4e0d\u4fdd\u8bc1\u53ef\u9760\u3002 \u8ffd\u95ee\uff1a\u4e3a\u4ec0\u4e48\u5b9e\u65f6\u66f4\u7231 UDP\uff1f \u8ffd\u95ee\u7b54\uff1a\u4e22\u5305\u53ef\u63a5\u53d7\u4f46\u5ef6\u8fdf\u4e0d\u53ef\u63a5\u53d7\uff1bUDP \u4e0d\u4f1a\u56e0\u91cd\u4f20/\u62e5\u585e\u63a7\u5236\u5f15\u5165\u989d\u5916\u5ef6\u8fdf\u6296\u52a8\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#46-vs","title":"46. \u8fdb\u7a0b vs \u7ebf\u7a0b\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u8fdb\u7a0b\u662f\u8d44\u6e90\u5206\u914d\u5355\u4f4d\uff0c\u7ebf\u7a0b\u662f\u8c03\u5ea6\u5355\u4f4d\uff1b\u7ebf\u7a0b\u5171\u4eab\u8fdb\u7a0b\u8d44\u6e90\uff0c\u5207\u6362\u5f00\u9500\u5c0f\u4f46\u9700\u540c\u6b65\u3002 \u8ffd\u95ee\uff1a\u4e3a\u4ec0\u4e48\u591a\u8fdb\u7a0b\u66f4\u201c\u5b89\u5168\u201d\uff1f \u8ffd\u95ee\u7b54\uff1a\u5730\u5740\u7a7a\u95f4\u9694\u79bb\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u5d29\u6e83\u4e0d\u4e00\u5b9a\u62d6\u57ae\u6574\u4e2a\u7cfb\u7edf\uff08\u66f4\u5f3a\u9694\u79bb\uff09\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#47-linux","title":"47. Linux \u591a\u7ebf\u7a0b\u901a\u4fe1\u65b9\u5f0f\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1amutex\u3001semaphore\u3001condition variable\u3001\u8bfb\u5199\u9501\uff1b\u901a\u8fc7\u540c\u6b65\u539f\u8bed\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\u3002 \u8ffd\u95ee\uff1a\u6761\u4ef6\u53d8\u91cf\u9002\u5408\u4ec0\u4e48\u573a\u666f\uff1f \u8ffd\u95ee\u7b54\uff1a\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\uff0c\u7ebf\u7a0b\u7b49\u5f85\u67d0\u4e2a\u6761\u4ef6\u6210\u7acb\u518d\u7ee7\u7eed\u6267\u884c\uff08\u907f\u514d\u5fd9\u7b49\uff09\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#48-tcp","title":"48. TCP \u4e3a\u4ec0\u4e48\u4e09\u6b21\u63e1\u624b\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u786e\u8ba4\u53cc\u65b9\u6536\u53d1\u80fd\u529b\u4e0e\u521d\u59cb\u5e8f\u5217\u53f7\u540c\u6b65\uff0c\u907f\u514d\u65e7\u8fde\u63a5\u8bf7\u6c42\u9020\u6210\u9519\u8bef\u8fde\u63a5\u3002 \u8ffd\u95ee\uff1a\u56db\u6b21\u6325\u624b\u4e3a\u4ec0\u4e48\u662f\u56db\u6b21\uff1f \u8ffd\u95ee\u7b54\uff1aTCP \u662f\u5168\u53cc\u5de5\uff0c\u53cc\u65b9\u5404\u81ea\u5173\u95ed\u53d1\u9001\u65b9\u5411\u9700\u8981\u5206\u522b\u786e\u8ba4\uff0c\u56e0\u6b64\u901a\u5e38\u662f FIN/ACK \u4e24\u8f6e\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#49-select-poll-epoll","title":"49. select / poll / epoll \u533a\u522b\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1aselect/poll \u8f6e\u8be2\u626b\u63cf\uff0c\u8fde\u63a5\u591a\u6548\u7387\u4e0b\u964d\uff1bepoll \u4e8b\u4ef6\u9a71\u52a8\uff0c\u9002\u5408\u9ad8\u5e76\u53d1\u3002 \u8ffd\u95ee\uff1a\u4e3a\u4ec0\u4e48 epoll \u66f4\u9002\u5408\u9ad8\u5e76\u53d1\uff1f \u8ffd\u95ee\u7b54\uff1a\u628a\u201c\u5c31\u7eea\u4e8b\u4ef6\u201d\u4ece\u5185\u6838\u63a8\u9001\u51fa\u6765\uff0c\u907f\u514d\u6bcf\u6b21\u904d\u5386\u5168\u90e8 fd\uff1b\u5e76\u80fd\u590d\u7528\u5c31\u7eea\u5217\u8868\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#50-linux","title":"50. \u5d4c\u5165\u5f0f Linux \u662f\u4ec0\u4e48\uff1f","text":"<p>\u4e3b\u56de\u7b54\uff1a\u88c1\u526a\u540e\u7684 Linux \u8fd0\u884c\u5728\u5d4c\u5165\u5f0f\u8bbe\u5907\u4e0a\uff0c\u529f\u80fd\u5f3a\uff08\u7f51\u7edc\u3001\u591a\u8fdb\u7a0b\u3001\u9a71\u52a8\u751f\u6001\uff09\u4f46\u8d44\u6e90\u5360\u7528\u66f4\u5927\u3001\u5b9e\u65f6\u6027\u76f8\u5bf9\u5f31\uff08\u53ef\u914d PREEMPT_RT \u6216\u7528 RT \u65b9\u6848\u8865\u9f50\uff09\u3002 \u8ffd\u95ee\uff1a\u4ec0\u4e48\u65f6\u5019\u9009\u5d4c\u5165\u5f0f Linux \u800c\u4e0d\u662f MCU\uff1f \u8ffd\u95ee\u7b54\uff1a\u9700\u8981\u590d\u6742\u7f51\u7edc/\u591a\u5a92\u4f53/\u6587\u4ef6\u7cfb\u7edf/\u9ad8\u7b97\u529b/\u4e30\u5bcc\u5916\u8bbe\u751f\u6001\u65f6\u9009 Linux\uff1b\u786c\u5b9e\u65f6\u3001\u4f4e\u529f\u8017\u3001\u6210\u672c\u654f\u611f\u591a\u9009 MCU/RTOS\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#linux-os","title":"\u4e09\u3001Linux / OS / \u7f51\u7edc\uff08\u533a\u5206\u521d\u7ea7 &amp; \u8fdb\u9636\uff5c\u53ef\u80cc\u7248\uff09","text":""},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#1-rtos","title":"1\ufe0f\u20e3 \u7528\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u5417\uff1f\uff08RTOS \u52a0\u5206\u9879\uff09","text":"<p>\u9762\u8bd5\u5b98\u95ee\u6cd5</p> <p>\u4f60\u7528\u8fc7\u54ea\u4e9b\u64cd\u4f5c\u7cfb\u7edf\uff1fFreeRTOS / uC/OS / Linux \u4e86\u89e3\u591a\u5c11\uff1f</p> <p>\u6807\u51c6\u56de\u7b54\uff08\u76f4\u63a5\u80cc\uff09</p> <p>\u7528\u8fc7 FreeRTOS\uff08\u6216 uC/OS\uff09\uff0c\u7406\u89e3\u4efb\u52a1\uff08Task\uff09\u3001\u8c03\u5ea6\uff08Scheduler\uff09\u3001\u4f18\u5148\u7ea7\uff08Priority\uff09\u4ee5\u53ca\u540c\u6b65\u673a\u5236\uff1a\u4e92\u65a5\u9501\uff08Mutex\uff09\u3001\u4fe1\u53f7\u91cf\uff08Semaphore\uff09\u3001\u6d88\u606f\u961f\u5217\uff08Queue\uff09\u3002 \u5728 STM32 \u9879\u76ee\u4e2d\u7528 RTOS \u628a\u901a\u4fe1\u3001\u4f20\u611f\u5668\u91c7\u96c6\u3001\u63a7\u5236\u7b97\u6cd5\u5206\u6210\u4e0d\u540c\u4efb\u52a1\uff0c\u63d0\u9ad8\u7cfb\u7edf\u5b9e\u65f6\u6027\u4e0e\u53ef\u7ef4\u62a4\u6027\u3002</p> <p>\u8ffd\u95ee 1\uff1aRTOS \u548c\u88f8\u673a\u7684\u533a\u522b\uff1f \u8ffd\u95ee\u7b54\uff1a</p> <p>\u88f8\u673a\u901a\u5e38\u662f while(1)+\u4e2d\u65ad\uff0c\u7ed3\u6784\u7b80\u5355\u4f46\u590d\u6742\u5ea6\u4e0a\u5347\u540e\u4e0d\u597d\u7ef4\u62a4\uff1bRTOS \u652f\u6301\u591a\u4efb\u52a1\u4e0e\u540c\u6b65\u673a\u5236\uff0c\u7ed3\u6784\u6e05\u6670\u3001\u6269\u5c55\u65b9\u4fbf\uff0c\u4f46\u5360\u7528\u8d44\u6e90\u66f4\u591a\u3002</p> <p>\u8ffd\u95ee 2\uff1a\u4ec0\u4e48\u662f\u4f18\u5148\u7ea7\u53cd\u8f6c\uff1f\u600e\u4e48\u89e3\u51b3\uff1f \u8ffd\u95ee\u7b54\uff1a</p> <p>\u4f4e\u4f18\u5148\u7ea7\u4efb\u52a1\u6301\u6709\u9501\uff0c\u9ad8\u4f18\u5148\u7ea7\u4efb\u52a1\u7b49\u5f85\uff0c\u4e2d\u4f18\u5148\u7ea7\u4efb\u52a1\u53c8\u4e00\u76f4\u8fd0\u884c\u5bfc\u81f4\u9ad8\u4f18\u5148\u7ea7\u88ab\u201c\u5361\u4f4f\u201d\uff0c\u8fd9\u53eb\u4f18\u5148\u7ea7\u53cd\u8f6c\u3002 \u5e38\u7528\u4f18\u5148\u7ea7\u7ee7\u627f\uff08Priority Inheritance\uff09\u89e3\u51b3\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#2-vs","title":"2\ufe0f\u20e3 \u8fdb\u7a0b vs \u7ebf\u7a0b\uff1f","text":"<p>\u9762\u8bd5\u5b98\u95ee\u6cd5</p> <p>\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u6709\u4ec0\u4e48\u533a\u522b\uff1f\u4e3a\u4ec0\u4e48\u7ebf\u7a0b\u5207\u6362\u66f4\u5feb\uff1f</p> <p>\u6807\u51c6\u56de\u7b54</p> <p>\u8fdb\u7a0b\u662f\u8d44\u6e90\u5206\u914d\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u7ebf\u7a0b\u662f CPU \u8c03\u5ea6\u7684\u57fa\u672c\u5355\u4f4d\u3002 \u540c\u4e00\u8fdb\u7a0b\u5185\u7ebf\u7a0b\u5171\u4eab\u5730\u5740\u7a7a\u95f4\u4e0e\u8d44\u6e90\uff0c\u521b\u5efa/\u5207\u6362\u5f00\u9500\u66f4\u5c0f\uff1b\u8fdb\u7a0b\u4e4b\u95f4\u9694\u79bb\u66f4\u5f3a\u4f46\u5f00\u9500\u66f4\u5927\u3002</p> <p>\u8ffd\u95ee 1\uff1a\u591a\u8fdb\u7a0b\u66f4\u5b89\u5168\u5417\uff1f\u4e3a\u4ec0\u4e48\uff1f \u8ffd\u95ee\u7b54\uff1a</p> <p>\u8fdb\u7a0b\u5730\u5740\u7a7a\u95f4\u9694\u79bb\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u5d29\u6e83\u4e0d\u4e00\u5b9a\u5f71\u54cd\u5176\u4ed6\u8fdb\u7a0b\uff1b\u7ebf\u7a0b\u5171\u4eab\u5185\u5b58\uff0c\u51fa\u9519\u53ef\u80fd\u62d6\u57ae\u6574\u4e2a\u8fdb\u7a0b\u3002</p> <p>\u8ffd\u95ee 2\uff1a\u7ebf\u7a0b\u540c\u6b65\u5e38\u7528\u4ec0\u4e48\uff1f \u8ffd\u95ee\u7b54\uff1a</p> <p>\u4e92\u65a5\u9501\uff08Mutex\uff09\u3001\u8bfb\u5199\u9501\u3001\u6761\u4ef6\u53d8\u91cf\uff08Condition Variable\uff09\u3001\u4fe1\u53f7\u91cf\uff08Semaphore\uff09\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#3-tcp-udp","title":"3\ufe0f\u20e3 TCP \u548c UDP \u533a\u522b\uff1f","text":"<p>\u9762\u8bd5\u5b98\u95ee\u6cd5</p> <p>TCP \u548c UDP \u533a\u522b\uff1f\u4ec0\u4e48\u65f6\u5019\u7528 UDP\uff1f</p> <p>\u6807\u51c6\u56de\u7b54</p> <p>TCP\uff08Transmission Control Protocol\uff0c\u4f20\u8f93\u63a7\u5236\u534f\u8bae\uff09\u9762\u5411\u8fde\u63a5\u3001\u53ef\u9760\u4f20\u8f93\uff0c\u6709\u91cd\u4f20\u3001\u6d41\u91cf\u63a7\u5236\u548c\u62e5\u585e\u63a7\u5236\uff1b UDP\uff08User Datagram Protocol\uff0c\u7528\u6237\u6570\u636e\u62a5\u534f\u8bae\uff09\u65e0\u8fde\u63a5\uff0c\u5f00\u9500\u5c0f\u3001\u5ef6\u8fdf\u4f4e\uff0c\u4f46\u4e0d\u4fdd\u8bc1\u53ef\u9760\u3002 \u5b9e\u65f6\u97f3\u89c6\u9891\u3001\u4f20\u611f\u5668\u6d41\u6570\u636e\u7b49\u5bf9\u5ef6\u8fdf\u654f\u611f\u573a\u666f\u66f4\u503e\u5411 UDP\u3002</p> <p>\u8ffd\u95ee 1\uff1aTCP \u4e3a\u4ec0\u4e48\u53ef\u9760\uff1f \u8ffd\u95ee\u7b54\uff1a</p> <p>\u6709\u5e8f\u53f7\u3001\u786e\u8ba4\u5e94\u7b54 ACK\u3001\u8d85\u65f6\u91cd\u4f20\u3001\u6ed1\u52a8\u7a97\u53e3\uff0c\u4ee5\u53ca\u62e5\u585e\u63a7\u5236\u4fdd\u8bc1\u94fe\u8def\u4e0d\u8fc7\u8f7d\u3002</p> <p>\u8ffd\u95ee 2\uff1aUDP \u4e0d\u53ef\u9760\u600e\u4e48\u8865\u6551\uff1f \u8ffd\u95ee\u7b54\uff1a</p> <p>\u5e94\u7528\u5c42\u52a0\u5e8f\u53f7+\u6821\u9a8c\uff08CRC/\u6821\u9a8c\u548c\uff09+\u4e22\u5305\u68c0\u6d4b+\u5fc5\u8981\u65f6\u91cd\u4f20\uff0c\u6216\u505a\u524d\u5411\u7ea0\u9519\uff08FEC\uff09\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#4-tcp","title":"4\ufe0f\u20e3 TCP \u5efa\u7acb\u670d\u52a1\u5668\u6d41\u7a0b\uff1f","text":"<p>\u9762\u8bd5\u5b98\u95ee\u6cd5</p> <p>Linux \u4e0b\u7528 TCP \u5199\u670d\u52a1\u5668\uff0c\u6d41\u7a0b\u8bf4\u4e00\u4e0b\u3002</p> <p>\u6807\u51c6\u56de\u7b54\uff08\u7ecf\u5178\u4e94\u6b65\uff09</p> <ol> <li><code>socket()</code>\uff1a\u521b\u5efa\u5957\u63a5\u5b57</li> <li><code>bind()</code>\uff1a\u7ed1\u5b9a IP+\u7aef\u53e3</li> <li><code>listen()</code>\uff1a\u8fdb\u5165\u76d1\u542c\u72b6\u6001</li> <li><code>accept()</code>\uff1a\u63a5\u53d7\u5ba2\u6237\u7aef\u8fde\u63a5\uff08\u8fd4\u56de\u65b0\u7684\u8fde\u63a5 socket\uff09</li> <li><code>recv()/send()</code>\uff1a\u6536\u53d1\u6570\u636e\uff0c\u7ed3\u675f\u540e <code>close()</code></li> </ol> <p>\u8ffd\u95ee 1\uff1alisten \u548c accept \u7684\u533a\u522b\uff1f \u8ffd\u95ee\u7b54\uff1a</p> <p>listen \u662f\u628a socket \u53d8\u6210\u201c\u76d1\u542c socket\u201d\uff1baccept \u662f\u4ece\u76d1\u542c\u961f\u5217\u91cc\u53d6\u51fa\u4e00\u4e2a\u8fde\u63a5\uff0c\u751f\u6210\u4e00\u4e2a\u201c\u5df2\u8fde\u63a5 socket\u201d\u4e13\u95e8\u548c\u8be5\u5ba2\u6237\u7aef\u901a\u4fe1\u3002</p> <p>\u8ffd\u95ee 2\uff1a\u4e3a\u4ec0\u4e48 accept \u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 socket\uff1f \u8ffd\u95ee\u7b54\uff1a</p> <p>\u539f\u6765\u7684\u76d1\u542c socket \u8981\u7ee7\u7eed\u63a5\u65b0\u8fde\u63a5\uff1b\u65b0\u7684 socket \u7528\u4e8e\u548c\u67d0\u4e2a\u5ba2\u6237\u7aef\u6536\u53d1\u6570\u636e\uff0c\u4e92\u4e0d\u5e72\u6270\u3002</p> <p>\u8ffd\u95ee 3\uff1a\u5e76\u53d1\u670d\u52a1\u5668\u600e\u4e48\u505a\uff1f \u8ffd\u95ee\u7b54\uff1a</p> <p>\u5e38\u89c1\uff1a\u591a\u8fdb\u7a0b/\u591a\u7ebf\u7a0b\u3001\u7ebf\u7a0b\u6c60\uff1b\u6216 I/O \u591a\u8def\u590d\u7528\uff08select/poll/epoll\uff09\u505a\u9ad8\u5e76\u53d1\u3002</p> <p>\u53ef\u4ee5\u3002\u6211\u4e0b\u9762\u7ed9\u4f60\u4e00\u6bb5\u53ef\u76f4\u63a5\u7c98\u8fdb md\u7684\u8865\u5145\u5185\u5bb9\uff1a\u7ee7\u7eed\u6cbf\u7528\u4f60\u8fd9\u4e00\u7ae0\u7684\u7f16\u53f7\uff08\u4f60\u73b0\u5728\u5230 4\ufe0f\u20e3 TCP \u5efa\u7acb\u670d\u52a1\u5668\u6d41\u7a0b\uff09\uff0c\u6211\u628a\u540e\u7eed\u5e38\u89c1\u9ad8\u9891\u9898\u6309 5\ufe0f\u20e3\u30016\ufe0f\u20e3\u2026 \u5f80\u4e0b\u6392\uff0c\u4e14\u6bcf\u9898\u90fd\u6709\u4e3b\u7b54 + \u8ffd\u95ee\u7b54\u3002</p> <p>\u4f60\u628a\u8fd9\u6bb5\u76f4\u63a5\u63a5\u5728 \u201c4\ufe0f\u20e3 TCP \u5efa\u7acb\u670d\u52a1\u5668\u6d41\u7a0b\u201d \u540e\u9762\u5373\u53ef\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#5-tcp","title":"5\ufe0f\u20e3 TCP \u4e3a\u4ec0\u4e48\u4e09\u6b21\u63e1\u624b\uff1f\u56db\u6b21\u6325\u624b\uff1f","text":"<p>\u6807\u51c6\u56de\u7b54\uff08\u80cc\u8fd9\u4e2a\uff09</p> <p>\u4e09\u6b21\u63e1\u624b\u662f\u4e3a\u4e86\u786e\u8ba4\u53cc\u65b9\u6536\u53d1\u80fd\u529b\u6b63\u5e38\uff0c\u5e76\u540c\u6b65\u521d\u59cb\u5e8f\u5217\u53f7\uff0c\u907f\u514d\u65e7\u8fde\u63a5\u8bf7\u6c42\u9020\u6210\u9519\u8bef\u8fde\u63a5\u3002 \u56db\u6b21\u6325\u624b\u56e0\u4e3a TCP \u662f\u5168\u53cc\u5de5\u8fde\u63a5\uff0c\u53cc\u65b9\u5173\u95ed\u53d1\u9001\u65b9\u5411\u9700\u8981\u5206\u522b\u53d1\u9001 FIN \u5e76\u786e\u8ba4 ACK\uff0c\u6240\u4ee5\u901a\u5e38\u662f\u56db\u6b21\u3002</p> <p>\u8ffd\u95ee\uff1aTIME_WAIT \u662f\u4ec0\u4e48\uff1f\u4e3a\u4ec0\u4e48\u8981\u7b49\uff1f</p> <p>TIME_WAIT \u7528\u4e8e\u7b49\u5f85 2MSL\uff0c\u786e\u4fdd\u6700\u540e ACK \u80fd\u5230\u8fbe\u5bf9\u65b9\uff0c\u540c\u65f6\u8ba9\u7f51\u7edc\u4e2d\u7684\u65e7\u62a5\u6587\u8fc7\u671f\uff0c\u907f\u514d\u5f71\u54cd\u65b0\u8fde\u63a5\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#6-tcp","title":"6\ufe0f\u20e3 TCP \u7c98\u5305/\u62c6\u5305\u662f\u4ec0\u4e48\uff1f\u600e\u4e48\u5904\u7406\uff1f","text":"<p>\u6807\u51c6\u56de\u7b54</p> <p>TCP \u662f\u201c\u5b57\u8282\u6d41\u201d\u534f\u8bae\uff0c\u6ca1\u6709\u6d88\u606f\u8fb9\u754c\uff0c\u53d1\u9001\u7aef\u591a\u6b21 send \u5230\u63a5\u6536\u7aef\u53ef\u80fd\u88ab\u5408\u5e76\u6216\u62c6\u5206\uff0c\u5bfc\u81f4\u7c98\u5305/\u62c6\u5305\u3002 \u5904\u7406\u65b9\u5f0f\u662f\u5728\u5e94\u7528\u5c42\u5b9a\u4e49\u534f\u8bae\u8fb9\u754c\uff1a</p> <ul> <li>\u56fa\u5b9a\u957f\u5ea6</li> <li>\u5206\u9694\u7b26</li> <li>\u957f\u5ea6\u5b57\u6bb5\uff08\u63a8\u8350\uff1aHeader + Length + Payload + CRC\uff09</li> </ul> <p>\u8ffd\u95ee\uff1a\u4e3a\u4ec0\u4e48 UDP \u4e0d\u7c98\u5305\uff1f</p> <p>UDP \u662f\u6570\u636e\u62a5\uff0c\u5929\u7136\u4fdd\u7559\u62a5\u6587\u8fb9\u754c\uff1b\u4f46\u53ef\u80fd\u4e22\u5305\u3001\u4e71\u5e8f\u3001\u91cd\u590d\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#7-htons-htonl-ntohs-ntohl","title":"7\ufe0f\u20e3 \u7f51\u7edc\u5b57\u8282\u5e8f\u662f\u4ec0\u4e48\uff1fhtons / htonl / ntohs / ntohl \u505a\u4ec0\u4e48\uff1f","text":"<p>\u6807\u51c6\u56de\u7b54</p> <p>\u7f51\u7edc\u5b57\u8282\u5e8f\u901a\u5e38\u662f\u5927\u7aef\uff08Big Endian\uff09\u3002\u4e0d\u540c CPU \u53ef\u80fd\u5927\u5c0f\u7aef\u4e0d\u540c\uff0c\u8de8\u5e73\u53f0\u4f20\u8f93\u8981\u7edf\u4e00\u5b57\u8282\u5e8f\u3002 <code>htons/htonl</code>\uff1a\u4e3b\u673a\u5e8f \u2192 \u7f51\u7edc\u5e8f\uff0816/32 \u4f4d\uff09 <code>ntohs/ntohl</code>\uff1a\u7f51\u7edc\u5e8f \u2192 \u4e3b\u673a\u5e8f</p> <p>\u8ffd\u95ee\uff1aSTM32 \u662f\u5927\u7aef\u8fd8\u662f\u5c0f\u7aef\uff1f</p> <p>STM32\uff08ARM Cortex-M\uff09\u4e00\u822c\u662f\u5c0f\u7aef\uff08Little Endian\uff09\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#8-select-poll-epoll","title":"8\ufe0f\u20e3 select / poll / epoll \u7684\u533a\u522b\uff1f","text":"<p>\u6807\u51c6\u56de\u7b54</p> <p>select/poll \u6bcf\u6b21\u90fd\u8981\u626b\u63cf fd \u96c6\u5408\uff0c\u8fde\u63a5\u6570\u591a\u6548\u7387\u4e0b\u964d\uff1b epoll \u662f\u4e8b\u4ef6\u9a71\u52a8\uff0c\u628a fd \u6ce8\u518c\u5230\u5185\u6838\uff0c\u5c31\u7eea\u65f6\u8fd4\u56de\u4e8b\u4ef6\u5217\u8868\uff0c\u9002\u5408\u9ad8\u5e76\u53d1\u3002</p> <p>\u8ffd\u95ee\uff1aepoll \u7684 LT \u548c ET\uff1f</p> <p>LT\uff08\u6c34\u5e73\u89e6\u53d1\uff09\uff1a\u8fd8\u6709\u6570\u636e\u5c31\u6301\u7eed\u901a\u77e5\uff0c\u6613\u7528\uff1b ET\uff08\u8fb9\u6cbf\u89e6\u53d1\uff09\uff1a\u72b6\u6001\u53d8\u5316\u624d\u901a\u77e5\uff0c\u6548\u7387\u9ad8\u4f46\u5fc5\u987b\u975e\u963b\u585e\u5e76\u4e00\u6b21\u8bfb\u7a7a/\u5199\u5c3d\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#9-io-io","title":"9\ufe0f\u20e3 \u963b\u585e I/O \u548c\u975e\u963b\u585e I/O \u533a\u522b\uff1f\u600e\u4e48\u8bbe\u7f6e\u975e\u963b\u585e\uff1f","text":"<p>\u6807\u51c6\u56de\u7b54</p> <p>\u963b\u585e\uff1a\u8c03\u7528 recv/send/connect \u53ef\u80fd\u4e00\u76f4\u7b49\u5230\u6761\u4ef6\u6ee1\u8db3\uff1b \u975e\u963b\u585e\uff1a\u7acb\u523b\u8fd4\u56de\uff0c\u6ca1\u6570\u636e\u5c31\u8fd4\u56de EAGAIN/EWOULDBLOCK\u3002 Linux \u4e0b\u53ef\u7528 <code>fcntl(fd, F_SETFL, O_NONBLOCK)</code> \u8bbe\u7f6e\u3002</p> <p>\u8ffd\u95ee\uff1a\u975e\u963b\u585e + epoll \u5e38\u89c1\u6a21\u578b\u662f\u4ec0\u4e48\uff1f</p> <p>Reactor \u6a21\u578b\uff1a\u4e8b\u4ef6\u9a71\u52a8\uff0c\u8bfb\u5199\u56de\u8c03\u91cc\u5904\u7406\uff0c\u914d\u5408\u7f13\u51b2\u533a\u7ba1\u7406\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#udp","title":"\ud83d\udd1f UDP \u5efa\u7acb\u670d\u52a1\u5668\u6d41\u7a0b\uff1f","text":"<p>\u6807\u51c6\u56de\u7b54</p> <p>UDP \u670d\u52a1\u5668\u4e00\u822c\uff1a<code>socket \u2192 bind \u2192 recvfrom/sendto \u2192 close</code> \u4e0d\u9700\u8981 listen/accept\uff0c\u56e0\u4e3a\u65e0\u8fde\u63a5\u3002</p> <p>\u8ffd\u95ee\uff1aUDP \u600e\u4e48\u4fdd\u8bc1\u53ef\u9760\uff1f</p> <p>\u5e94\u7528\u5c42\u52a0\u5e8f\u53f7\u3001ACK\u3001\u91cd\u4f20\u3001\u8d85\u65f6\u3001\u6ed1\u52a8\u7a97\u53e3\uff0c\u6216 FEC\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#11-tcp","title":"1\ufe0f\u20e31\ufe0f\u20e3 TCP \u8fde\u63a5\u65ad\u5f00/\u5f02\u5e38\u4f60\u600e\u4e48\u68c0\u6d4b\uff1f","text":"<p>\u6807\u51c6\u56de\u7b54</p> <p>recv \u8fd4\u56de 0 \u8868\u793a\u5bf9\u7aef\u6b63\u5e38\u5173\u95ed\uff1b\u8fd4\u56de -1 \u7ed3\u5408 errno \u5224\u65ad\u5f02\u5e38\uff1b \u8fd8\u53ef\u4ee5\u8bbe\u7f6e keepalive \u6216\u5e94\u7528\u5c42\u5fc3\u8df3\u68c0\u6d4b\u3002</p> <p>\u8ffd\u95ee\uff1a\u5fc3\u8df3\u5305\u600e\u4e48\u8bbe\u8ba1\uff1f</p> <p>\u5b9a\u671f\u53d1\u5c0f\u5305 + \u8d85\u65f6\u8ba1\u6570\uff1b\u8d85\u8fc7 N \u6b21\u672a\u6536\u5230\u5219\u5224\u5b9a\u65ad\u5f00\u5e76\u91cd\u8fde\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#12","title":"1\ufe0f\u20e32\ufe0f\u20e3 \u8fdb\u7a0b\u548c\u7ebf\u7a0b\u7684\u533a\u522b\uff1f\uff08\u518d\u5f3a\u8c03\u4e00\u6b21\uff0c\u9762\u8bd5\u8d85\u9ad8\u9891\uff09","text":"<p>\u6807\u51c6\u56de\u7b54</p> <p>\u8fdb\u7a0b\u662f\u8d44\u6e90\u5206\u914d\u5355\u4f4d\uff0c\u7ebf\u7a0b\u662f\u8c03\u5ea6\u5355\u4f4d\uff1b\u7ebf\u7a0b\u5171\u4eab\u8fdb\u7a0b\u8d44\u6e90\uff0c\u5207\u6362\u5f00\u9500\u5c0f\uff0c\u4f46\u66f4\u9700\u8981\u540c\u6b65\u3002</p> <p>\u8ffd\u95ee\uff1a\u7ebf\u7a0b\u540c\u6b65\u7528\u54ea\u4e9b\uff1f</p> <p>mutex\u3001semaphore\u3001condition variable\u3001\u8bfb\u5199\u9501\uff1b\u907f\u514d\u6570\u636e\u7ade\u4e89\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#13","title":"1\ufe0f\u20e33\ufe0f\u20e3 \u6b7b\u9501\u662f\u4ec0\u4e48\uff1f\u600e\u4e48\u907f\u514d\uff1f","text":"<p>\u6807\u51c6\u56de\u7b54</p> <p>\u6b7b\u9501\u662f\u591a\u4e2a\u7ebf\u7a0b\u4e92\u76f8\u7b49\u5f85\u8d44\u6e90\u5bfc\u81f4\u6c38\u8fdc\u963b\u585e\u3002 \u907f\u514d\u65b9\u5f0f\uff1a\u56fa\u5b9a\u52a0\u9501\u987a\u5e8f\u3001\u51cf\u5c11\u9501\u6301\u6709\u65f6\u95f4\u3001\u5c1d\u8bd5\u9501 trylock\u3001\u8d85\u65f6\u673a\u5236\u3001\u62c6\u5206\u9501\u7c92\u5ea6\u3002</p> <p>\u8ffd\u95ee\uff1a\u6b7b\u9501\u56db\u4e2a\u5fc5\u8981\u6761\u4ef6\uff1f</p> <p>\u4e92\u65a5\u3001\u5360\u6709\u4e14\u7b49\u5f85\u3001\u4e0d\u53ef\u5265\u593a\u3001\u5faa\u73af\u7b49\u5f85\uff08\u7834\u574f\u4efb\u610f\u4e00\u4e2a\u5373\u53ef\uff09\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#14-linux-cpu","title":"1\ufe0f\u20e34\ufe0f\u20e3 Linux \u4e0b\u5982\u4f55\u6392\u67e5\u7a0b\u5e8f\u5361\u6b7b/\u9ad8 CPU\uff1f","text":"<p>\u6807\u51c6\u56de\u7b54</p> <p>\u5148\u7528 top/htop \u770b CPU/\u7ebf\u7a0b\uff1bps \u67e5\u8fdb\u7a0b\uff1b strace \u770b\u7cfb\u7edf\u8c03\u7528\u662f\u5426\u963b\u585e\uff1bgdb attach \u770b\u5806\u6808\uff1b \u82e5\u591a\u7ebf\u7a0b\uff0c\u7ed3\u5408 <code>pstack</code>/gdb \u7684 <code>thread apply all bt</code> \u67e5\u770b\u6240\u6709\u7ebf\u7a0b\u6808\u3002</p> <p>\u8ffd\u95ee\uff1a\u5982\u4f55\u5b9a\u4f4d\u5185\u5b58\u6cc4\u6f0f\uff1f</p> <p>valgrind\uff08Linux \u7528\u6237\u6001\uff09\u3001\u6216\u7528 sanitizer\uff08ASan/LSan\uff09\uff0c\u5d4c\u5165\u5f0f\u4fa7\u66f4\u5e38\u7528\u65e5\u5fd7+\u5185\u5b58\u6c60\u7edf\u8ba1\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#15_1","title":"1\ufe0f\u20e35\ufe0f\u20e3 \u7528\u6237\u6001\u548c\u5185\u6838\u6001\u7684\u533a\u522b\uff1f\u7cfb\u7edf\u8c03\u7528\u662f\u4ec0\u4e48\uff1f","text":"<p>\u6807\u51c6\u56de\u7b54</p> <p>\u7528\u6237\u6001\u6743\u9650\u4f4e\u4e0d\u80fd\u76f4\u63a5\u8bbf\u95ee\u786c\u4ef6\uff1b\u5185\u6838\u6001\u6743\u9650\u9ad8\u7ba1\u7406\u8fdb\u7a0b/\u5185\u5b58/\u8bbe\u5907\uff1b \u7cfb\u7edf\u8c03\u7528\u662f\u7528\u6237\u7a0b\u5e8f\u8bf7\u6c42\u5185\u6838\u670d\u52a1\u7684\u5165\u53e3\uff0c\u4f1a\u89e6\u53d1\u6001\u5207\u6362\u3002</p> <p>\u8ffd\u95ee\uff1a\u4e3a\u4ec0\u4e48\u8981\u5206\u4e24\u6001\uff1f</p> <p>\u5b89\u5168\u4e0e\u9694\u79bb\uff0c\u9632\u6b62\u5e94\u7528\u7a0b\u5e8f\u7834\u574f\u7cfb\u7edf\u7a33\u5b9a\u6027\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#16-linux","title":"1\ufe0f\u20e36\ufe0f\u20e3 Linux \u5e38\u89c1\u547d\u4ee4\uff08\u5d4c\u5165\u5f0f\u5b9e\u4e60\u5e38\u88ab\u987a\u53e3\u95ee\uff09","text":"<p>\u6807\u51c6\u56de\u7b54\uff08\u6309\u7528\u9014\u80cc\uff09</p> <p>\u8fdb\u7a0b\uff1aps/top/kill \u7f51\u7edc\uff1aping/ip/ss/tcpdump \u6587\u4ef6\uff1als/cd/cp/mv/rm/grep/find \u6743\u9650\uff1achmod/chown \u65e5\u5fd7\uff1admesg/journalctl\uff08\u89c6\u7cfb\u7edf\u800c\u5b9a\uff09</p> <p>\u8ffd\u95ee\uff1a\u600e\u4e48\u770b\u67d0\u7aef\u53e3\u662f\u5426\u88ab\u5360\u7528\uff1f</p> <p><code>ss -lntp</code>\uff08\u6216 <code>netstat -lntp</code>\uff09\u3002</p>"},{"location":"notes/%E9%9D%A2%E8%AF%95/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/#17_1","title":"1\ufe0f\u20e37\ufe0f\u20e3 \u4f60\u5982\u4f55\u63cf\u8ff0\u81ea\u5df1\u9879\u76ee\u91cc\u7684\u201c\u901a\u4fe1\u534f\u8bae\u7ec6\u8282\u201d\uff1f\uff08\u9762\u8bd5\u5fc5\u6740\u6a21\u677f\uff09","text":"<p>\u6807\u51c6\u56de\u7b54\u6a21\u677f</p> <p>\u6211\u4f1a\u4ece\u56db\u70b9\u8bf4\uff1a 1\uff09\u534f\u8bae\uff1aSPI/I2C/UART/CAN 2\uff09\u901f\u7387\uff1a\u5982 I2C 400kHz\u3001SPI 8MHz\u3001UART 115200\u3001CAN 500kbps 3\uff09\u5e27\u683c\u5f0f\uff1a\u5e27\u5934/\u957f\u5ea6/\u8d1f\u8f7d/\u6821\u9a8c\uff08CRC\uff09 4\uff09\u53ef\u9760\u6027\uff1a\u8d85\u65f6\u3001\u91cd\u4f20\u3001\u73af\u5f62\u7f13\u51b2\u3001DMA\u3001\u4e2d\u65ad\u7b56\u7565</p> <p>\u8ffd\u95ee\uff1a\u4f60\u4e00\u822c\u628a\u4ec0\u4e48\u653e ISR\uff0c\u4ec0\u4e48\u653e\u4e3b\u5faa\u73af/\u4efb\u52a1\uff1f</p> <p>ISR \u53ea\u505a\u201c\u5feb\u901f\u642c\u8fd0+\u7f6e\u6807\u5fd7\u201d\uff0c\u89e3\u6790/\u8ba1\u7b97\u653e\u4efb\u52a1\uff1b\u914d\u5408 DMA+ring buffer \u63d0\u5347\u7a33\u5b9a\u6027\u3002</p>"}]}